Ниже представлена пошаговая инструкция на русском языке по настройке 4G WAN failover на паре Juniper SRX300 в режиме High Availability (chassis cluster) и интеграции со стеком Cisco Catalyst, чтобы обеспечить автоматическое переключение на резервный канал 4G при сбое основного WAN.

1) Подготовить оборудование и сетевые подключения

1.1) Проверить физические соединения.
• Убедиться, что для каждого Juniper SRX300 предусмотрены необходимые порты для организации chassis cluster: один или несколько портов для связи control link и fabric link (в зависимости от модели и выбранной архитектуры).
• Подключить основной WAN к каждому SRX300 (при необходимости через отдельные физические порты, которые затем будут объединяться в reth interface).
• Подключить 4G-модем к одному из SRX300. Если модем USB, то вставить его в соответствующий порт на том SRX300, который будет являться активным для резервного канала.
• Убедиться, что соединения с Cisco Catalyst выполнены так, чтобы в дальнейшем настроить Link Aggregation Group (LAG) на Juniper SRX300 (aggregated Ethernet interface) и EtherChannel на Cisco Catalyst.

1.2) Удостовериться, что Cisco Catalyst настроен в режиме stack (если используется несколько физических коммутаторов). При необходимости настраивать базовые VLAN и проверять доступность устройств через CLI (например, командой show interface status).

2) Активировать и настроить chassis cluster (HA) на Juniper SRX300

2.1) Включить chassis cluster.
• На первом SRX300 (предположим, node 0) в конфигурации применить:
  set chassis cluster cluster-id <ID_кластера> node 0
• На втором SRX300 (node 1) применить:
  set chassis cluster cluster-id <ID_кластера> node 1
• Указать порты control и fabric при помощи:
  set chassis cluster control-ports fpc 0 port 0
  set chassis cluster control-ports fpc 1 port 0
  (Значения могут отличаться в зависимости от используемых интерфейсов.)
• После ввода соответствующих команд выполнить перезагрузку устройств, чтобы режим кластера активировался.

2.2) Проверить статус кластера.
• Использовать команду show chassis cluster status в CLI JunOS.
• Убедиться, что один узел отображается как primary, а второй — как secondary, и что состояние In Sync.

2.3) Настроить redundancy-group и reth interfaces.
• Применить:
  set chassis cluster redundancy-group 1 node 0 priority 200
  set chassis cluster redundancy-group 1 node 1 priority 100
• Создать reth interface (например, reth0) и привязать к нему физические порты, которые будут обслуживать LAN/WAN. Пример:
  set interfaces ge-0/0/0 gigether-options redundant-parent reth0
  set interfaces ge-1/0/0 gigether-options redundant-parent reth0
  set interfaces reth0 redundant-ether-options redundancy-group 1
  set interfaces reth0 unit 0 family inet address <адрес/маска>

3) Настроить 4G failover (резервный WAN) на Juniper SRX300 HA

3.1) Настроить интерфейс 4G на SRX300.
• Если используется USB-модем, проверить в CLI JunOS, что устройство распознано (например, интерфейс dl0 или pp0).
• Для внешних 4G-модемов (через Ethernet) указать соответствующий порт (например, ge-0/0/3) и задать IP-адрес или negotiate-address, в зависимости от требований провайдера.

3.2) Добавить статические маршруты для основного и резервного WAN.
• Пример (обобщённо):
  set routing-options static route 0.0.0.0/0 next-hop <адрес_основного_WAN> preference 10
  set routing-options static route 0.0.0.0/0 next-hop <интерфейс_4G> preference 20
• Это позволит SRX использовать основной канал в нормальных условиях и переключаться на 4G при недоступности основного канала.

3.3) Включить Real-time Performance Monitoring (RPM) или IP Monitoring.
• Создать probes (несколько IP-адресов, например, 8.8.8.8 и 1.1.1.1), чтобы отслеживать доступность основного WAN:
  set services rpm probe primary-isp test google target address 8.8.8.8
  set services rpm probe primary-isp test google probe-count 5
  set services rpm probe primary-isp test google test-interval 10
• Настроить thresholds и привязать результат тестов к track-options или event-options, чтобы при потере соединения менять приоритет маршрутов (failover на 4G).

4) Настроить DNS forwarding (при необходимости)

4.1) Указать DNS-серверы в разделе system name-server (например, публичные DNS 8.8.8.8, 1.1.1.1 или DNS-провайдера).
4.2) Если требуется автоматически менять DNS при переключении на 4G, использовать Event Options (в JunOS):
• Создать политику event-options policy primary-down и primary-up, которая при отсутствии ответов от основного WAN удаляет одни записи DNS forwarding и прописывает другие.

5) Создать Link Aggregation Group (LAG) на Juniper SRX300

5.1) Настроить aggregated Ethernet (ae) интерфейсы.
• Пример:
  set chassis aggregated-devices ethernet device-count 2
  set interfaces ge-0/0/1 ether-options 802.3ad ae0
  set interfaces ge-0/0/2 ether-options 802.3ad ae0
  set interfaces ae0 aggregated-ether-options lacp active
  set interfaces ae0 unit 0 family inet address <адрес/маска>
• В режиме chassis cluster вместо ae0 в большинстве случаев указываются reth (например, reth0), и child-interface ae0 назначается в конфигурации reth.

6) Настроить EtherChannel на Cisco Catalyst

6.1) Перейти в CLI Cisco Catalyst и в Global Configuration mode.
6.2) Задать Port-Channel и активировать LACP. Пример (Cisco IOS):
  interface range GigabitEthernet1/0/1-2
    channel-group 1 mode active
  interface Port-channel1
    switchport mode trunk
    switchport trunk allowed vlan <список VLAN>
6.3) Убедиться, что Port-channel поднялся (show etherchannel summary).

7) Проверить работоспособность HA и 4G failover

7.1) Проверить состояние chassis cluster.
• Команда show chassis cluster status на SRX300, чтобы увидеть primary/secondary.
7.2) Протестировать физическое отключение одного узла SRX300, чтобы проверить, что второй автоматически берёт на себя маршрутизацию.
7.3) Принудительно отключить основной WAN (например, вынуть кабель или выключить порт) и удостовериться, что трафик уходит через 4G, а подключённые клиенты сохраняют доступ в интернет.
7.4) Вернуть основной WAN и проверить, что SRX снова начинает использовать основной маршрут.

8) Документировать конфигурации

8.1) Сохранить итоговую конфигурацию JunOS:
• Например, командой show configuration | display set и сохранить вывод в файл `srx300_cluster_config.txt`.
8.2) Сохранить конфигурацию Cisco IOS:
• Командой show running-config и сохранить вывод в файл `cisco_catalyst_config.txt`.
8.3) Указать все IP-адреса, VLAN, маршруты и описания подключений, чтобы при необходимости легко повторить процесс настройки.

9) Настроить мониторинг и регулярную проверку

9.1) При желании включить SNMP, syslog, NetFlow для сбора статистики на внешнем сервере.
9.2) С определённой периодичностью проверять журналы (например, show log messages в JunOS) и логи Cisco Catalyst (show logging).
9.3) При необходимости обновлять версии JunOS и Cisco IOS до рекомендованных релизов, чтобы избежать проблем совместимости и повысить стабильность.

Данная последовательность действий обеспечивает корректное функционирование 4G WAN failover на паре Juniper SRX300 в режиме High Availability, с применением chassis cluster и LAG к Cisco Catalyst (EtherChannel), а также автоматическую маршрутизацию и корректировку DNS при переключении на резервный канал.