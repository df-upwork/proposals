## 1.
Клиент хочет выполнить следующий проект:
### 1.1. Title
Netsuite bulk upload for Asset Revaluation
### 1.2. Description
I need to do an asset revaluation in Netsuite for some assets (Fixed Assets - Transactions - Asset Revaluation).
When trying to import a csv for a bulk update, this error appears: "TypeError: Cannot read property 'value' of undefined"
Need someone specifically with experience in mass csv uploads for Asset Revaluation in Netsuite.

### 1.3. Tags
NetSuite Development
Oracle NetSuite
NetSuite Administration

## 2. В чём причина проблемы клиента?
### 2.1.
В 1-й раз я тебя спросил:
~~~
В чём причина проблемы клиента?
~~~

### 2.2.
Ты ответил:
~~~
Вероятнее всего, проблема связана с тем, что при массовом CSV-импорте не передаётся (или некорректно передаётся) хотя бы одно из обязательных полей, которое ожидает NetSuite. 

Сообщение об ошибке «TypeError: Cannot read property 'value' of undefined» обычно появляется в случаях, когда скрипт или сама система NetSuite пытаются получить доступ к полю или свойству, которого нет в переданных данных или которое неправильно сопоставлено при импорте. В контексте Asset Revaluation это может означать:

1. **Не хватает нужного столбца в CSV** (например, идентификатора актива, даты переоценки, новой стоимости или другого обязательного поля).
2. **Ошибочная или неполная настройка мэппинга полей** во время CSV-импорта в NetSuite (например, поле, которое должно содержать значение для переоценки, не сопоставлено или сопоставлено не с тем столбцом).
3. **Использование пользовательского (custom) скрипта или расширения**, в котором жёстко прописано ожидание определённых данных, но эти данные в CSV не приходят.

Чтобы устранить ошибку, нужно проверить:
- Правильность структуры и заголовков CSV-файла.
- Соответствие между столбцами CSV и полями NetSuite при настройке импорта (Mapping).
- Наличие всех требуемых полей (включая те, которые могут быть обязательными для NetSuite, но не очевидны на первый взгляд).
~~~

## 3. Каким образом производится сопоставление (mapping) полей?
### 3.1.
В 2-й раз я тебя спросил:
~~~
В пункте 2.2 ты писал:
```
**Ошибочная или неполная настройка мэппинга полей** во время CSV-импорта в NetSuite (например, поле, которое должно содержать значение для переоценки, не сопоставлено или сопоставлено не с тем столбцом).
```
А каким образом производится сопоставление (mapping) полей?
~~~

### 3.2.
Ты ответил:
~~~
Ниже — обобщённая информация, которая обычно нужна при массовой загрузке (CSV Import) для переоценки основных средств (Asset Revaluation) в NetSuite, а также описание, как именно в NetSuite выполняется сопоставление (mapping) полей из CSV-файла с полями системы.

---

## 1. Какие поля являются обязательными?

### 1.1. Общая логика обязательных полей
В NetSuite при импорте переоценки (Asset Revaluation) требуемый набор полей может отличаться в зависимости от:
1. **Настроек модуля Fixed Assets Management (FAM).**  
2. **Количество (и вид) используемых книг амортизации (Asset Books)** — если у вас несколько Books, потребуется указывать конкретную книгу (Book Name / Book ID).
3. **Дополнительных кастомизаций** (Custom Fields, Custom Scripts), влияющих на переоценку.

Однако в большинстве случаев **минимально** обязательные поля следующие:

1. **Internal ID / Asset ID / Asset Name**  
   - Нужно указывать хоть какой-то идентификатор, чтобы NetSuite понимал, для какого именно актива мы делаем переоценку.  
   - Часто используется `Internal ID` (внутренний идентификатор из NetSuite) или `Name/Number` актива (если он уникален и настроен для поиска).

2. **Revaluation Date (дата переоценки)**  
   - Дата, на которую будет выполнена переоценка.

3. **Book Name / Book ID (книга амортизации)**  
   - Если вы ведёте учёт для нескольких книг (например, Accounting Book, Tax Book и т.д.), нужно явно указать, в какой книге выполняется переоценка.

4. **Revaluation Amount / Fair Value / New Value** (в зависимости от настроек)  
   - Значение, до которого мы “доводим” стоимость актива (например, справедливая стоимость).
   - Может называться по-разному, в зависимости от того, используете ли вы стандартное поле NetSuite или кастомное поле, или у вас включены разные режимы переоценки (по стоимости, по амортизации и т.д.).

5. **Account (учётная запись для переоценки)**  
   - Тот счёт (или счета), на который будет отражена переоценка. В некоторых конфигурациях это может быть не нужно явно, но обычно система запрашивает счёт для регистрации «Revaluation Adjustment».

6. **Posting Period (учётный период)**  
   - В конфигурациях, где активна **функциональность учётных периодов (Accounting Periods)**, необходимо указать период, в который проводится переоценка (например, `Jan 2025`).

### 1.2. Дополнительные поля, которые могут потребоваться
- **Reason / Memo (причина переоценки / пояснение)**.  
- **Currency (валюта)**, если ваша система ведёт активы в нескольких валютах.  
- **Регионы, подразделения, классы** (Locations, Departments, Classes), если они обязательны по учётной политике.  
- **Custom Fields** — любые настраиваемые поля, отмеченные как «Mandatory» (обязательные) в вашей конфигурации.

Главное правило: если поле в интерфейсе NetSuite (при ручном создании переоценки) помечено красной звёздочкой или система требует его заполнения по скрипту (или валидации), то и при CSV-импорте оно становится обязательным.

---

## 2. Как осуществляется сопоставление (mapping) полей при CSV-импорте?

1. **Переход в CSV Import**  
   - Обычно это **Setup → Import/Export → Import CSV Records**.

2. **Выбор типа записи (Record Type)**  
   - Для переоценки основного средства в модуле FAM необходимо убедиться, что в выпадающем списке выбирается соответствующий тип (как правило, это может быть “Custom Record” для Asset Revaluation, если у вас стандартный модуль Fixed Assets Management от NetSuite) либо специальная категория, если вы используете кастомизированную конфигурацию.

3. **Загрузка (Upload) CSV-файла**  
   - На первом шаге загрузите ваш CSV-файл (или укажите URL, если файл хранится в файловом хранилище NetSuite).

4. **Выбор действия (Import Type) и подтипа (Record Type)**  
   - Обычно это **Import → Add** (или **Add/Update**), в зависимости от того, делаете ли вы новую запись переоценки или обновляете уже существующую.

5. **Mapping Fields (Сопоставление полей)**  
   - На шаге **Field Mapping** или **Mapping Assistant** система отображает список доступных полей NetSuite для данного типа записи.  
   - В правой части интерфейса вы увидите заголовки колонок из вашего CSV-файла. В левой — поля NetSuite.  
   - Нужно «протянуть» / «продрагивать» или вручную выбрать, какая колонка из CSV должна сопоставляться какому полю NetSuite.  

   Пример сопоставления (Mapping):
   - **CSV column “Asset Internal ID”** → **NetSuite Field “Asset (Internal ID)”**  
   - **CSV column “Revaluation Date”** → **NetSuite Field “Date”**  
   - **CSV column “Revaluation Amount”** → **NetSuite Field “New Value”** (или “Fair Value”)  
   - и т.д.

6. **Проверка обязательных полей**  
   - Система NetSuite обычно подсказывает, если вы не сопоставили важные поля.  
   - Однако, если у вас на каком-то поле заведён кастомный скрипт (Client Script, User Event Script и пр.), который считает поле обязательным, но NetSuite “формально” его не выделяет, нужно проверить это вручную.

7. **Проверка Preview**  
   - На финальном шаге часто можно увидеть «Preview» — предварительный просмотр, где NetSuite покажет, как будут выглядеть импортируемые записи.  
   - Если всё ок, нажимаете “Run Import” (или «Submit»).

---

## 3. Рекомендации по настройке CSV и проверке мэппинга

1. **Убедитесь, что в CSV корректные заголовки**  
   - Часто удобно сделать экспорт из NetSuite (если такая возможность есть) в виде шаблона, чтобы посмотреть, как система именует колонки. Затем подправить свой CSV.

2. **Используйте Saved Mapping**  
   - Когда вы один раз настроили соответствие (mapping), вы можете сохранить его, чтобы не делать эту работу заново при последующих импортных операциях.

3. **Проверяйте обязательные поля для каждой роли и центра**  
   - Если вы запускаете импорт из-под определённой роли (например, Administrator, FAM Accountant и т.д.), могут отличаться права доступа и поля, которые требуются.

4. **Включайте журнал (лог) ошибок**  
   - При возникновении ошибок NetSuite генерирует CSV Import Status Log. Изучите подробные сообщения об ошибках: иногда там указано, какое именно поле не обнаружено или невалидно.

5. **Проверяйте форматы дат, сумм, валюты**  
   - Формат даты (`MM/DD/YYYY` или `DD/MM/YYYY`) в CSV должен соответствовать настройкам NetSuite или настройкам учётной записи (или нужно явно указать формат в конфигурации импорта).  
   - Аналогично и для числовых полей (разделитель десятичных знаков — точка или запятая), валюты и т.п.

---

## 4. Итог

1. **Обязательные поля** для переоценки основных средств (Asset Revaluation) в NetSuite, как правило, включают: идентификатор актива (Internal ID / Name), дату переоценки, книгу амортизации, новое значение (Revaluation Amount / Fair Value) и при необходимости учётный период, счёт учёта переоценки и прочие поля, которые система или ваш скрипт помечают как обязательные.

2. **Mapping** (сопоставление) полей происходит через стандартный CSV Import Wizard в NetSuite. Вы указываете, какой столбец CSV соответствует какому полю NetSuite, и при этом должны обеспечить заполнение всех обязательных полей.  

Если в процессе загрузки NetSuite выдаёт ошибку вроде «TypeError: Cannot read property 'value' of undefined», это значит, что где-то система ожидает поле (и обращается к нему), которого нет в полученных данных или оно не сопоставлено. Нужно перепроверить, что все ключевые поля (особенно обязательные) корректно прописаны в CSV и сопоставлены в Mapping.
~~~

