# 1. Pros
## 1.1. Значительное изменение сетевой топологии при миграции
**Score**: **85**
Миграция от решения, использующего транзит через Akamai, к AWS Client VPN фундаментально меняет модель маршрутизации сети.
Ответственность за маршрутизацию трафика переходит от инфраструктуры Akamai к конфигурации AWS (таблицы маршрутизации VPC и Client VPN Endpoint).
Учитывая срочность миграции из-за End of Life продукта Akamai, высока вероятность, что новая конфигурация маршрутизации не была полностью или корректно реализована.
## 1.2. Требования к маршрутизации в режиме Split-Tunnel
**Score**: **80**
Если используется режим раздельного туннелирования (split-tunnel), клиенту передаются только маршруты, явно определенные в таблице маршрутизации Client VPN Endpoint.
Для достижения DNS-серверов (например, Route 53 Resolver) маршрут к соответствующей сети (например, CIDR VPC) должен присутствовать в этой таблице.
Если маршрут отсутствует, клиентское устройство не будет направлять DNS-запросы через VPN-туннель, что приведет к сбою разрешения имен, поскольку локальная сеть клиента не имеет доступа к внутренним IP-адресам VPC.
## 1.3. Требования к маршрутизации в режиме Full-Tunnel
**Score**: **70**
Если используется режим полного туннелирования (full-tunnel), весь трафик клиента направляется в VPN-туннель, но его дальнейшее прохождение зависит от таблиц маршрутизации VPC ассоциированных подсетей.
Если эти таблицы не содержат корректных маршрутов к DNS-серверам или маршрута к NAT Gateway/Internet Gateway для разрешения публичных имен, DNS-пакеты будут потеряны после входа в VPC.

# 2. Cons
## 2.1. Приоритет конфигурации DNS-серверов (Причина 1)
**Score**: **95**
Наиболее фундаментальным требованием для работы DNS является явное указание корректных IP-адресов DNS-серверов в конфигурации Client VPN Endpoint.
Если эти параметры не заданы, клиент не получает информацию о том, куда отправлять DNS-запросы.
В этом случае корректность маршрутизации не имеет значения, поскольку адрес назначения для DNS-запросов неизвестен клиенту или неверен.
## 2.2. Вероятность использования устаревших IP-адресов Akamai (Причина 1)
**Score**: **90**
Учитывая контекст миграции, весьма вероятно, что в конфигурации остались старые, теперь недоступные DNS-серверы Akamai.
Если IP-адреса не были обновлены на адреса резолверов AWS (например, Route 53 Resolver), DNS-запросы будут завершаться неудачей.
Это является проблемой конфигурации DNS (Причина 1), а не проблемой маршрутизации (Причина 4).
## 2.3. Обязательность правил авторизации (Причина 2)
**Score**: **85**
AWS Client VPN требует наличия правил авторизации (Authorization Rules) для предоставления доступа к целевым сетям.
Даже при идеально настроенной маршрутизации, если отсутствует правило, разрешающее доступ к сети, где расположены DNS-серверы, трафик будет заблокирован.
Авторизация является обязательным условием и проверяется до того, как применяются правила маршрутизации.
## 2.4. Простота сетевой среды
**Score**: **75**
Клиент использует «Single VPC (no on-premises connectivity)», что значительно снижает сложность маршрутизации.
Если используется стандартный Route 53 Resolver (по адресу `<VPC_CIDR_BASE> + 2`), доступ к нему внутри VPC обеспечивается неявным локальным маршрутом (Local Route).
В такой простой среде вероятность сложных ошибок маршрутизации на уровне VPC ниже, чем вероятность пропуска базовых шагов конфигурации.

# 3. Verdict
**Score**: **40**
Гипотеза H(4), утверждающая, что причиной сбоев разрешения DNS является некорректная конфигурация маршрутов, является правдоподобной, но маловероятной в качестве первопричины.
Аргументы в пользу гипотезы сильны в контексте миграции с Akamai (P1.1), которая требует значительной перенастройки сетевых путей, и включают технические механизмы отказа в режимах split-tunnel (P1.2) и full-tunnel (P1.3).
Однако существует несколько фундаментальных требований, которые должны быть выполнены до того, как маршрутизация станет ограничивающим фактором.
Отсутствие базовой конфигурации DNS-серверов (C2.1) или использование устаревших адресов Akamai (C2.2) являются наиболее вероятными причинами (Причина 1).
Без корректных IP-адресов DNS-резолверов система не будет функционировать независимо от состояния маршрутов.
Также критически важным является наличие правил авторизации (C2.3), разрешающих доступ к сети (Причина 2).
Учитывая простоту среды клиента (C2.4), вероятность ошибок маршрутизации снижается по сравнению с ошибками базовой конфигурации.