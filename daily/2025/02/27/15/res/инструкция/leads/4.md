### Обновленная инструкция для задачи «limit which leads are sent to Sales 365 based on account number format, ensuring correct division или customer group assignment»

На основе принятых решений (использование `Formula Field` в Salesforce, экспорт данных в формате CSV из Salesforce и импорт данных в формате CSV в Dynamics 365 Sales) и всего предыдущего обсуждения представлена последовательность действий для фильтрации лидов при миграции из Salesforce в Dynamics 365 Sales. Инструкция описывает создание поля `Formula Field` для классификации лидов, экспорт данных с этим полем, фильтрацию лидов в CSV-файле и импорт отфильтрованных данных в Dynamics 365 Sales с учетом правильного назначения `division` или `customer group`.

---

#### 1. Создание `Formula Field` в Salesforce для классификации лидов

1.1. В Salesforce перейти в раздел `Setup` → `Object Manager`.  
1.2. Выбрать объект `Lead` (или `Account`, если номер аккаунта хранится в этом объекте).  
1.3. Перейти в раздел `Fields & Relationships` и нажать `New` для создания нового поля.  
1.4. Выбрать тип поля `Formula` и нажать `Next`.  
1.5. Задать название поля, например, `Send to Sales 365`, и выбрать тип возвращаемого значения `Text`.  
1.6. В разделе `Formula` ввести выражение для определения, следует ли отправлять лид в Dynamics 365 Sales, на основе формата номера аккаунта. Пример выражения:  
   ```plaintext
   IF(BEGINS(AccountNumber, "DLR-"), "Send", "Do Not Send")
   ```  
   Данное выражение проверяет, начинается ли значение поля `AccountNumber` с "DLR-". Если условие выполняется, возвращается "Send", в противном случае — "Do Not Send".  
1.7. Нажать `Next`, настроить видимость поля для профилей пользователей и сохранить поле.  

После выполнения этих действий в каждой записи объекта `Lead` будет автоматически отображаться значение поля `Send to Sales 365`, зависящее от формата номера аккаунта. Это значение обновляется при любом изменении поля `AccountNumber` без необходимости дополнительных действий.

---

#### 2. Экспорт данных из Salesforce в формате CSV

2.1. В Salesforce перейти в раздел `Setup` → `Data` → `Data Export`.  
2.2. Выбрать опцию `Export Now` для немедленного экспорта данных.  
2.3. В разделе `Exported Data` выбрать объект `Lead` и необходимые связанные объекты, если требуется.  
2.4. Убедиться, что в список экспортируемых полей включено поле `Send to Sales 365`.  
2.5. Нажать `Export` и дождаться завершения процесса экспорта.  
2.6. Скачать ZIP-архив с экспортированными данными и извлечь CSV-файл, например, `Lead.csv`.  

В результате получается CSV-файл, содержащий все данные лидов, включая столбец `Send to Sales 365` с значениями "Send" или "Do Not Send" для каждой записи.

---

#### 3. Фильтрация лидов в CSV-файле

3.1. Открыть файл `Lead.csv` в редакторе таблиц, таком как Microsoft Excel или Google Sheets.  
3.2. Найти столбец с названием `Send to Sales 365`.  
3.3. Применить фильтр к этому столбцу и оставить только строки, где значение равно "Send".  
3.4. Скопировать отфильтрованные строки в новый файл или удалить строки со значением "Do Not Send" из текущего файла.  
3.5. Сохранить отфильтрованный файл в формате CSV, например, как `Filtered_Leads.csv`.  

После фильтрации в файле `Filtered_Leads.csv` останутся только лиды, предназначенные для передачи в Dynamics 365 Sales, то есть те, у которых значение поля `Send to Sales 365` равно "Send".

---

#### 4. Импорт отфильтрованных данных в Dynamics 365 Sales

4.1. В Dynamics 365 Sales перейти в раздел `Settings` → `Data Management` → `Imports`.  
4.2. Нажать `Import Data` и выбрать файл `Filtered_Leads.csv`.  
4.3. В мастере импорта выполнить сопоставление полей:  
   - Сопоставить поля из CSV-файла (например, `First Name`, `Last Name`, `Company`) с соответствующими полями в Dynamics 365 Sales.  
   - Если в Dynamics 365 Sales используются поля `division` или `customer group` для классификации, определить, как эти поля будут заполняться на основе данных из Salesforce. Например, если значение "Send" соответствует определенному подразделению (например, дилерам), настроить сопоставление или бизнес-правила для автоматического назначения.  
4.4. Завершить процесс импорта и проверить корректность загрузки данных в Dynamics 365 Sales.  

Этот шаг обеспечивает перенос только отфильтрованных лидов в Dynamics 365 Sales с учетом структуры данных целевой системы.

---

#### 5. Обеспечение правильного назначения `division` или `customer group`

5.1. Проверить, зависит ли назначение `division` или `customer group` в Dynamics 365 Sales от формата номера аккаунта. Если поле `Send to Sales 365` достаточно для определения категории (например, "Send" соответствует дилерам), использовать это значение при импорте для назначения соответствующих значений в поля `division` или `customer group`.  
5.2. При необходимости создать в Dynamics 365 Sales дополнительные поля или настроить `Business Rules` для автоматического заполнения `division` или `customer group` на основе импортированных данных, таких как `AccountNumber`.  
5.3. Выполнить проверку на тестовых записях, чтобы убедиться в корректности назначения `division` или `customer group` после импорта.  

Если формат номера аккаунта содержит информацию о подразделении или группе клиентов (например, "DLR-" для дилеров), это может быть использовано для настройки сопоставления или правил в Dynamics 365 Sales.

---

#### 6. Дополнительные рекомендации

- Перед выполнением массового импорта провести тестовый импорт с небольшим количеством записей для проверки корректности фильтрации и сопоставления полей.  
- Убедиться, что данные в файле `Filtered_Leads.csv` соответствуют требованиям Dynamics 365 Sales к формату полей, таких как даты, числа или текстовые значения.  
- При необходимости преобразовать данные в CSV-файле перед импортом для соответствия стандартам Dynamics 365 Sales.  

---

Данная инструкция обеспечивает фильтрацию лидов из Salesforce в Dynamics 365 Sales на основе формата номера аккаунта с использованием `Formula Field` для классификации, экспорта и импорта данных в формате CSV, а также правильного назначения `division` или `customer group` в целевой системе.