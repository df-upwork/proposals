Ниже приведена пошаговая инструкция по настройке существующего 4G failover для пары Juniper SRX300 в режиме High Availability (HA) и взаимодействию со стеком коммутаторов Cisco Catalyst. Эта инструкция содержит примеры необходимых изменений в конфигурациях JunOS и Cisco IOS, чтобы обеспечить корректную работу 4G WAN failover.

1. Подготовка аппаратных соединений и базовая проверка

1.1. Подключить два устройства Juniper SRX300 в единый «chassis cluster», используя выделенные порты для «control link» и «fabric link».  
1.2. Убедиться, что физические интерфейсы для основного WAN-канала (например, «ge-0/0/x») и для 4G-модема (USB или встроенный) доступны.  
1.3. Подключить несколько интерфейсов от каждого SRX300 к стеку Cisco Catalyst, чтобы в дальнейшем настроить «Link Aggregation Group (LAG)» (в Cisco IOS это «EtherChannel»).  
1.4. На Cisco Catalyst выполнить базовую проверку состояния портов в интерфейсе командной строки (CLI). Пример команд в Cisco IOS:  
```
show interface status
show etherchannel summary
```

2. Настройка High Availability (chassis cluster) на Juniper SRX300

2.1. На каждом SRX300 активировать «chassis cluster», указав одинаковый «cluster-id» и разные значения «node». Пример (на первом узле):
```
set chassis cluster cluster-id 1 node 0
set chassis cluster control-ports fpc 0 port 0
```
На втором узле:
```
set chassis cluster cluster-id 1 node 1
set chassis cluster control-ports fpc 0 port 0
```
После сохранения (commit) и перезагрузки устройств просмотреть статус кластера:
```
show chassis cluster status
```

2.2. Задать «redundancy group» и привязать к ним физические интерфейсы с помощью «reth» (redundant Ethernet interface). Пример:
```
set interfaces reth0 redundant-ether-options redundancy-group 1
set interfaces reth0 unit 0 family inet address 192.168.100.1/24

set chassis cluster redundancy-group 1 node 0 priority 200
set chassis cluster redundancy-group 1 node 1 priority 100
```
Указать, какие физические интерфейсы входят в reth0:
```
set interfaces ge-0/0/1 gigether-options redundant-parent reth0
set interfaces ge-1/0/1 gigether-options redundant-parent reth0
```

3. Организация 4G failover на Juniper SRX300 (JunOS)

3.1. Проверить, как устройство Juniper SRX300 видит 4G-интерфейс (например, pp0, dl0 или встроенный LTE-модем). Указать корректные настройки для провайдера 4G. Пример (упрощённая схема):
```
set interfaces pp0 unit 0 ppp-options pap local-name <username>
set interfaces pp0 unit 0 ppp-options pap local-password <password>
set interfaces pp0 unit 0 family inet negotiate-address
```
3.2. Добавить маршрут по умолчанию (default route) через основной WAN (с более высоким приоритетом) и резервный 4G (с более низким приоритетом). Пример:
```
set routing-options static route 0.0.0.0/0 next-hop <primary_WAN_IP> preference 10
set routing-options static route 0.0.0.0/0 next-hop pp0.0 preference 20
```
3.3. Настроить «Real-time Performance Monitoring (RPM)» или аналогичные механизмы, чтобы опрашивать несколько IP-адресов (multiple probes). В JunOS возможно настроить probes с помощью раздела «services rpm». Пример:
```
set services rpm probe primary-wan test google server 8.8.8.8
set services rpm probe primary-wan test google probe-count 3
set services rpm probe primary-wan test google test-interval 10
```
3.4. Связать результаты probes с автоматическим изменением приоритета маршрутов (через раздел «event-options»), чтобы при недоступности основного канала активировался маршрут через 4G.

4. Настройка DNS forwarding с учётом 4G failover

4.1. В JunOS определить, используется ли «DNS Proxy» или «system name-server». Пример (для «DNS Proxy»):
```
set system services dns forwarding domain * server 8.8.8.8
set system services dns forwarding domain * server 1.1.1.1
```
4.2. При переключении на 4G может потребоваться изменить «DNS forwarding» (например, добавить DNS-серверы 4G-провайдера). При использовании «event-options» возможно создать политику, которая выполняет команды «set» и «delete» при переходе в состояние failover.

5. Настройка «Link Aggregation Group (LAG)» между Juniper SRX300 и Cisco Catalyst

5.1. На Juniper SRX300 настроить «aggregated Ethernet interface» (например, ae0) и включить «LACP» в режиме active:
```
set chassis aggregated-devices ethernet device-count 1
set interfaces ae0 aggregated-ether-options lacp active
set interfaces ge-0/0/3 ether-options 802.3ad ae0
set interfaces ge-1/0/3 ether-options 802.3ad ae0
set interfaces ae0 unit 0 family inet address 192.168.200.1/24
```
5.2. На Cisco Catalyst создать «Port-channel» и включить его в режиме active (LACP). Пример команд в Cisco IOS:
```
interface range GigabitEthernet1/0/1 - 2
 channel-group 1 mode active
!
interface Port-channel1
 switchport mode trunk
```
5.3. Проверить статус на SRX300 (команда: show interfaces ae0 extensive) и на Cisco Catalyst (команда: show etherchannel summary).

6. Проверка HA и 4G failover

6.1. Проверить общую работоспособность «chassis cluster». Команда:
```
show chassis cluster status
```
6.2. Тестировать отказ одного из SRX300: выключить питание или отключить физический интерфейс на активном узле и убедиться, что второй узел берёт на себя функции маршрутизации.  
6.3. Тестировать отказ основного WAN-канала: временно отключить физически основной интерфейс, проконтролировать, что трафик уходит через 4G-интерфейс (pp0.0 или другой). Команда:
```
show interfaces pp0
```
6.4. Проверить работоспособность DNS. Например, выполнить ping публичного домена и оценить резолвинг имён.  
6.5. При необходимости изучить логи. В JunOS:
```
show log messages
```
В Cisco IOS:
```
show logging
```

7. Документирование и дальнейшее сопровождение

7.1. Сохранить итоговые конфигурации JunOS и Cisco IOS в файлы (например, `srx_cluster_config.txt` и `cisco_catalyst_config.txt`).  
7.2. Рекомендуется настроить централизованный сбор «syslog» и «SNMP» (или других методов телеметрии) для мониторинга состояния HA-кластера и резервного 4G.  
7.3. Периодически выполнять тестирование failover, чтобы убедиться в корректности настройки при обновлениях прошивок и изменения инфраструктуры.

Таким образом, после выполнения данных шагов 4G failover будет корректно работать на Juniper SRX300 в режиме HA, а взаимодействие со стеком Cisco Catalyst через LAG (EtherChannel) обеспечит отказоустойчивое и производительное сетевое соединение.