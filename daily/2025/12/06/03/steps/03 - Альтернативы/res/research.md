https://gemini.google.com/share/78382e3d4701

## **Aᚖ₁: Промежуточный прокси-сервер L4 (TCP Proxy VM)**

### **Суть**

Данная архитектурная альтернатива предполагает развертывание выделенного вычислительного инстанса в пользовательской виртуальной сети для транзита трафика.  
В рамках этой стратегии создается виртуальная машина Google Compute Engine в сети datastream-net, которая выступает в качестве промежуточного шлюза.  
На этом инстансе развертывается программное обеспечение для балансировки нагрузки и проксирования на транспортном уровне модели OSI, например, Nginx с модулем stream или HAProxy.  
Сервис Datastream конфигурируется для установления соединения с приватным IP-адресом этой виртуальной машины через существующий механизм VPC Peering.  
Прокси-сервер принимает входящие TCP-соединения от Datastream на определенном порту и перенаправляет их на адрес Private Service Connect Endpoint, ведущий к MongoDB Atlas.1  
Ключевой особенностью является то, что прокси-сервер находится внутри периметра безопасности пользователя, что дает ему доступ к локальной инфраструктуре DNS.  
Благодаря этому прокси-сервер способен корректно разрешать приватные доменные имена MongoDB Atlas, используя настроенную зону Cloud DNS mongo-psc-isolated.  
Это позволяет обойти ограничение сервиса Datastream, который не поддерживает разрешение имен в приватных соединениях.2  
Трафик передается в режиме TCP Passthrough, что означает отсутствие терминации SSL/TLS на стороне прокси-сервера.  
Шифрованный поток данных передается от Datastream к MongoDB Atlas в неизменном виде, обеспечивая целостность сквозного шифрования.  
Для корректной работы драйвера MongoDB, инициируемого Datastream, необходимо использовать параметр directConnection=true.3  
Это требование обусловлено тем, что стандартный механизм обнаружения топологии кластера MongoDB возвращает список хостов, к которым драйвер пытается переподключиться напрямую.  
В случае использования прокси-сервера драйвер должен оставаться подключенным к единственной точке входа — IP-адресу прокси.  
Таким образом, данное решение создает необходимый мост между изолированными сетевыми сегментами, преодолевая отсутствие транзитивной маршрутизации в VPC Peering.4

### **Оценка**

95

### **Достоинства**

Данное решение обеспечивает полный и гранулярный контроль над процессом маршрутизации трафика данных между изолированными сетями.  
Инженеры получают возможность управлять таймаутами соединений, размерами буферов и поведением при сбоях на уровне конфигурации Nginx или HAProxy.5  
Решение проблемы Split-Horizon DNS реализуется наиболее естественным образом через использование системного резолвера операционной системы виртуальной машины.  
Это устраняет необходимость в сложных манипуляциях с файлами hosts или попытках внедрения DNS-записей в недоступные среды управляемых сервисов.  
Производительность современных прокси-серверов на уровне L4 позволяет обрабатывать гигабитные потоки данных с минимальными накладными расходами процессорного времени.6  
Отсутствие двойной инкапсуляции трафика, характерной для туннельных решений, снижает вероятность фрагментации пакетов и повышает пропускную способность.  
Использование стандартных протоколов TCP/IP гарантирует совместимость с любыми версиями баз данных и клиентов без привязки к проприетарным механизмам облака.  
Решение позволяет реализовать расширенное логирование сетевой активности, фиксируя каждый факт установления и разрыва соединения для аудита безопасности.  
Виртуальная машина прокси-сервера может быть легко интегрирована в существующие системы мониторинга инфраструктуры для отслеживания метрик здоровья.  
Возможность использования внутренних балансировщиков нагрузки Google Cloud перед группой прокси-серверов обеспечивает горизонтальную масштабируемость решения.  
Стоимость эксплуатации данного решения остается низкой, так как для проксирования трафика достаточно вычислительных мощностей базовых типов инстансов, таких как e2-micro.7  
Этот подход является проверенным индустриальным стандартом для организации транзитного доступа в сложных облачных топологиях с нетранзитивным пирингом.  
Конфигурация прокси-сервера может быть полностью описана в коде (Infrastructure as Code) с использованием Terraform или Ansible, что упрощает воспроизводимость среды.  
Решение не требует от сервиса Datastream поддержки специфических функций, полагаясь только на базовую возможность подключения по приватному IP.  
Обеспечивается строгая изоляция контуров, так как прокси-сервер может быть настроен на прием соединений только из диапазона IP-адресов Datastream.

### **Недостатки**

Внедрение промежуточной виртуальной машины неизбежно увеличивает эксплуатационную нагрузку на команду сопровождения инфраструктуры.  
Требуется регулярное обновление операционной системы и программного обеспечения прокси-сервера для устранения уязвимостей безопасности.  
Виртуальная машина становится потенциальной единой точкой отказа в архитектуре, если не приняты меры по обеспечению высокой доступности.  
Для реализации отказоустойчивости необходимо настраивать группы инстансов и механизмы автоматического восстановления, что усложняет архитектуру.  
Использование параметра directConnection=true отключает встроенные в драйвер MongoDB механизмы автоматического переключения на новый мастер-узел при сбоях.8  
Это перекладывает ответственность за обнаружение сбоев и перенаправление трафика на инфраструктуру Private Service Connect и балансировщики нагрузки Atlas.  
Существует риск возникновения сложностей с валидацией SSL-сертификатов, если клиент ожидает совпадения IP-адреса подключения с именем в сертификате.  
Хотя режим TCP Passthrough передает SNI от клиента, несоответствие адреса назначения может вызвать ошибки в некоторых строгих конфигурациях TLS-клиентов.  
Добавление дополнительного сетевого узла (хопа) в путь прохождения пакета теоретически увеличивает задержку передачи данных.  
Необходимость ручного управления правилами брандмауэра для прокси-сервера повышает риск человеческой ошибки при конфигурировании доступа.  
Мониторинг состояния самого процесса проксирования требует настройки специализированных агентов и сбора метрик, отличных от метрик управляемых сервисов.  
В случае масштабных атак или аномальных всплесков трафика прокси-сервер может стать узким местом, исчерпав лимиты сетевой пропускной способности инстанса.  
Расходы на исходящий трафик могут возрасти, если прокси-сервер и целевой эндпоинт находятся в разных зонах доступности, так как трафик проходит через VM.  
Настройка корректного keepalive для долгоживущих соединений CDC требует глубокого понимания параметров ядра Linux и конфигурации прокси.9  
Ошибки в конфигурации прокси-сервера могут быть неочевидны и требовать сложной диагностики с анализом сетевых дампов.

## **Aᚖ₂: SSH-туннелирование через Bastion Host (Native Feature)**

### **Суть**

Данный метод базируется на использовании встроенной функциональности сервиса Datastream для установления защищенных соединений через промежуточный хост.  
В архитектуре развертывается виртуальная машина в сети datastream-net, выполняющая роль SSH-бастиона, к которому Datastream подключается как SSH-клиент.  
Настройка производится непосредственно в интерфейсе создания профиля соединения Datastream, где выбирается метод "Forward SSH tunnel".10  
Datastream устанавливает зашифрованное SSH-соединение с бастионом, используя пару криптографических ключей или пароль для аутентификации.  
В рамках этого SSH-соединения создается туннель, который перенаправляет трафик с локального порта сервиса Datastream на целевой хост и порт MongoDB Atlas.  
Критически важным аспектом является то, что разрешение DNS-имени целевого хоста выполняется на стороне бастиона, а не на стороне Datastream.11  
Когда Datastream запрашивает соединение к доменному имени кластера Atlas, SSH-сервер на бастионе использует локальные настройки DNS для получения IP-адреса.  
Поскольку бастион находится в пользовательской VPC, он имеет доступ к Cloud DNS Private Zone и корректно разрешает имя в приватный IP-адрес PSC Endpoint.  
Трафик базы данных инкапсулируется внутри пакетов SSH и передается через пиринговое соединение или публичную сеть к бастиону.  
Бастион извлекает пакеты базы данных и пересылает их на PSC Endpoint, выступая в роли инициатора соединения внутри сети VPC.  
Этот метод позволяет обойти ограничения нетранзитивной маршрутизации, так как с точки зрения сети соединение исходит от локального ресурса VPC.12  
Datastream автоматически управляет поддержанием SSH-сессии, выполняя переподключение в случае разрыва связи.  
Для реализации требуется добавить публичный ключ Datastream в файл authorized_keys на бастионе и разрешить входящие SSH-соединения на сетевом уровне.  
Использование данного метода официально рекомендовано Google для сценариев подключения к источникам данных, находящимся в защищенных сетях.13  
Конфигурация профиля соединения включает указание адреса бастиона, учетных данных и целевых параметров базы данных MongoDB.

### **Оценка**

85

### **Достоинства**

Этот метод является нативным для сервиса Datastream, что гарантирует полную поддержку и совместимость со стороны облачного провайдера.  
Отсутствует необходимость в установке и сложной настройке дополнительного программного обеспечения, такого как веб-серверы или специализированные прокси.  
Решение проблемы разрешения имен DNS происходит автоматически благодаря архитектуре протокола SSH, поддерживающего удаленный резолвинг.12  
Это устраняет необходимость в настройке локальных резолверов или модификации файлов конфигурации на стороне источника данных.  
Весь трафик данных между Datastream и пользовательской сетью дополнительно шифруется протоколом SSH, обеспечивая высокий уровень защиты.  
Аутентификация с использованием пары ключей SSH (Public/Private Key) является надежным стандартом индустрии для контроля доступа.  
Упрощается процесс прохождения проверок безопасности, так как использование бастион-хостов является общепринятым паттерном в корпоративной среде.  
Datastream берет на себя управление жизненным циклом туннеля, снижая нагрузку на инженеров по написанию скриптов мониторинга и перезапуска.  
Метод позволяет использовать публичные IP-адреса для бастиона, если приватная связность через пиринг затруднена или невозможна.  
Легкость смены целевого хоста базы данных без необходимости переконфигурирования самого бастиона делает решение гибким.  
Журналирование подключений на уровне системных логов SSH (/var/log/auth.log) предоставляет подробную информацию об попытках доступа.14  
Бастион-хост может использоваться для подключения к множеству различных баз данных, выступая универсальным шлюзом.  
Отсутствие необходимости в управлении SSL-сертификатами на промежуточном узле упрощает эксплуатацию по сравнению с TLS-прокси.  
Нативная интеграция в UI/API Datastream позволяет настраивать соединение декларативно через Terraform или другие инструменты IaC.15  
Минимизируются риски ошибок конфигурации сети, так как туннель абстрагирует сложность маршрутизации между сервисом и VPC.

### **Недостатки**

Инкапсуляция протокола TCP внутри другого протокола TCP (SSH) может приводить к проблемам производительности, известным как "TCP Meltdown".16  
При потере пакетов во внешнем соединении внутреннее соединение может испытывать экстремальные задержки из-за конфликта механизмов повторной передачи.  
Пропускная способность SSH-туннеля ограничена производительностью процессора бастиона, затрачиваемой на шифрование и дешифрование потока данных.17  
Это может стать критическим узким местом для высоконагруженных потоков CDC с большими объемами изменений данных.  
Бастион-хост представляет собой единую точку отказа, и организация его кластеризации для SSH-туннелей технически сложна.  
Управление SSH-ключами требует внедрения процессов их ротации и безопасного хранения, чтобы предотвратить компрометацию доступа.  
Если используется подключение по публичному IP, это формально нарушает требование задачи о полном исключении выхода в публичный интернет, даже при наличии шифрования.  
Мониторинг качества соединения внутри туннеля затруднен, так как для внешнего наблюдателя это выглядит как единый зашифрованный поток.  
Ограничения конфигурации демона SSHD (например, MaxStartups) могут неожиданно блокировать новые соединения при масштабировании количества задач репликации.  
Некоторые функции драйверов баз данных, чувствительные к задержкам, могут работать нестабильно из-за накладных расходов туннелирования.  
Отладка проблем с подключением может быть сложной из-за неочевидных сообщений об ошибках, скрывающих реальную причину сбоя внутри туннеля.18  
Зависимость от стабильности SSH-сессии означает, что любые разрывы сетевого соединения требуют полного пересоздания контекста подключения к базе данных.  
Использование SSH-туннеля может не поддерживаться некоторыми корпоративными политиками безопасности, требующими инспекции трафика или использования специфических протоколов VPN.  
При высокой нагрузке возможно исчерпание портов на бастионе или достижение лимитов операционной системы по количеству открытых файлов.  
Двойное шифрование (SSH плюс TLS самой базы данных) создает избыточную вычислительную нагрузку, не повышая существенно уровень безопасности данных.

## **Aᚖ₃: Использование Datastream Private Service Connect Interfaces**

### **Суть**

Эта альтернатива опирается на использование нового механизма подключения, предоставляемого Google Cloud специально для управляемых сервисов.  
Вместо традиционного VPC Peering, Datastream настраивается на использование Private Service Connect Interfaces для исходящих соединений.19  
В пользовательской VPC создается ресурс Network Attachment, который служит точкой терминации для интерфейса Datastream.  
При создании конфигурации приватного подключения в Datastream указывается ссылка на этот Network Attachment.  
Google Cloud автоматически создает сетевой интерфейс в подсети пользователя и привязывает его к инстансу Datastream.  
Этот интерфейс получает внутренний IP-адрес из диапазона подсети пользовательской VPC, становясь локальным ресурсом сети.20  
Сетевой трафик от Datastream теперь исходит непосредственно из пользовательской VPC, что технически устраняет проблему транзитивности пиринга.  
Пакеты данных могут маршрутизироваться к другим ресурсам PSC (Endpoints) внутри той же сети, так как они находятся в одном домене маршрутизации.  
Однако, несмотря на решение проблемы связности L3, данный метод не предоставляет встроенных механизмов разрешения DNS.2  
Datastream по-прежнему требует указания IP-адресов целевых серверов, так как не имеет доступа к инфраструктуре Cloud DNS VPC.  
Для подключения к MongoDB Atlas через PSC Interface необходимо использовать IP-адрес PSC Endpoint Atlas в строке подключения.  
Чтобы обеспечить работоспособность соединения с MongoDB, требующей валидации хостнеймов для SSL, необходимо применять параметры драйвера, отключающие проверки, или использовать directConnection=true.  
Этот метод представляет собой современный, "cloud-native" подход к интеграции сервисов, исключающий сложности управления пиринговыми связями.  
Он обеспечивает строгую изоляцию и контроль над точками входа в сеть через механизм Network Attachments.19  
Конфигурация требует тщательной настройки IAM-ролей для сервисного аккаунта Datastream, чтобы он мог создавать интерфейсы в проекте пользователя.

### **Оценка**

60

### **Достоинства**

Данный метод позволяет полностью отказаться от использования VPC Peering, устраняя риски конфликтов адресного пространства IP.  
Отсутствует необходимость в резервировании больших диапазонов адресов через servicenetworking, что экономит адресное пространство VPC.  
Datastream получает прямое присутствие в пользовательской сети, что упрощает понимание топологии и отладку маршрутизации.  
Трафик между Datastream и базой данных никогда не покидает магистральную сеть Google, обеспечивая максимальную безопасность и низкие задержки.  
Исключается необходимость в развертывании и обслуживании промежуточных виртуальных машин, что снижает операционные расходы (OPEX).  
Решение обладает высокой надежностью, опираясь на программно-определяемую сеть Google Andromeda, а не на отдельные инстансы Compute Engine.  
Позволяет реализовать более гранулярные политики безопасности брандмауэра, применяя правила непосредственно к IP-адресам интерфейсов Datastream.  
Соответствует стратегии Google Cloud по переходу на PSC как основной метод интеграции сервисов, что гарантирует долгосрочную поддержку.  
Упрощает аудит сетевого доступа, так как интерфейсы Datastream видны как обычные ресурсы в консоли управления сетью.  
Обеспечивает лучшую изоляцию между различными средами (dev/prod), так как Network Attachments могут быть созданы в разных подсетях.  
Позволяет избежать проблемы "шумных соседей", характерной для общих каналов пиринга, предоставляя выделенную полосу пропускания.  
Поддерживает транзитивный доступ к ресурсам, подключенным через VPN или Interconnect к пользовательской VPC.21  
Конфигурация через Terraform позволяет полностью автоматизировать развертывание сетевой инфраструктуры для Datastream.15  
Снижает сложность сетевой топологии для организаций, использующих архитектуру Shared VPC, упрощая управление правами доступа.  
Является наиболее перспективным методом подключения, функциональность которого активно развивается со стороны Google Cloud.

### **Недостатки**

Критическим недостатком является отсутствие поддержки разрешения имен DNS в текущей реализации Datastream, даже при использовании PSC Interfaces.2  
Это вынуждает использовать IP-адреса в конфигурации подключения, что делает настройку зависимой от статичности инфраструктуры.  
Необходимость использования IP-адресов создает серьезные проблемы при подключении к MongoDB Atlas, использующей TLS-сертификаты, выданные на доменные имена.  
Отсутствие возможности легко игнорировать ошибки SSL в настройках Datastream может сделать прямое подключение к Atlas невозможным без нарушения безопасности.  
Использование directConnection=true лишает драйвер возможности автоматически реагировать на изменения топологии кластера MongoDB, снижая отказоустойчивость.  
Настройка PSC Interfaces требует более глубокого понимания IAM и сетевых абстракций GCP, чем традиционный пиринг.  
Невозможность миграции существующих конфигураций требует пересоздания профилей подключения с потерей истории или необходимостью полной ресинхронизации данных.13  
В некоторых случаях наблюдаются проблемы с задержкой при создании интерфейсов, когда статус "Creating" зависает на длительное время.22  
Ограниченная документация и примеры сообщества для комбинации Datastream PSC Interface и MongoDB Atlas создают риски при внедрении.  
Стоимость использования PSC Interfaces и обработки данных может быть выше, чем у бесплатного трафика внутри пиринга в рамках одной зоны.  
При изменении IP-адресов PSC Endpoint (например, при пересоздании) потребуется ручное обновление конфигурации Datastream, так как нет DNS-автоматизации.  
Отсутствие возможности внедрения заголовков или модификации трафика ограничивает гибкость решения в сложных сценариях безопасности.  
Не все инструменты мониторинга GCP могут корректно отображать метрики для PSC Interfaces на данный момент.  
Существует риск столкнуться с неочевидными ограничениями платформы, характерными для новых функций, которые еще не прошли проверку временем в масштабных инсталляциях.  
Для реализации полноценного решения с поддержкой DNS все равно может потребоваться внедрение прокси, что нивелирует преимущества отказа от VM.

## **Aᚖ₄: Использование публичного IP Allowlisting (Public Connectivity)**

### **Суть**

Данная альтернатива предполагает отказ от попыток организации приватного сетевого канала в пользу использования публичной сети Интернет.  
Сервис Datastream настраивается на использование метода подключения "IP allowlisting", при котором трафик исходит с набора статических публичных IP-адресов Google.  
В консоли управления MongoDB Atlas создаются правила сетевого доступа (Network Access), разрешающие входящие соединения исключительно с этих IP-адресов Datastream.13  
Маршрутизация трафика осуществляется через публичные шлюзы интернета, однако данные защищаются обязательным для Atlas шифрованием TLS.  
В этом сценарии Datastream использует публичные DNS-серверы (например, Google Public DNS 8.8.8.8) для разрешения имен хостов.  
Публичные DNS-серверы корректно разрешают канонические имена узлов MongoDB Atlas (*.mongodb.net) в их публичные IP-адреса.  
Это автоматически устраняет проблему Split-Horizon DNS (P2†), так как используется глобально доступное пространство имен.  
Также устраняется проблема маршрутизации (P3†), так как публичные IP-адреса Atlas доступны из любой точки сети при наличии соответствующих разрешений брандмауэра.  
Драйвер MongoDB в Datastream работает в штатном режиме, используя строку подключения mongodb+srv://, и корректно обрабатывает обнаружение топологии реплика-сета.  
Метод обеспечивает функциональную работоспособность интеграции "из коробки" с минимальными усилиями по настройке.  
Безопасность обеспечивается комбинацией белых списков IP (Network Level) и аутентификации базы данных с шифрованием (Application Level).  
Данный подход часто используется как временное решение или для сред разработки, где требования к изоляции сети менее строгие.  
Реализация не требует создания и управления ресурсами в Google Cloud VPC, такими как пиринг, DNS-зоны или виртуальные машины.  
Однако этот метод прямо противоречит заявленной цели задачи T⁎ — избегать прохождения трафика через публичный интернет.

### **Оценка**

40

### **Достоинства**

Максимальная простота и скорость внедрения позволяют запустить репликацию данных буквально за несколько минут.  
Гарантированная работоспособность всех механизмов драйвера MongoDB, включая валидацию SSL-сертификатов и автоматическое обнаружение узлов.  
Отсутствие необходимости в развертывании, настройке и обслуживании какой-либо дополнительной инфраструктуры (Zero Ops).  
Нулевые дополнительные расходы на облачные ресурсы, так как не используются виртуальные машины, NAT-шлюзы или платные функции VPC.  
Высокая надежность соединения за счет исключения промежуточных точек отказа, которые могли бы возникнуть при использовании прокси или туннелей.  
Легкость диагностики и отладки проблем подключения, так как доступность публичных эндпоинтов можно проверить с любой рабочей станции.  
Независимость от архитектурных ограничений и лимитов Google Cloud VPC, таких как квоты на маршруты или правила транзитивности.  
Автоматическая адаптация к изменениям в инфраструктуре Atlas, так как DNS-записи обновляются на стороне MongoDB и корректно воспринимаются Datastream.  
Отсутствие риска возникновения проблем с производительностью из-за накладных расходов на инкапсуляцию трафика (как в VPN или SSH).  
Прозрачность для инструментов мониторинга Atlas, которые видят реальные IP-адреса источника подключений.  
Возможность использования стандартной документации и примеров конфигурации без необходимости адаптации под специфику приватных сетей.  
Упрощение схемы взаимодействия между командами, так как не требуется согласование выделения приватных диапазонов IP или настройки пиринга.  
Отсутствие проблем с пересечением адресных пространств (IP Overlap), которые часто возникают при объединении корпоративных сетей.  
Минимальный риск человеческой ошибки при настройке, так как процесс сводится к копированию списка IP-адресов.  
Стабильность работы при обновлении версий сервисов, так как используется наиболее базовый и поддерживаемый метод подключения.

### **Недостатки**

Фундаментальное нарушение требования безопасности о предотвращении выхода трафика в публичный интернет ("avoid public internet traversal").  
Повышенный риск кибератак, таких как DDoS или попытки подбора паролей, так как публичные интерфейсы базы данных теоретически доступны всему интернету.  
Несоответствие многим корпоративным стандартам безопасности и нормативным требованиям (PCI DSS, HIPAA, GDPR), требующим сетевой изоляции баз данных.  
Зависимость от актуальности списков публичных IP-адресов Datastream, которые могут изменяться Google, требуя оперативного обновления правил в Atlas.  
Потенциально более высокая и менее предсказуемая задержка передачи данных по сравнению с выделенными приватными каналами внутри сети Google.  
Отсутствие гарантий качества обслуживания (QoS) для трафика, проходящего через публичные сегменты сети.  
Сложности с прохождением аудита безопасности, требующего доказательства того, что данные не подвергались риску перехвата или манипуляции в публичной сети.  
Невозможность использования механизмов VPC Service Controls для ограничения периметра данных, так как трафик покидает защищенный контур.  
Возможные дополнительные расходы на трафик (Data Transfer Out) со стороны MongoDB Atlas, если публичный трафик тарифицируется выше приватного.  
Психологический дискомфорт для заказчика, который уже инвестировал ресурсы в настройку PSC и ожидает решения уровня Enterprise.  
Риск блокировки трафика промежуточными провайдерами или национальными фаерволами в случае трансграничной передачи данных.  
Отсутствие возможности скрыть факт использования облачных сервисов от внешнего наблюдателя, анализирующего трафик.  
Усложнение архитектуры безопасности в целом, так как приходится поддерживать исключения для публичного доступа в политиках "Deny All".  
Невозможность использования приватных имен хостов и внутренних DNS-зон для управления маршрутизацией трафика.  
Восприятие решения как "непрофессионального" или "временного костыля" в контексте современной облачной архитектуры.

## **Итоговый вердикт**

На основании всестороннего анализа технических ограничений Google Cloud Datastream, специфики работы сетевого стека MongoDB Atlas и требований задачи T⁎ по обеспечению приватности соединения, сформулировано следующее заключение.

Прямая реализация схемы Datastream -> VPC Peering -> PSC Endpoint технически невозможна из-за отсутствия транзитивной маршрутизации в пиринге Google Cloud и неспособности Datastream выполнять разрешение DNS-имен в частных зонах.  
Заблуждения клиента ꆜ относительно "сбоя DNS" и "игнорирования маршрутов" опровергнуты фактами архитектурного дизайна платформы.  
Сравнительный анализ альтернатив показывает, что Стратегия Aᚖ₁ (Промежуточный прокси-сервер L4) является наиболее сбалансированным и надежным решением для промышленной эксплуатации.  
Она обеспечивает полный контроль над маршрутизацией и разрешением имен DNS, устраняя оба корневых блокирующих фактора.  
Использование прокси-сервера позволяет сохранить архитектуру Private Service Connect, обеспечивая безопасность трафика и соответствие требованиям комплаенса, при этом гарантируя высокую производительность и стабильность потока данных.  
Рекомендация: Следует отказаться от текущей стратегии T༄ в пользу внедрения архитектуры Aᚖ₁.  
Это потребует развертывания минимальной инфраструктуры (одной или двух VM с Nginx), но взамен предоставит детерминированное и управляемое решение проблемы связности.  
Использование directConnection=true в профиле Datastream является обязательным условием успеха данной интеграции.

#### **Works cited**

1. Mongo DB behind Nginx as reverse proxy, share your Mongo DB with your friends in LAN network - GitHub Gist, accessed December 6, 2025, [https://gist.github.com/bugb/e08f4edd1d7ba11706469ccd6cce1dfd](https://gist.github.com/bugb/e08f4edd1d7ba11706469ccd6cce1dfd)  
2. Create a private connectivity configuration | Datastream - Google Cloud Documentation, accessed December 7, 2025, [https://docs.cloud.google.com/datastream/docs/create-a-private-connectivity-configuration](https://docs.cloud.google.com/datastream/docs/create-a-private-connectivity-configuration)  
3. Connection String Options - Database Manual - MongoDB Docs, accessed December 6, 2025, [https://www.mongodb.com/docs/manual/reference/connection-string-options/](https://www.mongodb.com/docs/manual/reference/connection-string-options/)  
4. VPC Network Peering | Virtual Private Cloud, accessed December 7, 2025, [https://docs.cloud.google.com/vpc/docs/vpc-peering](https://docs.cloud.google.com/vpc/docs/vpc-peering)  
5. Module ngx_stream_proxy_module - nginx, accessed December 7, 2025, [https://nginx.org/en/docs/stream/ngx_stream_proxy_module.html](https://nginx.org/en/docs/stream/ngx_stream_proxy_module.html)  
6. How to setup MongoDB behind Nginx Reverse Proxy [closed] - Stack Overflow, accessed December 7, 2025, [https://stackoverflow.com/questions/31853755/how-to-setup-mongodb-behind-nginx-reverse-proxy](https://stackoverflow.com/questions/31853755/how-to-setup-mongodb-behind-nginx-reverse-proxy)  
7. How To Setup Network Connectivity Between VPCs In Google Cloud - Xebia, accessed December 6, 2025, [https://xebia.com/blog/how-to-setup-network-connectivity-between-vpcs-in-google-cloud/](https://xebia.com/blog/how-to-setup-network-connectivity-between-vpcs-in-google-cloud/)  
8. Connect to a Deployment - mongosh - MongoDB Docs, accessed December 6, 2025, [https://www.mongodb.com/docs/mongodb-shell/connect/](https://www.mongodb.com/docs/mongodb-shell/connect/)  
9. MongoDB behind Nginx Reverse Proxy Manager : r/selfhosted - Reddit, accessed December 7, 2025, [https://www.reddit.com/r/selfhosted/comments/1ctr6zx/mongodb_behind_nginx_reverse_proxy_manager/](https://www.reddit.com/r/selfhosted/comments/1ctr6zx/mongodb_behind_nginx_reverse_proxy_manager/)  
10. Create connection profiles | Datastream - Google Cloud Documentation, accessed December 7, 2025, [https://docs.cloud.google.com/datastream/docs/create-connection-profiles](https://docs.cloud.google.com/datastream/docs/create-connection-profiles)  
11. When using an SSH tunnel does the server resolve domain names or is it still done via the ISP/DNS server on the router? - Information Security Stack Exchange, accessed December 7, 2025, [https://security.stackexchange.com/questions/144297/when-using-an-ssh-tunnel-does-the-server-resolve-domain-names-or-is-it-still-don](https://security.stackexchange.com/questions/144297/when-using-an-ssh-tunnel-does-the-server-resolve-domain-names-or-is-it-still-don)  
12. How to SSH tunnel to a destination host resolved via internal DNS on the bastion host, accessed December 7, 2025, [https://unix.stackexchange.com/questions/598819/how-to-ssh-tunnel-to-a-destination-host-resolved-via-internal-dns-on-the-bastion](https://unix.stackexchange.com/questions/598819/how-to-ssh-tunnel-to-a-destination-host-resolved-via-internal-dns-on-the-bastion)  
13. Network connectivity methods | Datastream - Google Cloud Documentation, accessed December 7, 2025, [https://docs.cloud.google.com/datastream/docs/network-connectivity-options](https://docs.cloud.google.com/datastream/docs/network-connectivity-options)  
14. how to connect to mongodb server via ssh tunnel, accessed December 7, 2025, [https://serverfault.com/questions/597765/how-to-connect-to-mongodb-server-via-ssh-tunnel](https://serverfault.com/questions/597765/how-to-connect-to-mongodb-server-via-ssh-tunnel)  
15. google_datastream_private_con, accessed December 7, 2025, [https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/datastream_private_connection](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/datastream_private_connection)  
16. Are there disadvantages in SSH tunneling? - Unix & Linux Stack Exchange, accessed December 6, 2025, [https://unix.stackexchange.com/questions/34499/are-there-disadvantages-in-ssh-tunneling](https://unix.stackexchange.com/questions/34499/are-there-disadvantages-in-ssh-tunneling)  
17. What limits are there on the number of reverse ssh tunnels? - Server Fault, accessed December 6, 2025, [https://serverfault.com/questions/358088/what-limits-are-there-on-the-number-of-reverse-ssh-tunnels](https://serverfault.com/questions/358088/what-limits-are-there-on-the-number-of-reverse-ssh-tunnels)  
18. Forward-SSH Tunnel Datastream Option Trouble - Google Developer forums, accessed December 7, 2025, [https://discuss.google.dev/t/forward-ssh-tunnel-datastream-option-trouble/143918](https://discuss.google.dev/t/forward-ssh-tunnel-datastream-option-trouble/143918)  
19. Configure Private Service Connect interfaces | Datastream - Google Cloud Documentation, accessed December 7, 2025, [https://docs.cloud.google.com/datastream/docs/psc-interfaces](https://docs.cloud.google.com/datastream/docs/psc-interfaces)  
20. Using PSC interfaces for managed service egress | Google Cloud Blog, accessed December 7, 2025, [https://cloud.google.com/blog/products/networking/using-psc-interfaces-for-managed-service-egress/](https://cloud.google.com/blog/products/networking/using-psc-interfaces-for-managed-service-egress/)  
21. Private Service Connect Interface | Google Codelabs, accessed December 7, 2025, [https://codelabs.developers.google.com/codelabs/psc-interface](https://codelabs.developers.google.com/codelabs/psc-interface)  
22. Unable to connect Datastream via PSC - Data Analytics - Google Developer forums, accessed December 7, 2025, [https://discuss.google.dev/t/unable-to-connect-datastream-via-psc/253612](https://discuss.google.dev/t/unable-to-connect-datastream-via-psc/253612)