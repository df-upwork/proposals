https://gemini.google.com/share/614528e2e886

## **Анализ рекомендации R⬆₁: Переход на ядро с размером страницы 64k**

### **Суть**

Рекомендация R⬆₁ заключается в фундаментальном изменении конфигурации управления памятью операционной системы путем замены стандартного ядра Linux с размером страницы 4 КБ на ядро, скомпилированное с поддержкой страниц размером 64 КБ (kernel-64k).1  
Архитектура процессоров AWS Graviton (основанная на ядрах ARM Neoverse N1 и V1) аппаратно поддерживает работу с гранулярностью страниц памяти 64 КБ, что теоретически позволяет снизить накладные расходы на трансляцию виртуальных адресов в физические.2  
Основной технической целью данного изменения является уменьшение нагрузки на буфер ассоциативной трансляции (TLB — Translation Lookaside Buffer) процессора, который представляет собой кэш для хранения недавних трансляций адресов.  
При работе с большими объемами оперативной памяти, характерными для серверов кэширования Varnish (десятки и сотни гигабайт), стандартный размер страницы 4 КБ приводит к необходимости хранения огромного количества записей в таблицах страниц (Page Tables).  
Увеличение размера страницы до 64 КБ позволяет одной записью TLB охватывать в 16 раз больший объем памяти, существенно снижая вероятность промахов кэша TLB (TLB miss) и уменьшая количество дорогостоящих операций обхода страниц (page walks).1  
Это изменение позиционируется как способ повышения пропускной способности памяти и снижения латентности для приложений с интенсивным использованием RAM, таких как базы данных (PostgreSQL, Redis) и кэширующие прокси (Varnish).3  
В контексте Amazon Linux 2023 реализация этой рекомендации подразумевает поиск и установку специализированного пакета ядра или использование альтернативного AMI (Amazon Machine Image), поддерживающего данную конфигурацию.

### **Оценка**

10

### **Достоинства**

Главным преимуществом использования страниц памяти размером 64 КБ является существенное снижение давления на подсистему управления памятью процессора (MMU) при работе с большими наборами данных (large working sets).1  
Уменьшение количества промахов TLB напрямую транслируется в снижение количества циклов процессора, затрачиваемых на ожидание доступа к памяти, что повышает общую производительность системы (IPC — Instructions Per Cycle).  
Для приложений, использующих последовательный доступ к большим блокам памяти, таких как Varnish при чтении и записи объектов в кэш, это может дать прирост производительности в диапазоне 10-20% в зависимости от паттерна нагрузки.1  
Снижение количества уровней в таблице страниц (page table levels) уменьшает латентность при обработке исключений отсутствия страницы (page faults).  
Использование 64k страниц позволяет более эффективно использовать предвыборку данных (prefetching) процессорами Graviton, оптимизируя работу с кэшем L1 и L2.  
В сценариях с высокой конкуренцией за ресурсы памяти между потоками Varnish уменьшение накладных расходов на управление страницами освобождает ресурсы для обработки непосредственно HTTP-запросов.

### **Недостатки**

Критическим недостатком данной рекомендации в контексте Amazon Linux 2023 является отсутствие штатной поддержки пакета kernel-64k в официальных репозиториях дистрибутива на текущий момент.4  
В отличие от Red Hat Enterprise Linux 9 (RHEL9) или Ubuntu 22.04/24.04, где пакеты kernel-64k или linux-aws-64k доступны для установки через стандартные менеджеры пакетов, AL2023 поставляет только стандартные ядра версии 6.1 и 6.12 с размером страницы 4 КБ.5  
Попытка выполнить команду dnf install kernel-64k в AL2023 приведет к ошибке отсутствия пакета, так как архитектура репозиториев AL2023 отличается от RHEL и CentOS Stream.7  
Самостоятельная компиляция ядра с флагом CONFIG_ARM64_64K_PAGES нарушает принцип использования управляемой ОС, лишает систему автоматических обновлений безопасности и выводит инфраструктуру из-под условий стандартной поддержки AWS.9  
Использование страниц 64 КБ приводит к увеличению внутренней фрагментации памяти (internal fragmentation), так как любой файл или объект размером менее 64 КБ все равно будет занимать полную страницу памяти.  
Для Varnish, который часто кэширует множество мелких объектов (CSS, JS, иконки), это может привести к неэффективному расходованию оперативной памяти и снижению эффективной емкости кэша.  
Существует риск несовместимости с некоторыми бинарными приложениями и библиотеками мониторинга, которые жестко завязаны на размер страницы 4 КБ (например, старые версии инструментов трассировки или специфичные модули Python).10  
Отсутствие готового и поддерживаемого AWS механизма переключения на ядро 64k в AL2023 делает эту рекомендацию практически невыполнимой без миграции на другую операционную систему, что выходит за рамки задачи оптимизации текущего стека.  
Файловая система и дисковые операции ввода-вывода могут демонстрировать неожиданное поведение или снижение производительности, если размер блока файловой системы не выровнен по границе 64 КБ.

## **Анализ рекомендации R⬆₂: Принудительное использование аллокатора jemalloc**

### **Суть**

Рекомендация R⬆₂ предписывает замену стандартного системного аллокатора памяти glibc malloc, используемого по умолчанию в большинстве дистрибутивов Linux, на альтернативный аллокатор jemalloc (Jason Evans' malloc) для процесса varnishd.11  
Varnish Cache интенсивно работает с динамической памятью, постоянно выделяя и освобождая блоки различного размера для хранения HTTP-объектов, заголовков и служебных структур.  
Стандартный аллокатор glibc оптимизирован для универсальных задач, но в условиях высокой многопоточной нагрузки (multithreaded workload), характерной для Varnish, он склонен к проблеме фрагментации кучи (heap fragmentation) и высокой конкуренции за блокировки (lock contention).12  
jemalloc использует дизайн, основанный на множественных аренах (arenas) и локальных кэшах потоков (thread-local cache - tcache), что позволяет минимизировать блокировки и более эффективно переиспользовать освобожденную память.11  
Внедрение jemalloc в Amazon Linux 2023 подразумевает установку соответствующей библиотеки и настройку Varnish на ее использование, так как пакет Varnish в репозиториях AL2023 может не быть слинкован с ней по умолчанию.14  
Суть рекомендации заключается в предотвращении постепенного роста потребления резидентной памяти (RSS creeping), который часто ошибочно принимают за утечку памяти, и в стабилизации работы сервиса под нагрузкой.

### **Оценка**

95

### **Достоинства**

Использование jemalloc доказало свою эффективность в борьбе с фрагментацией памяти в Varnish, позволяя поддерживать потребление RAM на уровне, близком к заданному параметром -s malloc.11  
Архитектура jemalloc значительно снижает накладные расходы на синхронизацию потоков при выделении памяти, что критично для Varnish, запускающего сотни worker-потоков на многоядерных процессорах Graviton.16  
Аллокатор предоставляет расширенные возможности профилирования и интроспекции памяти, что позволяет инженерам детально анализировать паттерны потребления ресурсов.  
jemalloc активно возвращает неиспользуемые страницы памяти операционной системе (через madvise), предотвращая ситуацию, когда процесс удерживает гигабайты свободной памяти, недоступной другим приложениям.17  
В тестах производительности на Linux-системах jemalloc демонстрирует более предсказуемую латентность и меньшее количество пауз, связанных с управлением памятью, по сравнению с glibc.11  
Возможность тонкой настройки поведения аллокатора через переменную окружения MALLOC_CONF (например, параметры dirty_decay_ms и muzzy_decay_ms) позволяет адаптировать стратегию освобождения памяти под конкретный профиль нагрузки.18  
Использование jemalloc является рекомендованной практикой ("best practice") от разработчиков Varnish Software и широкого сообщества пользователей высоконагруженных систем.11

### **Недостатки**

В дистрибутиве Amazon Linux 2023 пакет jemalloc присутствует в репозиториях, но не устанавливается автоматически как зависимость пакета varnish, требуя явных действий администратора.14  
Если используемая версия Varnish была скомпилирована без явной поддержки jemalloc на этапе сборки (static linking), простого наличия библиотеки в системе недостаточно для ее активации.  
Неправильная конфигурация параметров jemalloc (например, слишком агрессивный возврат памяти OS) может привести к увеличению нагрузки на CPU из-за частых системных вызовов (system calls) и page faults.  
Отладка проблем с памятью может усложниться, так как стандартные инструменты диагностики glibc (например, mtrace) не будут работать с jemalloc.  
Существует риск конфликта версий, если сторонние VMOD (модули Varnish) были скомпилированы с расчетом на другой аллокатор, хотя это случается крайне редко.  
Необходимо внедрение механизма проверки того, что Varnish действительно использует jemalloc после перезапуска (например, через анализ /proc/<pid>/smaps), так как тихий отказ (silent failure) вернет систему к использованию glibc.20

## **Анализ рекомендации R⬆₃: Инъекция jemalloc через Systemd Override и LD_PRELOAD**

### **Суть**

Данная рекомендация описывает конкретный технический метод реализации предыдущей рекомендации (R⬆₂) в условиях операционной системы AL2023, использующей систему инициализации systemd.  
Поскольку пересборка RPM-пакета Varnish из исходных кодов для линковки с jemalloc является трудоемкой и усложняет процесс обновлений, предлагается использовать механизм динамической подгрузки библиотек LD_PRELOAD.21  
Переменная окружения LD_PRELOAD указывает динамическому загрузчику (dynamic linker) на необходимость загрузить указанную разделяемую библиотеку (shared object) перед всеми остальными, что позволяет перехватить вызовы функций malloc, calloc, realloc и free.  
Для реализации этого метода в контексте systemd используется команда systemctl edit varnish, которая создает файл переопределения (drop-in override file), например /etc/systemd/system/varnish.service.d/override.conf.22  
В этом файле прописывается директива Environment="LD_PRELOAD=/usr/lib64/libjemalloc.so.2", указывающая путь к библиотеке, установленной из репозитория AL2023.23  
Этот подход позволяет внедрить jemalloc в процесс varnishd без модификации бинарных файлов и без изменения основного юнит-файла сервиса, который может быть перезаписан при обновлении пакета.

### **Оценка**

90

### **Достоинства**

Метод LD_PRELOAD является универсальным и работает с любыми динамически скомпонованными бинарными файлами, что делает его применимым к стандартным пакетам Varnish в AL2023.  
Использование systemd drop-in replacement обеспечивает персистентность конфигурации: настройки сохраняются даже после обновления пакета varnish через dnf update.24  
Позволяет гибко управлять версией используемой библиотеки jemalloc, просто меняя путь в файле конфигурации, независимо от версии самого Varnish.  
Данный метод не требует установки инструментов компиляции (gcc, make) и заголовочных файлов на продакшн-серверах, что повышает безопасность системы.  
Конфигурация легко обратима: достаточно удалить файл override или закомментировать строку, чтобы вернуться к стандартному аллокатору glibc в случае возникновения проблем.  
Позволяет передавать дополнительные параметры настройки jemalloc через переменную окружения MALLOC_CONF в том же файле конфигурации systemd.18

### **Недостатки**

Критически важно указать правильный абсолютный путь к библиотеке libjemalloc.so, который может различаться в зависимости от архитектуры (aarch64 vs x86_64) и версии пакета в AL2023 (/usr/lib64/ vs /usr/lib/).23  
Ошибка в пути к файлу в LD_PRELOAD может привести к тому, что библиотека не будет загружена (игнорируется линковщиком), при этом сервис запустится с glibc без явных ошибок, создавая ложное чувство защищенности.25  
В системах с включенным SELinux (который в AL2023 по умолчанию находится в режиме Permissive, но может быть переведен в Enforcing) инъекция библиотек может блокироваться политиками безопасности, требуя настройки контекстов.26  
Если бинарный файл varnishd запускается через промежуточные скрипты-обертки или с использованием смены идентификатора пользователя (SUID), переменная LD_PRELOAD может быть очищена системой безопасности ядра.28  
Обновление пакета jemalloc в системе может изменить имя файла библиотеки (например, libjemalloc.so.2 станет libjemalloc.so.3), что потребует ручного обновления конфигурации systemd, иначе сервис может не запуститься.  
Необходимость проверки логов (journalctl) и карт памяти процесса (/proc/.../maps) после настройки для подтверждения успешной подгрузки библиотеки.20

## **Анализ рекомендации R⬆₄: Очистка Query String от трекинговых параметров (UTM, gclid)**

### **Суть**

Рекомендация R⬆₄ направлена на оптимизацию коэффициента попадания в кэш (Cache Hit Rate) путем нормализации URL входящих запросов на уровне VCL (Varnish Configuration Language).  
Маркетинговые платформы (Google Ads, Facebook, Email-рассылки) добавляют к URL уникальные параметры запроса, такие как gclid, fbclid, utm_source, utm_medium и mc_eid, для отслеживания эффективности рекламы.29  
По умолчанию Varnish считает полные URL (включая строку запроса) уникальными ключами кэширования, поэтому запросы /page?gclid=A и /page?gclid=B будут считаться разными объектами, вызывая дублирование кэша и лишние запросы к бэкенду.31  
Суть рекомендации заключается в использовании функции regsuball внутри подпрограммы vcl_recv для удаления этих параметров из req.url до того, как будет вычислен хэш запроса.32  
Поскольку эти параметры обычно обрабатываются клиентским JavaScript (например, скриптом Google Analytics) в браузере пользователя, их удаление на стороне прокси-сервера не влияет на корректность сбора статистики, но критически важно для эффективности кэширования.

### **Оценка**

100

### **Достоинства**

Реализация данной рекомендации обеспечивает кардинальное повышение эффективности кэширования для трафика, приходящего из рекламных каналов и социальных сетей.  
Устраняется проблема "cache bloat" (раздувание кэша), когда оперативная память сервера забивается миллионами копий одной и той же страницы, отличающихся только метками трекинга.29  
Снижается нагрузка на бэкенд-серверы (PHP, Python, Node.js), так как Varnish начинает отдавать закэшированный контент для всех пользователей рекламной кампании, вместо того чтобы проксировать каждый уникальный клик.34  
Улучшается время отклика (TTFB) для пользователей, переходящих по рекламе, так как вероятность попадания в "горячий" кэш значительно возрастает.  
Решение реализуется полностью на уровне конфигурации Varnish, не требуя изменений в коде приложения.  
Гибкость VCL позволяет настроить список удаляемых параметров (белый или черный список), сохраняя функциональные параметры, необходимые приложению (например, page, sort, filter).35

### **Недостатки**

Написание регулярных выражений (regex) требует высокой точности: ошибка в синтаксисе может привести к удалению нужных параметров или формированию некорректных URL (например, оставшиеся висячие символы ? или &).37  
Список маркетинговых параметров постоянно расширяется (например, появление ttclid от TikTok или wbraid), что требует регулярного обновления конфигурации VCL для поддержания эффективности.32  
Использование сложных регулярных выражений на каждом входящем запросе создает небольшую дополнительную нагрузку на CPU, хотя в Varnish 7.x движок PCRE JIT работает чрезвычайно быстро.39  
Если бэкенд-приложение использует серверную логику, зависящую от UTM-меток (например, подмена контента для конкретной рекламной кампании на сервере), удаление этих параметров сломает эту функциональность.  
Необходимо тщательное тестирование, чтобы убедиться, что удаление параметров не затрагивает функциональные параметры с похожими именами (ложные срабатывания).

## **Анализ рекомендации R⬆₅: Нормализация заголовка User-Agent**

### **Суть**

Рекомендация R⬆₅ касается обработки заголовка User-Agent (UA), который браузеры отправляют с каждым запросом, сообщая информацию о версии браузера, операционной системе и типе устройства.  
Строки User-Agent обладают чрезвычайно высокой вариативностью (тысячи уникальных комбинаций версий Chrome, Safari, Android и т.д.), что делает их непригодными для прямого использования в ключе кэширования.40  
Если бэкенд-приложение отдает разный HTML-код для мобильных и десктопных устройств и использует заголовок Vary: User-Agent для управления кэшированием, Varnish будет создавать отдельную копию страницы для каждого уникального UA, что приведет к катастрофическому падению hit rate.41  
Суть рекомендации заключается в "нормализации" заголовка User-Agent в vcl_recv: анализ исходной строки и замена её на упрощенный маркер, например, "mobile", "tablet" или "desktop".40  
Затем этот нормализованный заголовок (часто сохраняемый как X-UA-Device) используется для формирования ключа кэша или передается на бэкенд, позволяя кэшировать всего 2-3 вариации страницы вместо тысяч.

### **Оценка**

98

### **Достоинства**

Нормализация User-Agent является единственным способом обеспечить эффективное кэширование для сайтов, использующих технику RESS (Responsive Server Side) или отдающих различный контент в зависимости от типа устройства.43  
Позволяет защитить кэш от фрагментации, вызванной обновлением версий браузеров у пользователей (например, выход нового Chrome не инвалидирует кэш для всех пользователей Chrome).  
Упрощает логику на стороне бэкенда, который получает чистый и понятный заголовок типа X-UA-Device вместо необходимости парсить сложные строки UA самостоятельно.44  
Позволяет реализовать логику перенаправления мобильных пользователей на поддомен (m.example.com) или выбора другого бэкенда на уровне Varnish с высокой производительностью.40  
Существуют готовые модули (VMODs) и VCL-снппеты (например, devicedetect.vcl), облегчающие внедрение этой функциональности.45

### **Недостатки**

Поддержание актуальной базы сигнатур User-Agent (regex) для определения новых устройств и браузеров требует постоянных усилий и обновлений конфигурации.  
Ошибка в логике детектирования может привести к тому, что десктопный пользователь получит мобильную версию сайта (или наоборот), и эта ошибка будет закэширована для всех пользователей данной группы.47  
Процесс сопоставления User-Agent с большим списком регулярных выражений потребляет ресурсы CPU на каждом запросе.  
Если веб-сайт использует современный адаптивный дизайн (Responsive Web Design), отдавая абсолютно одинаковый HTML-код для всех устройств и управляя отображением только через CSS/Media Queries, данная рекомендация является избыточной и ненужной.48  
Искусственное добавление вариативности (Vary: X-UA-Device) там, где она не нужна, снижает эффективность использования памяти кэша.

## **Анализ рекомендации R⬆₆: Сортировка параметров запроса (std.querysort)**

### **Суть**

Рекомендация R⬆₆ предлагает использовать функцию std.querysort(req.url) из стандартного модуля Varnish (vmod_std) для алфавитной сортировки параметров в строке запроса (Query String) перед кэшированием.32  
По стандарту HTTP порядок параметров в URL не должен влиять на семантику запроса (т.е. /api?a=1&b=2 и /api?b=2&a=1 должны возвращать один и тот же результат).  
Однако для Varnish эти две строки являются разными ключами, что приводит к созданию двух разных объектов в кэше.  
Такая ситуация часто возникает при генерации ссылок различными фронтенд-компонентами, внешними системами или при ручном вводе.  
Применение std.querysort приводит параметры к каноническому (алфавитному) порядку, гарантируя, что семантически идентичные запросы будут соответствовать одному и тому же объекту в кэше.50

### **Оценка**

90

### **Достоинства**

Устраняет неявное дублирование кэша, вызванное хаотичным порядком параметров, что особенно актуально для API-эндпоинтов и сложных поисковых фильтров.31  
Повышает коэффициент попадания в кэш (Hit Rate) за счет нормализации запросов.  
Является нативной функцией Varnish, написанной на C, поэтому работает значительно быстрее и надежнее, чем попытки реализовать сортировку с помощью регулярных выражений в VCL.39  
Внедрение требует минимальных усилий: достаточно одной строки в конфигурации vcl_recv (после импорта модуля std).51  
Помогает защитить бэкенд от атак типа "cache busting" с использованием перестановки параметров.

### **Недостатки**

Существует теоретический риск нарушения работы бэкенд-приложений, которые некорректно реализованы и полагаются на фиксированный порядок параметров (например, ожидают ?id=1&action=delete именно в таком порядке), хотя это противоречит стандартам веб-разработки.35  
Требует обязательного наличия import std; в начале VCL-файла, отсутствие которого приведет к ошибке компиляции конфигурации и отказу сервиса при перезапуске.51  
Функция сортирует все параметры, поэтому, если какие-то параметры должны быть удалены (как в рекомендации R⬆₄), сортировку лучше выполнять после очистки, чтобы не тратить ресурсы на сортировку мусорных данных.39  
Для статического контента без параметров запроса вызов функции является лишней операцией, хотя накладные расходы минимальны.

## **Вердикт**

На основании детального анализа представленных рекомендаций в контексте эксплуатации Varnish Cache на Amazon Linux 2023 (Graviton/ARM64), экспертное заключение сводится к следующему.

Рекомендации по управлению памятью имеют наивысший приоритет, но требуют адаптации к реалиям AL2023.  
Внедрение jemalloc (R⬆₂, R⬆₃) является критически важным и обязательным шагом.  
Стандартный аллокатор glibc демонстрирует неприемлемые показатели фрагментации на многопоточных нагрузках, что гарантированно приведет к нестабильности сервиса.  
Поскольку пакет varnish в AL2023 может не иметь встроенной поддержки jemalloc, использование метода инъекции через systemd override с переменной LD_PRELOAD признается наиболее надежным, безопасным и поддерживаемым способом реализации («best practice» для данного окружения).  
Рекомендации по оптимизации VCL (R⬆₄, R⬆₆) являются стандартом де-факто для любой публичной инсталляции Varnish.  
Очистка трекинговых параметров и нормализация запросов — это фундаментальные гигиенические меры, без которых кэш будет неэффективен из-за дублирования контента.  
Эти настройки должны быть применены в первую очередь.  
Рекомендация по нормализации User-Agent (R⬆₅) является условно полезной.  
Она обязательна только в том случае, если бэкенд действительно отдает разный контент для разных устройств.  
В противном случае она вносит избыточную сложность.  
Рекомендация по переходу на ядро 64k (R⬆₁) признана нецелесообразной для текущей версии Amazon Linux 2023.  
Несмотря на теоретические преимущества архитектуры Graviton, экосистема AL2023 на данный момент не предоставляет готовых инструментов (пакетов ядра) для безопасного и поддерживаемого внедрения этого изменения.  
Риски, связанные с самостоятельной сборкой ядра и поддержкой нестандартной конфигурации, многократно перевешивают потенциальный выигрыш в производительности.  
Инженерам рекомендуется оставаться на стандартном ядре 4k, сосредоточившись на оптимизации на уровне приложения (Varnish) и аллокатора памяти.

#### **Works cited**

1. Improve Performance with 64K Memory Pages on AWS Graviton Processors, accessed December 11, 2025, [https://dev.to/aws-builders/improve-performance-with-64k-memory-pages-on-aws-graviton-processors-ifa](https://dev.to/aws-builders/improve-performance-with-64k-memory-pages-on-aws-graviton-processors-ifa)  
2. AWS Graviton Processor - Amazon EC2, accessed December 11, 2025, [https://aws.amazon.com/ec2/graviton/](https://aws.amazon.com/ec2/graviton/)  
3. Install 64k page kernel on ARM64 instances - Ubuntu on AWS documentation, accessed December 11, 2025, [https://documentation.ubuntu.com/aws/aws-how-to/instances/install-64k-kernel/](https://documentation.ubuntu.com/aws/aws-how-to/instances/install-64k-kernel/)  
4. Graviton arm64 / aarch64 EC2 instance types with 64k pagesize? - AWS re:Post, accessed December 11, 2025, [https://repost.aws/questions/QUlK_MQuthTKWWlviBv2xv8g/graviton-arm64-aarch64-ec2-instance-types-with-64k-pagesize](https://repost.aws/questions/QUlK_MQuthTKWWlviBv2xv8g/graviton-arm64-aarch64-ec2-instance-types-with-64k-pagesize)  
5. Updating the Linux kernel on AL2023 - AWS Documentation, accessed December 11, 2025, [https://docs.aws.amazon.com/linux/al2023/ug/kernel-update.html](https://docs.aws.amazon.com/linux/al2023/ug/kernel-update.html)  
6. All Amazon Linux 2023 packages, accessed December 11, 2025, [https://docs.aws.amazon.com/linux/al2023/release-notes/all-packages.html](https://docs.aws.amazon.com/linux/al2023/release-notes/all-packages.html)  
7. Driver Installation Guide | PDF | Linux - Scribd, accessed December 11, 2025, [https://www.scribd.com/document/934953239/Driver-Installation-Guide](https://www.scribd.com/document/934953239/Driver-Installation-Guide)  
8. Moderate: Red Hat Security Advisory: kernel security update - Vulners.com, accessed December 11, 2025, [https://vulners.com/redhat/RHSA-2025:21112?utm_source=rss&utm_medium=rss&utm_campaign=rss&utm_source=feedly](https://vulners.com/redhat/RHSA-2025:21112?utm_source=rss&utm_medium=rss&utm_campaign=rss&utm_source=feedly)  
9. AL2023 kernel changes from AL2 - Amazon Linux 2023 - AWS Documentation, accessed December 11, 2025, [https://docs.aws.amazon.com/linux/al2023/ug/compare-with-al2-kernel.html](https://docs.aws.amazon.com/linux/al2023/ug/compare-with-al2-kernel.html)  
10. mmap fails on 64k page aarch64 systems for AOTI model loading · Issue #145610 - GitHub, accessed December 11, 2025, [https://github.com/pytorch/pytorch/issues/145610](https://github.com/pytorch/pytorch/issues/145610)  
11. Understanding Varnish Cache Memory Usage - Resources, accessed December 11, 2025, [https://info.varnish-software.com/blog/understanding-varnish-cache-memory-usage](https://info.varnish-software.com/blog/understanding-varnish-cache-memory-usage)  
12. jemalloc vs glibc malloc: Memory Allocation Performance Comparison | by Binita Bharati, accessed December 11, 2025, [https://medium.com/@binitabharati/jemalloc-vs-glibc-malloc-memory-allocation-performance-comparison-fbaeda1740de](https://medium.com/@binitabharati/jemalloc-vs-glibc-malloc-memory-allocation-performance-comparison-fbaeda1740de)  
13. CPU and memory usage of jemalloc as compared to glibc malloc - Stack Overflow, accessed December 11, 2025, [https://stackoverflow.com/questions/13027475/cpu-and-memory-usage-of-jemalloc-as-compared-to-glibc-malloc](https://stackoverflow.com/questions/13027475/cpu-and-memory-usage-of-jemalloc-as-compared-to-glibc-malloc)  
14. Amazon Linux 2023 version 2023.0.20230503 release notes, accessed December 11, 2025, [https://docs.aws.amazon.com/linux/al2023/release-notes/relnotes-2023.0.20230503.html](https://docs.aws.amazon.com/linux/al2023/release-notes/relnotes-2023.0.20230503.html)  
15. Understanding Varnish Cache Memory Usage, accessed December 11, 2025, [https://varnish-software.medium.com/understanding-varnish-cache-memory-usage-6f1cab5e20ff](https://varnish-software.medium.com/understanding-varnish-cache-memory-usage-6f1cab5e20ff)  
16. Varnish duplicate process 170 once - Unix & Linux Stack Exchange, accessed December 11, 2025, [https://unix.stackexchange.com/questions/632427/varnish-duplicate-process-170-once](https://unix.stackexchange.com/questions/632427/varnish-duplicate-process-170-once)  
17. Switching to jemalloc instantly fixed an irksome memory leak in an embedded Linu... | Hacker News, accessed December 11, 2025, [https://news.ycombinator.com/item?id=44265524](https://news.ycombinator.com/item?id=44265524)  
18. Varnish 6 LTS /w CentOS 8 not respecting memory limits? - Stack Overflow, accessed December 11, 2025, [https://stackoverflow.com/questions/65450044/varnish-6-lts-w-centos-8-not-respecting-memory-limits](https://stackoverflow.com/questions/65450044/varnish-6-lts-w-centos-8-not-respecting-memory-limits)  
19. 1656034 – Varnish is compiled without jemalloc. jemalloc is missing. - Red Hat Bugzilla, accessed December 11, 2025, [https://bugzilla.redhat.com/show_bug.cgi?id=1656034](https://bugzilla.redhat.com/show_bug.cgi?id=1656034)  
20. Verify jemalloc in use at runtime? · Issue #388 - GitHub, accessed December 11, 2025, [https://github.com/jemalloc/jemalloc/issues/388](https://github.com/jemalloc/jemalloc/issues/388)  
21. Getting Started · jemalloc/jemalloc Wiki - GitHub, accessed December 11, 2025, [https://github.com/jemalloc/jemalloc/wiki/getting-started](https://github.com/jemalloc/jemalloc/wiki/getting-started)  
22. Configuring Varnish systemd services - Varnish Developer Portal, accessed December 11, 2025, [https://www.varnish-software.com/developers/tutorials/configuring-varnish-systemd-services/](https://www.varnish-software.com/developers/tutorials/configuring-varnish-systemd-services/)  
23. MariaDB & Amazon Linux 2: ERROR: ld.so: object '/usr/lib64/libjemalloc.so.1' from LD_PRELOAD cannot be preloaded, accessed December 11, 2025, [https://unix.stackexchange.com/questions/677387/mariadb-amazon-linux-2-error-ld-so-object-usr-lib64-libjemalloc-so-1-fro](https://unix.stackexchange.com/questions/677387/mariadb-amazon-linux-2-error-ld-so-object-usr-lib64-libjemalloc-so-1-fro)  
24. Configuring systemd services - Varnish Developer Portal, accessed December 11, 2025, [https://www.varnish-software.com/developers/tutorials/configuring-systemd-services/](https://www.varnish-software.com/developers/tutorials/configuring-systemd-services/)  
25. MySQL ignore LD_PRELOAD - Unix & Linux Stack Exchange, accessed December 11, 2025, [https://unix.stackexchange.com/questions/755151/mysql-ignore-ld-preload](https://unix.stackexchange.com/questions/755151/mysql-ignore-ld-preload)  
26. AL2023 Kernel Hardening - Amazon Linux 2023, accessed December 11, 2025, [https://docs.aws.amazon.com/linux/al2023/ug/kernel-hardening.html](https://docs.aws.amazon.com/linux/al2023/ug/kernel-hardening.html)  
27. 1892552 – vanish fails to start with default configuration (VCL compilation failed) - Red Hat Bugzilla, accessed December 11, 2025, [https://bugzilla.redhat.com/show_bug.cgi?id=1892552](https://bugzilla.redhat.com/show_bug.cgi?id=1892552)  
28. How to set LD_PRELOAD in systemd - linux - Stack Overflow, accessed December 11, 2025, [https://stackoverflow.com/questions/72020602/how-to-set-ld-preload-in-systemd](https://stackoverflow.com/questions/72020602/how-to-set-ld-preload-in-systemd)  
29. Stripping query strings in Varnish | Acquia Product Documentation, accessed December 11, 2025, [https://docs.acquia.com/acquia-cloud-platform/stripping-query-strings-varnish](https://docs.acquia.com/acquia-cloud-platform/stripping-query-strings-varnish)  
30. Strip marketing or analytics query parameters with Varnish - GetPageSpeed, accessed December 11, 2025, [https://www.getpagespeed.com/server-setup/varnish/strip-query-parameters-varnish](https://www.getpagespeed.com/server-setup/varnish/strip-query-parameters-varnish)  
31. Tweaking the Varnish Cache - 8th Light, accessed December 11, 2025, [https://8thlight.com/insights/tweaking-the-varnish-cache](https://8thlight.com/insights/tweaking-the-varnish-cache)  
32. Example VCL template - Varnish Developer Portal, accessed December 11, 2025, [https://www.varnish-software.com/developers/tutorials/example-vcl-template/](https://www.varnish-software.com/developers/tutorials/example-vcl-template/)  
33. Strip query parameters with Varnish | by Danila Vershinin - Medium, accessed December 11, 2025, [https://medium.com/@getpagespeed/strip-query-parameters-with-varnish-bf3cb2877530](https://medium.com/@getpagespeed/strip-query-parameters-with-varnish-bf3cb2877530)  
34. 5 Don'ts When Caching with Varnish - Resources, accessed December 11, 2025, [https://info.varnish-software.com/blog/5-varnish-donts](https://info.varnish-software.com/blog/5-varnish-donts)  
35. Best Practices for Caching a Paginated Blog Search Results Page with Varnish, accessed December 11, 2025, [https://serverfault.com/questions/1168034/best-practices-for-caching-a-paginated-blog-search-results-page-with-varnish](https://serverfault.com/questions/1168034/best-practices-for-caching-a-paginated-blog-search-results-page-with-varnish)  
36. Stripping out select querystring attribute/value pairs so varnish will not vary cache by them, accessed December 11, 2025, [https://stackoverflow.com/questions/13144172/stripping-out-select-querystring-attribute-value-pairs-so-varnish-will-not-vary](https://stackoverflow.com/questions/13144172/stripping-out-select-querystring-attribute-value-pairs-so-varnish-will-not-vary)  
37. How to strip UTM tags in Varnish without stripping queries I want? - Stack Overflow, accessed December 11, 2025, [https://stackoverflow.com/questions/75871726/how-to-strip-utm-tags-in-varnish-without-stripping-queries-i-want](https://stackoverflow.com/questions/75871726/how-to-strip-utm-tags-in-varnish-without-stripping-queries-i-want)  
38. Varnish VCL: does not exclude Google Campaign URLS · Issue #10087 · magento/magento2 - GitHub, accessed December 11, 2025, [https://github.com/magento/magento2/issues/10087](https://github.com/magento/magento2/issues/10087)  
39. PSA: You don't need that many regexes - Resources - Varnish Software, accessed December 11, 2025, [https://info.varnish-software.com/blog/psa-you-dont-need-that-many-regexes](https://info.varnish-software.com/blog/psa-you-dont-need-that-many-regexes)  
40. Configuring Varnish Cache to Work with Mobile Devices - Atomic Spin, accessed December 11, 2025, [https://spin.atomicobject.com/varnish-cache-mobile-devices/](https://spin.atomicobject.com/varnish-cache-mobile-devices/)  
41. 10 Varnish Cache mistakes and how to avoid them, accessed December 11, 2025, [https://varnish-software.medium.com/10-varnish-cache-mistakes-and-how-to-avoid-them-d240f452ab35](https://varnish-software.medium.com/10-varnish-cache-mistakes-and-how-to-avoid-them-d240f452ab35)  
42. Device detection — Varnish version 3.0.7 documentation, accessed December 11, 2025, [https://varnish-cache.org/docs/3.0/tutorial/devicedetection.html](https://varnish-cache.org/docs/3.0/tutorial/devicedetection.html)  
43. Magento 2 : Varnish Cache based on user agents - Stack Overflow, accessed December 11, 2025, [https://stackoverflow.com/questions/49775906/magento-2-varnish-cache-based-on-user-agents](https://stackoverflow.com/questions/49775906/magento-2-varnish-cache-based-on-user-agents)  
44. willemk/varnish-mobiletranslate: Tool to translate the latest mobile detect script into varnish, accessed December 11, 2025, [https://github.com/willemk/varnish-mobiletranslate](https://github.com/willemk/varnish-mobiletranslate)  
45. INSTALL.rst - varnishcache/varnish-devicedetect - GitHub, accessed December 11, 2025, [https://github.com/varnishcache/varnish-devicedetect/blob/master/INSTALL.rst](https://github.com/varnishcache/varnish-devicedetect/blob/master/INSTALL.rst)  
46. Device detection — Varnish version 4.0.5 documentation, accessed December 11, 2025, [https://varnish-cache.org/docs/4.0/users-guide/devicedetection.html](https://varnish-cache.org/docs/4.0/users-guide/devicedetection.html)  
47. Magento 2 Varnish Device Detection, accessed December 11, 2025, [https://www.scommerce-mage.com/blog/magento-2-varnish-device-detection.html](https://www.scommerce-mage.com/blog/magento-2-varnish-device-detection.html)  
48. Vary — Varnish version 3.0.7 documentation, accessed December 11, 2025, [https://varnish-cache.org/docs/3.0/tutorial/vary.html](https://varnish-cache.org/docs/3.0/tutorial/vary.html)  
49. vmod_std — Varnish version 6.0.16 documentation, accessed December 11, 2025, [https://varnish-cache.org/docs/6.0/reference/vmod_generated.html](https://varnish-cache.org/docs/6.0/reference/vmod_generated.html)  
50. Varnish Explained - Mattias Geniar, accessed December 11, 2025, [https://ma.ttias.be/varnish-explained/](https://ma.ttias.be/varnish-explained/)  
51. Varnish VCL "Symbol not found: std.querysort" - Stack Overflow, accessed December 11, 2025, [https://stackoverflow.com/questions/36012266/varnish-vcl-symbol-not-found-std-querysort](https://stackoverflow.com/questions/36012266/varnish-vcl-symbol-not-found-std-querysort)  
52. Varnish Configuration Language (VCL) - Varnish Developer Portal, accessed December 11, 2025, [https://www.varnish-software.com/developers/tutorials/varnish-configuration-language-vcl/](https://www.varnish-software.com/developers/tutorials/varnish-configuration-language-vcl/)