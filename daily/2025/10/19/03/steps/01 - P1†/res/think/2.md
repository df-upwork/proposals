Ниже представлен анализ возможных причин (`C2ᛘ⠿`) проблемы `P1†` («Memcache crashing & not automatically restarting»).

## C2ᛘ₁: Принудительное завершение процесса OOM Killer из-за нехватки памяти

### Суть
На виртуальном сервере (VPS) исчерпывается доступная оперативная память (RAM).
Ядро Linux активирует механизм OOM (Out-Of-Memory) Killer, чтобы предотвратить полный отказ системы.
OOM Killer выбирает процесс, потребляющий значительный объем памяти, и принудительно завершает его сигналом SIGKILL.
Memcached, хранящий данные в памяти, является вероятной целью (Source 1.3).

### Оценка (§2.3)
90/100

### Доводы за (§2.2.1)
Клиент использует ресурсоемкий стек (WHM/cPanel, Apache, MySQL 8.x, PHP 8.x, WordPress) в ограниченной среде VPS.
Клиент сообщает о «consistent DB access and stability issues» и `P2†` («Excessive MySQL DB Connection errors»).
Эти симптомы являются сильными индикаторами общей нехватки памяти, так как высокая нагрузка от PHP и Apache часто приводит к исчерпанию RAM и активации OOM Killer (Source 1.2, 1.4).
Внезапное исчезновение процесса без регистрации ошибок в собственном журнале характерно для завершения через SIGKILL.

### Доводы против (§2.2.2)
У нас нет данных о фактическом объеме RAM на VPS и метриках потребления памяти в момент сбоя.

## C2ᛘ₂: Срабатывание защиты от циклического перезапуска Systemd (Rate Limiting)

### Суть
Systemd настроен на автоматический перезапуск Memcached (например, с помощью `Restart=always`).
Однако из-за сохраняющейся основной проблемы (например, критической нехватки памяти C2ᛘ₁) служба падает сразу после перезапуска.
Systemd имеет встроенные механизмы защиты (определяемые параметрами `StartLimitIntervalSec` и `StartLimitBurst`), которые предотвращают бесконечный цикл перезапуска (crash loop) (Source 4.1).
Если служба падает слишком часто за короткий интервал (по умолчанию 5 раз за 10 секунд в старых версиях Systemd), Systemd прекращает попытки её перезапуска и оставляет в состоянии "failed" (Source 4.1, 4.2).

### Оценка (§2.3)
80/100

### Доводы за (§2.2.1)
Эта гипотеза объясняет компонент «not automatically restarting», даже если перезапуск настроен корректно.
Это очень вероятный сценарий при постоянном давлении на память: OOM Killer убивает Memcached, Systemd его перезапускает, OOM Killer снова убивает, пока не сработает лимит Systemd.
В CentOS 7 используется более старая версия Systemd, где параметры могли называться `StartLimitInterval` (Source 4.4), но логика остается той же.

### Доводы против (§2.2.2)
Если сбои происходят с длительными интервалами, этот механизм защиты не должен активироваться.
Эта гипотеза предполагает, что автоматический перезапуск настроен (противоречит C2ᛘ₃ и C2ᛘ₄).

## C2ᛘ₃: Отсутствие мониторинга в WHM/cPanel (chkservd)

### Суть
WHM/cPanel использует собственный демон мониторинга `chkservd` (управляемый TailWatch) для отслеживания состояния и перезапуска служб (Source 2.1).
Если служба Memcached не настроена для мониторинга в WHM Service Manager или через конфигурационные файлы `/etc/chkserv.d/` (Source 2.2, 2.3), `chkservd` не будет знать о её состоянии.
После сбоя Memcached (например, из-за C2ᛘ₁) `chkservd` не попытается его перезапустить.

### Оценка (§2.3)
75/100

### Доводы за (§2.2.1)
Эта гипотеза объясняет компонент «not automatically restarting».
В среде WHM/cPanel это основной механизм обеспечения доступности служб.
Если Memcached был установлен вручную или нестандартным способом, он может отсутствовать в конфигурации мониторинга WHM (Source 2.3).

### Доводы против (§2.2.2)
Если конфигурация Systemd (C2ᛘ₄) настроена правильно (`Restart=always`), служба может перезапуститься независимо от состояния мониторинга `chkservd`.

## C2ᛘ₄: Некорректная конфигурация службы в Systemd

### Суть
CentOS 7 использует Systemd для управления службами.
Конфигурационный файл службы Memcached (unit file) не содержит корректных инструкций по автоматическому перезапуску.
Директива `Restart=` может отсутствовать или быть настроена неадекватно для ситуации сбоя.

### Оценка (§2.3)
70/100

### Доводы за (§2.2.1)
Эта гипотеза объясняет компонент «not automatically restarting».
Стандартные конфигурации пакетов не всегда включают автоматический перезапуск по умолчанию.
Хотя Systemd может перезапускать службу при некоторых условиях сбоя, для надежного перезапуска при любом завершении, включая SIGKILL (от OOM Killer), рекомендуется использовать `Restart=always` (Source 3.1).

### Доводы против (§2.2.2)
В среде WHM/cPanel механизм `chkservd` (C2ᛘ₃) может иметь приоритет или конфликтовать с настройками Systemd.
Некоторые конфигурации (например, `Restart=on-failure`) могут срабатывать даже при OOM kill (Source 3.2).

## C2ᛘ₅: Проблемы совместимости PHP-расширений (Memcache vs Memcached)

### Суть
Существуют два разных расширения PHP PECL: `memcache` (старое) и `memcached` (новое) (Source 5.2, 5.3).
Расширение `memcache` несовместимо с PHP 7+ и, следовательно, с PHP 8.x, используемым клиентом (Source 5.1).
Если WordPress или его плагины пытаются использовать старое расширение `memcache`, объектное кэширование работать не будет.
Это приводит к значительному увеличению нагрузки на базу данных, усугубляя `P2†` и повышая вероятность C2ᛘ₁.

### Оценка (§2.3)
40/100

### Доводы за (§2.2.1)
Клиент использует PHP 8.x на CentOS 7, что является нетривиальной конфигурацией.
Путаница между этими двумя расширениями распространена (Source 5.2).
Если кэширование фактически не работает из-за этой ошибки, это объясняет высокую нагрузку на систему и проблемы с MySQL.

### Доводы против (§2.2.2)
Эта проблема не должна приводить к аварийному завершению самого демона Memcached.
Она вызывает ошибки на уровне PHP-приложения, а не сбой службы.

# 2.4. Вердикт

Анализ показывает, что проблема `P1†` почти наверняка вызвана комбинацией факторов, связанных с истощением ресурсов сервера и конфигурацией управления службами.

Наиболее вероятная причина сбоев («crashing»):
**C2ᛘ₁ (OOM Killer)**. С очень высокой вероятностью (90%) стек программного обеспечения (WHM, MySQL 8, PHP 8, WordPress) потребляет больше оперативной памяти, чем доступно на VPS. Это приводит к активации OOM Killer, который принудительно завершает Memcached. Сопутствующие проблемы со стабильностью и `P2†` (ошибки подключения к MySQL) подтверждают гипотезу о системной нехватке ресурсов.

Наиболее вероятные причины отсутствия автоматического перезапуска («not automatically restarting»):
Существует три равновероятных сценария:
1. **C2ᛘ₂ (Systemd Rate Limiting)** (80%): Если нехватка памяти является постоянной, Memcached завершается OOM Killer сразу после перезапуска. Systemd обнаруживает этот цикл сбоев и прекращает дальнейшие попытки восстановления службы.
2. **C2ᛘ₃ (Отсутствие мониторинга chkservd)** (75%): Служба не контролируется системой мониторинга WHM/cPanel.
3. **C2ᛘ₄ (Некорректная конфигурация Systemd)** (70%): В Unit File отсутствуют необходимые директивы `Restart=always`.