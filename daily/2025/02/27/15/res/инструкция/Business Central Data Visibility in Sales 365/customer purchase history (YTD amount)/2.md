Ниже приведена пошаговая инструкция на русском языке, которая описывает, как сделать показатель «customer purchase history (YTD amount)» из Business Central доступным в Dynamics 365 Sales с использованием регулярной передачи данных через Power Automate и демонстрацией этого показателя в Dynamics 365 Sales. Все наименования продуктов и элементов интерфейса даны в официальном английском написании, а в тексте соблюдены требования пунктов 37.1–37.8.

───────────────────────────────────────────────────────────

1) Определить хранение YTD amount в Business Central

1.1) Уточнить, в какой таблице Business Central уже хранится показатель «YTD amount» или его аналог (например, накопленный объем продаж за календарный год).  
   Если показатель не хранится напрямую, то задать логику расчета (например, создать поле в таблице Customer Ledger Entries, создать отдельную measure-колонку в Power BI или другой инструмент аналитики внутри Business Central, в зависимости от возможностей системы).  

1.2) При необходимости добавить пользовательское поле (через раздел «RapidStart Services» или другое решение) в карточку клиента, чтобы в нем сохранялась сумма «YTD amount» (например, итоги за текущий финансовый год).  

1.3) Убедиться, что нужные поля доступны через стандартный программный интерфейс Business Central (например, при использовании «OData» или «API v2»).  

───────────────────────────────────────────────────────────

2) Подготовить сервисы Business Central для доступа к данным

2.1) В пользовательском интерфейсе Business Central открыть «Settings» → «Advanced Settings».  
2.2) Перейти в «Web Services» (или «API Setup», если используется современная версия), выбрать или создать сервис для чтения таблицы или страницы, где доступно поле «YTD amount».  
2.3) Убедиться, что тип аутентификации и разрешения настроены. Желательно использовать «OAuth2» или «Basic» (в зависимости от версии Business Central Online или On-Premises), чтобы «Power Automate» мог получать эти данные.  

───────────────────────────────────────────────────────────

3) Создать поле в Dynamics 365 Sales для сохранения YTD amount

3.1) В интерфейсе Dynamics 365 Sales открыть «Settings» → «Advanced Settings» → «Customizations» → «Customize the System».  
3.2) Найти нужную сущность (обычно «Account» или «Contact», если YTD amount привязан к клиенту).  
3.3) Добавить пользовательское поле типа «Currency» или «Decimal» для хранения «YTD amount» (например, `YTD_Amount`), сохранив и опубликовав изменения.  

───────────────────────────────────────────────────────────

4) Настроить Power Automate для регулярной передачи YTD amount

4.1) Перейти на портал Power Automate (например, из «Office Portal» → «Power Automate»).  
4.2) Нажать «Create» и выбрать «Scheduled cloud flow», чтобы процесс выполнялся автоматически с заданным интервалом (например, каждый день или раз в час).  
4.3) В блоке «Recurrence» задать периодичность (например, раз в сутки).  

4.4) Добавить действие «HTTP» (или использовать встроенный коннектор «Business Central», если он поддерживает нужную таблицу/страницу):  
   • В поле «Method» указать «GET».  
   • В поле «URI» ввести URL сервиса Business Central («OData» или «API»), который возвращает список клиентов и их поле «YTD amount».  
   • Настроить аутентификацию так, чтобы Power Automate мог считывать данные.  

4.5) Обработать ответ в Power Automate:  
   • Добавить действие «Parse JSON» или «Select», чтобы выделить из возвращаемых данных поля «Customer No» (или «AccountNumber») и «YTD amount».  

4.6) На следующем этапе потока (flow) добавить действие «List rows» или «Retrieve multiple records (Dataverse)» для поиска соответствующего аккаунта в Dynamics 365 Sales:  
   • В условии сопоставить «Customer No» из Business Central с «Account Number» в Dynamics 365 Sales (или другим полем, которое служит ключом).  

4.7) Для каждой найденной записи Dynamics 365 Sales обновить пользовательское поле «YTD_Amount»:  
   • Добавить действие «Update a row (Dataverse)» (или «Update record (Dynamics 365)» в зависимости от используемого коннектора).  
   • Заполнить поле «YTD_Amount» значением, полученным из Business Central.  

4.8) Сохранить и протестировать Power Automate flow. Убедиться, что при запуске данные действительно обновляются в Dynamics 365 Sales.  

───────────────────────────────────────────────────────────

5) Проверить отображение YTD amount в Dynamics 365 Sales

5.1) В Dynamics 365 Sales открыть «Settings» → «Customizations» → «Customize the System» и на форме сущности «Account» (или «Contact») добавить на форму поле «YTD_Amount» (drag-and-drop).  
5.2) Опубликовать изменения в пользовательском интерфейсе.  
5.3) Зайти в карточку нескольких клиентов, у которых должен обновиться YTD amount, убедиться, что данные успешно подтянулись из Business Central.  

───────────────────────────────────────────────────────────

6) Учет возможных нюансов и best practices

6.1) Если данные «YTD amount» отличаются высокой динамикой (например, если объемы покупок обновляются ежедневно), рекомендуется установить короткий интервал запуска потока Power Automate (например, раз в час).  
6.2) Если значения «YTD amount» пересчитываются в Business Central на основании закрытых периодов, целесообразно запускать поток после закрытия периода (например, раз в день после вечерней обработки).  
6.3) Для избегания лишней нагрузки на системы стоит проверять, действительно ли значение в Business Central изменилось. Если значение не изменилось, то процесс обновления можно пропускать (например, через условие в Power Automate).  
6.4) Следует настроить мониторинг и логи (например, «Power Automate» дает возможность настроить отслеживание успешных и неуспешных запусков потока). При ошибках синхронизации рекомендуется настраивать уведомления.  

───────────────────────────────────────────────────────────

7) Документирование и обучение команды

7.1) Задокументировать все настройки: от URL веб-сервиса Business Central до структуры полей Dynamics 365 Sales, где хранится «YTD_Amount».  
7.2) Описать логику Power Automate flow (параметры recurrence, шаги чтения данных, маппинг полей).  
7.3) Обучить ответственных сотрудников проверять статус потока в интерфейсе Power Automate и убедиться, что YTD amount корректно обновляется в карточке клиента.  

───────────────────────────────────────────────────────────

Данная последовательность действий позволяет регулярно передавать «customer purchase history (YTD amount)» из Business Central в Dynamics 365 Sales и выводить его в карточке клиента, обеспечивая команде продаж доступ к актуальным цифрам по совокупным закупкам клиента за год.