Я провел глубокое исследование (Deep Research) для выявления и анализа возможных причин (`C1ᛘ⠿`) проблемы `P1†` («Memcache crashing & not automatically restarting») в контексте, описанном в `O.md`.

## C1ᛘ₁: Принудительное завершение процесса OOM Killer

### Суть
На VPS не хватает оперативной памяти для работы всех служб (WHM, Apache, MySQL 8.x, PHP 8.x, WordPress).
Когда система исчерпывает доступную память, ядро Linux активирует механизм OOM Killer (Out-of-Memory Killer) для предотвращения полного отказа системы.
OOM Killer принудительно завершает процесс, потребляющий значительный объем памяти, которым часто оказывается Memcached.

### Оценка (§2.3)
90

### Доводы за (§2.2.1)
Клиент сообщает о «постоянных проблемах со стабильностью» и `P2†` («Чрезмерные ошибки подключения к БД MySQL»).
Эти симптомы являются классическими индикаторами перегруженного сервера, испытывающего нехватку памяти.
Описанный стек технологий является требовательным к ресурсам, что повышает вероятность исчерпания памяти в ограниченной среде VPS.
Memcached спроектирован для использования больших объемов памяти, что делает его приоритетной целью для OOM Killer.

### Доводы против (§2.2.2)
Memcached строго придерживается выделенного ему лимита памяти (параметр CACHESIZE).
Если этот лимит установлен на низком уровне, OOM Killer с большей вероятностью выберет MySQL или Apache, чье потребление памяти менее предсказуемо.

## C1ᛘ₂: Деградация производительности из-за использования пространства подкачки (Swapping)

### Суть
Система исчерпывает физическую оперативную память и начинает перемещать данные в пространство подкачки (swap) на диске.
Memcached критически зависит от быстрого доступа к памяти; при свопинге его производительность резко падает.
Это приводит к зависаниям и тайм-аутам, что может быть интерпретировано как сбой службы или привести к её завершению системой мониторинга из-за отсутствия ответа.

### Оценка (§2.3)
75

### Доводы за (§2.2.1)
Активный свопинг часто предшествует активации OOM Killer (C1ᛘ₁).
Производительность Memcached катастрофически снижается, если он начинает использовать своп.
Общие проблемы со стабильностью, описанные клиентом, хорошо коррелируют с замедлением работы системы из-за интенсивного свопинга.

### Доводы против (§2.2.2)
Использование свопа обычно приводит к замедлению работы, а не к немедленному аварийному завершению (crash) самого процесса Memcached.
Некоторые конфигурации VPS могут вообще не иметь настроенного пространства подкачки.

## C1ᛘ₃: «Пробуксовка» кэша (Cache Churning) и перегрузка ЦП

### Суть
Объем памяти, выделенный Memcached, недостаточен для хранения рабочего набора данных сайта WordPress.
Это приводит к постоянному вытеснению (eviction) часто используемых данных для освобождения места под новые.
Этот интенсивный процесс («пробуксовка») создает чрезмерную нагрузку на ЦП.
Высокая загрузка ЦП дестабилизирует весь VPS и может привести к сбою Memcached или других служб.

### Оценка (§2.3)
60

### Доводы за (§2.2.1)
Известны случаи, когда активация Memcached на сайтах WordPress приводила к резкому росту использования ЦП и последующим сбоям, если размер кэша слишком мал.
«Пробуксовка» кэша резко снижает эффективность кэширования и увеличивает нагрузку на систему.
Это согласуется с общими проблемами стабильности, о которых сообщает клиент.

### Доводы против (§2.2.2)
Memcached сам по себе является легковесным сервисом с точки зрения использования ЦП.
«Пробуксовка» в первую очередь снижает эффективность кэширования (cache hit ratio), а не вызывает сбой самого демона.

## C1ᛘ₄: Вмешательство программного обеспечения безопасности (CSF/LFD)

### Суть
Инструменты безопасности, такие как ConfigServer Security & Firewall (CSF) и его демон Login Failure Daemon (LFD), часто используются в средах cPanel/WHM.
LFD отслеживает использование ресурсов и может принудительно завершать процессы, которые превышают заданные лимиты по потреблению памяти (PT_USERMEM) или времени выполнения (PT_USERTIME).
LFD может идентифицировать активность Memcached как чрезмерную и завершить его процесс.

### Оценка (§2.3)
50

### Доводы за (§2.2.1)
CSF/LFD широко распространен на серверах под управлением cPanel/WHM.
Существуют задокументированные случаи, когда LFD вмешивался в работу Memcached из-за использования ресурсов.
В таких случаях требуется добавление процесса Memcached в список исключений (`/etc/csf/csf.pignore`).

### Доводы против (§2.2.2)
Мы не знаем, установлено ли это программное обеспечение на данном VPS.
Обычно LFD отправляет уведомления по электронной почте при завершении процесса; клиент не упомянул о таких уведомлениях.

## C1ᛘ₅: Несовместимость программного обеспечения или ошибки

### Суть
Сбои могут быть вызваны ошибками (bugs) в демоне Memcached, библиотеке `libmemcached` или проблемами совместимости в используемом стеке.
Среда сочетает устаревшую ОС (CentOS 7) с новым ПО (PHP 8.x, MySQL 8.x), что увеличивает риск несовместимости.

### Оценка (§2.3)
40

### Доводы за (§2.2.1)
Использование устаревшего PHP-расширения `memcache` вместо актуального `memcached` с PHP 8.x может вызвать нестабильность.
Документация cPanel указывает, что старый `memcache` несовместим с PHP 8 в EasyApache 4.
Версии ПО в репозиториях CentOS 7 могут содержать устаревшие ошибки или утечки памяти.

### Доводы против (§2.2.2)
Сам демон Memcached известен своей высокой стабильностью; сбои чаще вызваны внешними факторами.
Проблемы с расширениями PHP обычно вызывают сбои в рабочих процессах Apache/PHP, а не в демоне Memcached.
Если установка производилась стандартными средствами WHM (EasyApache 4), система обычно хорошо управляет совместимостью версий.

## C1ᛘ₆: Отсутствие политики перезапуска в Systemd

### Суть
Эта гипотеза объясняет причину, по которой Memcached «не перезапускается автоматически».
CentOS 7 использует Systemd для управления службами.
Если в файле службы `memcached.service` отсутствует директива перезапуска (например, `Restart=on-failure` или `Restart=always`), Systemd не будет перезапускать службу после её аварийного завершения.

### Оценка (§2.3)
85

### Доводы за (§2.2.1)
Клиент прямо указывает на отсутствие автоматического перезапуска.
Если политика перезапуска не определена, Systemd не будет предпринимать попыток восстановить службу после её падения.
Если Memcached был запущен вручную из командной строки (например, `memcached -d`), минуя Systemd, он не будет управляться как служба и не будет перезапущен.

### Доводы против (§2.2.2)
Установка Memcached из стандартных репозиториев CentOS или через механизмы cPanel обычно включает базовую конфигурацию Systemd с политикой перезапуска.
Эта гипотеза не объясняет первопричину сбоев Memcached.

## C1ᛘ₇: Отсутствие мониторинга со стороны cPanel Chkservd

### Суть
Эта гипотеза объясняет причину отсутствия автоматического перезапуска в среде WHM/cPanel.
Система мониторинга служб cPanel (`chkservd`) не настроена на отслеживание состояния Memcached и его перезапуск в случае отказа.

### Оценка (§2.3)
80

### Доводы за (§2.2.1)
В среде WHM/cPanel для обеспечения доступности сторонних сервисов часто требуется их явное добавление в мониторинг через `WHM -> Service Manager` или настройку `chkservd`.
Если Memcached был установлен вручную или не был должным образом интегрирован, `chkservd` не будет отслеживать его состояние.
Для мониторинга может потребоваться ручная конфигурация, например, создание файла в `/etc/chkserv.d/memcached`.

### Доводы против (§2.2.2)
Systemd (C1ᛘ₆) является основным менеджером служб в CentOS 7 и может перезапускать службы независимо от `chkservd`.
Если Memcached был установлен с использованием современных пакетов cPanel (например, `ea-memcached`), он может автоматически интегрироваться с системой мониторинга.

## C1ᛘ₈: Ограничение частоты перезапусков Systemd (Rate Limiting)

### Суть
Systemd настроен на автоматический перезапуск Memcached, но служба падает слишком часто за короткий промежуток времени.
Systemd активирует механизм ограничения скорости запуска (`StartLimitBurst` и `StartLimitIntervalSec`) и прекращает дальнейшие попытки перезапуска, чтобы предотвратить бесконечный цикл.

### Оценка (§2.3)
40

### Доводы за (§2.2.1)
Это стандартный механизм защиты в Systemd.
Если причина сбоя сохраняется постоянно (например, критическая нехватка памяти сразу после запуска), служба перейдет в состояние «failed» и не будет перезапускаться автоматически.
Это объясняет, почему служба не перезапускается, даже если установлена политика `Restart=always`.

### Доводы против (§2.2.2)
Если сбои Memcached происходят периодически (только во время пиковой нагрузки), условие для срабатывания Rate Limiting может не выполняться.
Это объясняет, почему служба перестает перезапускаться после нескольких попыток, но не объясняет первоначальный отказ перезапуска.

# Вердикт

Проблема `P1†` состоит из двух компонентов: причины сбоя («crashing») и причины отказа автоматического перезапуска («not automatically restarting»).

Наиболее вероятной причиной **аварийного завершения работы (Crashing)** является **C1ᛘ₁ (OOM Killer)**.
Симптомы общей нестабильности системы и проблем с MySQL (`P2†`), описанные клиентом, убедительно свидетельствуют о том, что VPS испытывает критическую нехватку оперативной памяти.
Эта ситуация, вероятно, усугубляется C1ᛘ₂ (Swapping).

Наиболее вероятными причинами **отсутствия автоматического перезапуска (Not automatically restarting)** являются **C1ᛘ₆ (Отсутствие политики перезапуска в Systemd)** и **C1ᛘ₇ (Отсутствие мониторинга Chkservd)**.
В среде CentOS 7 с WHM обе системы управления службами должны быть настроены корректно для обеспечения надежного перезапуска; весьма вероятно, что конфигурация отсутствует или некорректна.