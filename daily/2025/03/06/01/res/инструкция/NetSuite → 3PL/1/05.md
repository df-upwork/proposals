Ниже приведён пример того, **как именно** установить соединение с удалённым SFTP-сервером, используя модуль `N/sftp` в **SuiteScript 2.x**. Главная «точка входа» — метод `sftp.createConnection(config)`, которому необходимо передать основные параметры подключения.

---

## 1. Пример кода (Scheduled Script или Map/Reduce)

```js
/**
 * @NApiVersion 2.x
 * @NScriptType ScheduledScript
 */
define(['N/sftp', 'N/file', 'N/log'], 
function(sftp, file, log) {
  
  function execute(context) {
    try {
      // 1. Создаём объект подключения
      var connection = sftp.createConnection({
        // Обязательные параметры:
        url: 'sftp.example.com',    // Хост SFTP-сервера
        hostKey: 'ssh-rsa 2048 AAAAB3NzaC1yc2E...', 
        //  ^ Это SSH Host Key сервера (fingerprint). Без него NetSuite не позволит подключиться.
        
        // Тип ключа (иногда требуется явно, если NetSuite не определяет сам):
        // hostKeyType: sftp.HostKeyType.SSH_RSA, // или SSH_ED25519, если нужно
        
        // Учетные данные (логин и пароль или ключ):
        username: 'mySftpUser',
        
        // Вариант A: пароль, хранимый в NetSuite Credential:
        // passwordGuid: '{GUID_пароля_из_секретного_хранилища}',
        
        // Вариант B: пароль в явном виде (не рекомендуется в продакшене, но для примера):
        // password: 'MY_SUPER_SECRET_PASSWORD',
        
        // Вариант C: ключ + парольная фраза (если используется key-based auth):
        // privateKeyGuid: '{GUID_privateKey_из_Credentials}',
        // passphraseGuid: '{GUID_passphrase_из_Credentials}',
        
        // Порт по умолчанию 22, можно явно указать другой при необходимости
        port: 22,
        
        // Путь к директории (на удалённом SFTP), с которой будем работать
        directory: '/inbound'
      });
      
      // 2. Проверяем соединение
      log.audit('SFTP Connection', 'Connected to: ' + connection.url);
      
      // 3. Пример загрузки (download) или выгрузки (upload) файла:
      //    Допустим, хотим скачать список файлов из /inbound
      var fileList = connection.list({
        path: '/inbound'
      });
      log.debug('Files in /inbound', fileList);
      
      // Далее можно download, upload, remove, move и т.п.
      // Например, скачать файл:
      // var downloadedFile = connection.download({
      //   filename: 'somefile.csv'
      // });
      // Затем сохранить в NetSuite File Cabinet или распарсить...
      
    } catch (e) {
      log.error('SFTP Error', e);
    }
  }
  
  return {
    execute: execute
  };
});
```

### Ключевые моменты в примере:
1. **`url`**: доменное имя или IP-адрес SFTP-сервера.  
2. **`hostKey`**: обязательный SSH Host Key (fingerprint) удалённого сервера. Без него NetSuite по соображениям безопасности не разрешит подключение.  
   - Обычно выглядит как строка вида: `"ssh-rsa 2048 AAAAB3NzaC1yc2E..."`  
   - Иногда ваш провайдер SFTP (3PL) предоставляет в более коротком виде (fingerprint). Если ключ приходит в другом формате, возможно, придётся конвертировать или запросить у 3PL более полный SSH key.  
3. **Учётные данные**:  
   - Логин (`username`).  
   - **Пароль** можно указать напрямую через `password` (не рекомендовано для продакшена) или безопаснее — хранить его в **NetSuite Credential** и указывать `passwordGuid: '...'`.  
   - Если используется **Key-based authentication** (SSH-ключи), то указывают `privateKeyGuid` + `passphraseGuid`, если ключ зашифрован.  
4. **`port`**: по умолчанию `22`.  
5. **`directory`**: папка на стороне SFTP-сервера, в которую (или из которой) вы будете читать/писать файлы по умолчанию.  

---

## 2. Как хранить пароль/ключи безопасно (Credential Management)

В продакшен-среде не рекомендуется хардкодить пароль в SuiteScript. Вместо этого:
1. Перейдите в **Setup** → **Company** → **Preferences** → **Credentials** (или **Setup** → **Company** → **Security** → **Manage Credentials**, в зависимости от версии NetSuite).  
2. Создайте новую запись, где укажите **Label**, **Password** (или Private Key).  
3. NetSuite сгенерирует GUID (например, `f3fc8c24-b63f-4a65-...`).  
4. В скрипте используйте `passwordGuid: 'f3fc8c24-b63f-4a65-...'` вместо `password`.  

То же самое с ключевой парой (SSH):  
- Приватный ключ загружается в Credentials как «Secret Key» (или «Private Key»).  
- Парольная фраза (passphrase) — тоже отдельным Credential, получаете `passphraseGuid`.

---

## 3. Пример передачи/загрузки файла (upload/download)

После того как соединение установлено, вы можете:
- **Скачать (download)** файл с SFTP в NetSuite,  
- **Загрузить (upload)** файл из NetSuite на SFTP,  
- **Удалять (remove)**, **перемещать (move)** файлы и т. д.

### 3.1. Загрузка (upload) файла:

```js
// Допустим, у нас есть уже созданный объект NetSuite File (fileObj).
// Или можно сразу создавать "виртуальный" файл в памяти через file.create(...).

var response = connection.upload({
  file: fileObj,        // объект типа N/file
  filename: 'orders.csv',
  replaceExisting: true // если нужно перезаписывать одноимённый файл
});
// response — информация об успешной/неуспешной операции
```

### 3.2. Загрузка (download) файла:

```js
var downloadedFile = connection.download({
  filename: 'someFile.csv'
});
// downloadedFile будет объектом типа N/file.File, 
// который вы затем можете сохранить в NetSuite File Cabinet:
var savedFileId = downloadedFile.save();
```

---

## 4. Важные нюансы

1. **hostKey**.  
   Обязательно убедитесь, что **SSH Host Key** сервера, который вы передаёте в `createConnection()`, верный. Иногда его меняют на стороне 3PL, что ломает интеграцию.  
2. **Безопасное хранение пароля/ключа**.  
   Рекомендуется всегда использовать `passwordGuid`, `privateKeyGuid`, `passphraseGuid` (через Manage Credentials) вместо прямого хранения секретов в коде.  
3. **Проверка прав и разрешений**.  
   У роли, под которой выполняется скрипт, должны быть включены права:  
   - **SuiteScript** (и именно Server SuiteScript 2.x)  
   - **Documents and Files** (для операций с файлами),  
   - Доступ к любой записи, которую вы обновляете (Sales Order и т.д.).  
4. **Проверка на лимиты (governance)**.  
   Операции SFTP могут потреблять значительное кол-во «governance units» в NetSuite. При больших объёмах файлов лучше использовать **Map/Reduce Script** для более стабильной обработки.  
5. **Формат пути/директории**.  
   - `directory` в `createConnection({ ... })` задаёт «текущую директорию» соединения. Если в методах `upload()`, `download()` вы не укажете путь отдельно, будет использоваться она. Можно также передавать `directory` внутри `upload()` или `download()`.  
6. **Дополнительные методы**.  
   - `list({ path: '...' })` — список файлов,  
   - `remove({ filename: '...' })` — удаление,  
   - `move({ source: '...', destination: '...' })` — перемещение/переименование файла.

---

### Резюме

- Подключение к SFTP через `N/sftp` делается при помощи `createConnection({ url, hostKey, username, ... })`.  
- Все параметры (пароль, ключ, порт, директория) указываются в одном объекте.  
- После создания `connection` вы можете **upload**, **download**, **list**, **remove** и т.д.  
- В боевой среде обязательно использовать **Credential Management** вместо явного указания пароля/ключа в коде.