## 1.
Потенциальный клиент опубликовал на Upwork следующий проект:
### 1.1. Title
Expert Needed for SharePoint 2019 On-Premise with Kerberos & Node.js

### 1.2. Description
We are looking for an experienced developer with deep expertise in SharePoint 2019 On-Premise, Kerberos authentication, and Node.js to help us implement a Provider-Hosted App (PHA). 
The app should authenticate with the currently logged-in user and make requests to the SharePoint API via our Node.js backend.
Unfortunately, we are facing issues with Kerberos authentication in our Node.js backend, as the forwarded user identity is not working as expected. We need an expert to help us configure and debug this setup.
#### Requirements:
✅ Experience with SharePoint 2019 On-Premise
✅ Kerberos authentication & delegation (SPNEGO, NTLM, Kerberos tickets, constrained delegation)
✅ Node.js backend integration with SharePoint REST API / CSOM or other relevant APIs
✅ Windows Server & IIS configuration for Kerberos authentication
✅ Experience with debugging tools like Postman, Fiddler, or Wireshark for troubleshooting authentication issues
✅ Knowledge of OAuth, ADFS, and Claims-Based Authentication is a plus
#### Tasks:
- Analyze our current Kerberos authentication setup and identify the issue
- Correctly configure Kerberos delegation (SPN, constrained delegation, service accounts, etc.) for our Node.js WebApp
- Modify the Node.js backend to correctly pass the Kerberos token of the authenticated user
- Debug authentication issues and implement a working solution
- Document the necessary steps for future modifications
#### Why We Need You:
We already have a working setup with a C# PHA App, but the authentication does not work as expected with Node.js.
We need an expert who can deep dive into the Kerberos mechanism in combination with SharePoint 2019 and Node.js to resolve the issue.
If you have experience with a similar setup, please apply and share details of your past projects where you integrated Kerberos authentication with SharePoint and how you solved similar issues.

### 1.3. Tags
Microsoft SharePoint
Microsoft SharePoint Administration
Node.js
Kerberos
Microsoft SharePoint Development

## 2. Информация о клиенте
### 2.1. Местоположение
Switzerland
Tägerwilen

## 2.2. Характеристики компании
### 2.2.1. Сектор экономики
неизвестно
### 2.2.2. Количество сотрудников
неизвестно

## 2.3. Характеристики учётной записи на Upwork
### 2.3.1. Member since
Mar 20, 2021
#### 2.3.2. Hire rate (%)
100
#### 2.3.3. Количество опубликованных проектов (jobs posted)
9
#### 2.3.4. Total spent
$74K
#### 2.3.5. Количество оплаченных часов в почасовых проектах
1217

## 3. Обозначения
### 3.1. `C`
Клиента буду называть `C`.

### 3.2. `P`
Проект `C` буду называть `P`.

### 3.3. `Ps`
Множество подобных `P` проектов буду обозначать `Ps`.

## 4. Альтернативы Kerberos
### 4.1.
Я тебя спросил:
~~~
Какие альтернативы Kerberos существуют для `Ps`? 
~~~

### 4.2.
Ты ответил:
~~~
Ниже перечислены основные варианты (помимо классического Kerberos), которые обычно рассматривают в похожих проектах для аутентификации и (частично) делегирования прав в контексте SharePoint 2019 On-Premise и внешних приложений (Node.js или другие):

1. **NTLM (Windows Integrated Authentication)**  
   - **Что это:** Старый протокол Windows-аутентификации, нередко встречается вместе с Kerberos под общим названием “Negotiate” (когда система сама выбирает, какой механизм использовать).  
   - **Плюсы:** Относительно простая базовая настройка, встроенная в IIS и SharePoint.  
   - **Минусы:**  
     - Ограниченные возможности делегирования.  
     - Сложнее безопасно передавать токены, особенно когда нужен «прозрачный» Single Sign-On в нескольких средах.  

2. **Basic / Digest**  
   - **Что это:** Механизмы HTTP-аутентификации, передающие логин/пароль в зашифрованном/хешированном виде (Digest чуть безопаснее Basic).  
   - **Плюсы:** Просты в реализации на уровне заголовков HTTP.  
   - **Минусы:**  
     - В большинстве случаев не обеспечивают нужной безопасности и полноценного SSO/делегирования.  
     - Часто требуют хранения/передачи пароля, что может быть неприемлемо в корпоративных политиках.  

3. **Claims-Based Authentication (ADFS / SAML / WS-Fed / Forms-Based и т.д.)**  
   - **Что это:** SharePoint 2019 On-Premise поддерживает различные схемы Claims-Based аутентификации. Обычно это делается через ADFS, SAML или WS-Federation, чтобы работать с токенами безопасности (claims).  
   - **Плюсы:**  
     - Гибкость в выборе провайдера идентификации (собственный ADFS, внешний IdP, Shibboleth и т.д.).  
     - Расширенные возможности Single Sign-On.  
     - Хорошо интегрируется с «новыми» типами приложений (например, Node.js) через стандартизированные протоколы (OAuth, SAML, OIDC).  
   - **Минусы:**  
     - Более сложная конфигурация (ADFS, конфигурация Trust отношений, сертификаты и т.д.).  
     - Не всегда «из коробки» даёт полноценную делегацию на уровне Windows-запросов (Kerberos всё равно может потребоваться для полной импликации «on behalf of»).  

4. **OAuth (SharePoint App Model / ADFS / OIDC)**  
   - **Что это:** В SharePoint 2013+ появился App Model, в том числе на базе OAuth, а также возможность интеграции с ADFS или другими OAuth-провайдерами (OIDC) для получения и использования токенов доступа.  
   - **Плюсы:**  
     - Хорошая поддержка “provider-hosted apps” (в т.ч. в SharePoint 2019) через модель разрешений (permission scopes) и OAuth-токенов.  
     - Удобная интеграция с современными веб-фреймворками, такими как Node.js (через Passport.js, ADAL/MSAL и т.п.).  
   - **Минусы:**  
     - Нужно настраивать инфраструктуру OAuth (ADFS, Azure AD или др.).  
     - Потоковая модель «on behalf of» по OAuth может потребовать дополнительной конфигурации, чтобы физически «прокинуть» права пользователя обратно к SharePoint.  

5. **SAML (через ADFS или др. провайдер SAML)**  
   - **Что это:** Чаще всего SAML используют при конфигурации claims-based auth (п.3).  
   - **Плюсы:**  
     - Широко используется в корпоративном секторе для SSO.  
     - SharePoint может быть настроен на приём SAML токенов с различными наборами claims.  
   - **Минусы:**  
     - Делегирование «вовнутрь» Windows-контекста и дальше к SharePoint может быть ограничено — в некоторых случаях для реальной «имперсонации» пользователя всё равно нужно Kerberos/Constrained Delegation.  

6. **Forms-Based Authentication**  
   - **Что это:** Аутентификация через пользовательскую веб-форму с последующей проверкой логина/пароля (часто в ASP.NET Membership provider или LDAP).  
   - **Плюсы:**  
     - Простая реализация пользовательских сценариев входа.  
     - Можно подключить свои источники данных (SQL, LDAP и т.д.).  
   - **Минусы:**  
     - Формальное SSO затруднено (требуется хранение cookies).  
     - Делегирование прав на уровне Windows не работает по умолчанию.  

7. **Certificate-Based Authentication**  
   - **Что это:** Аутентификация по клиентским сертификатам (smart-card, сертификаты в Windows-хранилище и т.д.).  
   - **Плюсы:** Высокий уровень безопасности, часто используется в средах с жёсткими требованиями (гос. организации, банки).  
   - **Минусы:**  
     - Сложная инфраструктура PKI.  
     - Делегирование не столь тривиально, как при Kerberos (часто всё равно задействуют Kerberos Constrained Delegation).  

8. **Hybrid Scenarios (On-Prem + Azure AD / Office 365)**  
   - **Что это:** Для SharePoint 2019 On-Premise возможна гибридная модель аутентификации, когда часть аутентификации/сервисов выносится в Azure AD, а часть остаётся локально.  
   - **Плюсы:**  
     - Использование современных облачных технологий (Azure AD, Conditional Access, MFA).  
     - Шире возможности в плане внешней интеграции с другими SaaS-приложениями.  
   - **Минусы:**  
     - Сложная настройка гибридного окружения (связь On-Premise и Azure).  
     - По-прежнему непросто сделать полноценную делегацию для Node.js «как текущего пользователя» без Kerberos.  

---

### Когда без Kerberos не обойтись?

Если в проекте (`Ps`) **критически важно** реализовать **прозрачную делегацию** (Windows Identity Delegation), чтобы бэкенд (Node.js) ходил в SharePoint *от имени конкретного пользователя* (не только «знаю логин», а именно «выдаю запросы, как этот пользователь»), то Kerberos почти всегда будет предпочтительным (или даже единственным) решением.  
- **NTLM** может теоретически делать «pass-through», но это крайне нестабильно и слабо поддерживается, особенно при нескольких хопах.  
- **OAuth/Claims** варианты обычно решают задачу через «application identity» (client ID / client secret) или «on behalf of», но это уже не та Windows-аутентификация, которая автоматически передаёт права пользователя.  

Таким образом, если нужно строгое делегирование и прозрачный SSO через AD, Kerberos часто остаётся основным методом. Все остальные варианты либо упрощают аутентификацию (Basic, Forms, NTLM), либо требуют обособленной конфигурации (OAuth, SAML, ADFS) и не всегда дают полноценную модель «от имени пользователя».  

---

## Вывод

**Kerberos** — наиболее «нативный» способ безопасной передачи контекста пользователя в средах Windows/SharePoint, поэтому аналогичные проекты (`Ps`) чаще всего используют либо Kerberos, либо OAuth/ADFS (SAML) в режиме Claims-Based. Остальные методы (NTLM, Basic, Forms) — это скорее обходные пути или протоколы для простых/непритязательных сценариев.  

Если же в проекте принципиально отказаться от Kerberos, то самым жизнеспособным решением обычно становится **Claims-Based аутентификация** (через ADFS/OAuth/SAML) с «on behalf of»-потоком, но тогда придётся смириться с более сложной настройкой и тем, что внутри SharePoint аутентификация будет работать не совсем так же, как при Kerberos.
~~~
