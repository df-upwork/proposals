1) Передача order files из NetSuite на сервер 3PL по протоколу SFTP реализуется на SuiteScript 2.1 так: https://gist.github.com/dmitrii-fediuk/79c708dd1291eae3b6dafcbcbed57347
1.1) Подключить модули:
```javascript
import file from 'N/file';
import search from 'N/search';
import sftp from 'N/sftp';
export function execute() {
	// <…>
}
```  
1.2) Составить список подлежащих передаче orders:
```javascript
const orders = search.load({id: 'customsearch_export_orders'}).run().map(r => ({
	entity: r.getText({name: 'entity'})
	,salesOrderId: r.getValue({name: 'internalid'})
	,total: r.getValue({name: 'total'})
	,tranId: r.getValue({name: 'tranid'})
}));
```  
1.3) Serialize the orders of point 1.2 (https://en.wikipedia.org/wiki/Serialization):
```javascript
let csvA = ['SalesOrderId,TranId,Entity,Total'];
orders.forEach(o => {csvA.push(
	[o.salesOrderId, o.tranId, o.entity, o.total]
		.map(v => `"${v}"`)
		.join(',')
);});
```  
1.4) Создать файл (https://en.wikipedia.org/wiki/Data_transfer_object):
```javascript
const f = file.create({
	contents: csvA.join('\n')
	,description: '<…>'
	,encoding: file.Encoding.UTF_8
	,fileType: file.Type.CSV
	,folder: 123 // The folder ID in NetSuite File Cabinet
	,name: '<…>.csv'
});
f.save();
```  
1.5) Соединиться c сервером 3PL по протоколу SFTP:
```javascript
const conn = sftp.createConnection({
	directory: '<…>'
	,hostKey: 'AAAAB3NzaC1yc2E<…>'
	,hostKeyType: sftp.HostKeyType.RSA
	,passwordGuid: '<…>'
	,port: 22
	,url: '<…>'
	,username: '<…>'
});
``` 
1.6) Upload the file to the 3PL server:
```javascript
conn.upload({file: f, replaceExisting: true});	
```

2) Скачивание файлов с сервера SFTP в NetSuite реализуется на SuiteScript 2.1 так: https://gist.github.com/dmitrii-fediuk/93841deb2bd60ee8e2c952f4be41e7ea
2.1) Подключить модули:
```javascript
import record from 'N/record';
import search from 'N/search';
import sftp from 'N/sftp';
export function execute() {
	// <…>
}
```  
2.2) Соединиться c сервером 3PL по протоколу SFTP: аналогично пункту 1.5.
2.3) Составить список файлов для скачивания:
```javascript
const path = '<…>';
conn.list({path: path}).forEach(rf => {
	if (rf.name && rf.name.toLowerCase().endsWith('.csv')) {
		// <…>	
	}		
});
```
2.4) Для каждого файла:  
2.4.1) Скачать:
```javascript
const contents = conn.download({directory: path, filename: rf.name}).getContents();
```  
2.4.2) Извлечь из файла информацию о заказах:
```javascript
const lines = contents.split(/\r?\n/);
for (let i = 1; i < lines.length; i++) {
	let line = lines[i].trim();
	if (line) {
		let fields = line.split(',');
        // <…>	
    }
```  
2.4.3) Для каждой каждого заказа из файла: 
2.4.3.1) Найти этот заказ в NetSuite:
  ```javascript
const findOrder = id => {
	const s = search.create({
		columns: ['internalid']
		,filters: [['mainline', 'is', 'T'], 'AND', ['tranid', 'is', id]]
		,type: search.Type.SALES_ORDER
	}).run().getRange({end: 1, start: 0});
	return !s || !s.length ? null : record.load({
		id: parseInt(s[0].getValue({name: 'internalid'})), type: record.Type.SALES_ORDER
	});
};
let o = findOrder(fields[0]);
if (o) {
    // <…>					
}
```  
2.4.3.2) Обновить этот заказ в NetSuite:
```javascript
o.setValue({fieldId: 'custbody_shipping_status', value: fields[1]});
o.setValue({fieldId: 'custbody_tracking_number', value: fields[2]});
o.save();
```
2.4.4) Удалить обработанный файл на сервере 3PL, чтобы повторно не обрабатывать его при следующем подключении к серверу:
```javascript
conn.remove({directory: '<…>', filename: rf.name});
```
3) Конечно, для обоих решений 1 и 2 нужно ещё выполнить эти 2 пункта:
- «Ensure proper file formatting and mapping for seamless data exchange»
- «Implement error handling and logging for tracking failures or issues»
Но реализация этих пунктов уже определяется деталями вашего 3PL и вашего NetSuite.
---
I have completed 534 projects here on Upwork.
My GitHub profile: https://github.com/dmitrii-fediuk
My websites: https://df.tips?order=views, https://dmitry.ai?order=views, https://mage2.pro?order=views 