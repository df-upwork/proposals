### Пошаговая инструкция по обеспечению доступности данных об инвентаре из Business Central в Dynamics 365 Sales

На основе требований клиента необходимо обеспечить доступность данных об инвентаре (`inventory`) из Microsoft Dynamics 365 Business Central (далее — Business Central) в Microsoft Dynamics 365 Sales (далее — Sales 365). Для этого используется Microsoft Power Automate (далее — Power Automate) для регулярной передачи данных. Ниже приведена инструкция на русском языке с использованием официальных терминов на английском языке в соответствии с документацией.

---

#### 1. Определение источника данных в Business Central

Для передачи данных об инвентаре необходимо определить источник данных в Business Central.

1. В Business Central данные об инвентаре хранятся в таблице `Items`, которая содержит информацию о товарах, включая их идентификаторы (`Item No.`), названия и другие атрибуты.  
2. Доступ к текущему количеству на складе (`Inventory`) предоставляется через таблицу `Item Ledger Entries` или агрегированные данные в таблице `Item`.  
3. Использовать API Business Central для доступа к этим данным. Например, конечная точка OData: `https://api.businesscentral.dynamics.com/v2.0/{tenant-id}/{environment}/ODataV4/Company('YourCompany')/Items`.

---

#### 2. Определение целевой сущности в Sales 365

Необходимо определить, где в Sales 365 будут отображаться данные об инвентаре.

1. В Sales 365 данные об инвентаре логично связать с сущностью `Product`, которая используется для управления товарами в продажах.  
2. Проверить наличие стандартного поля для хранения количества на складе. Если такого поля нет, создать пользовательское поле:  
   - Перейти в `Settings` → `Customizations` → `Customize the System`.  
   - Выбрать сущность `Product` → `Fields` → `New`.  
   - Создать поле с именем `Available Inventory`, тип данных `Whole Number`.  
   - Сохранить и опубликовать изменения (`Publish All Customizations`).

---

#### 3. Настройка подключений в Power Automate

Для передачи данных необходимо настроить подключения к обеим системам в Power Automate.

1. Войти в Power Automate через портал `make.powerautomate.com`.  
2. Перейти в раздел `Connections` и создать подключение к Business Central:  
   - Выбрать коннектор `Microsoft Dynamics 365 Business Central`.  
   - Указать учетные данные и среду (environment) Business Central.  
3. Создать подключение к Sales 365:  
   - Выбрать коннектор `Microsoft Dataverse` (ранее Common Data Service), так как Sales 365 использует Dataverse.  
   - Авторизоваться с учетной записью Dynamics 365.  

---

#### 4. Создание потока в Power Automate

Создать поток для регулярного обновления данных об инвентаре в Sales 365.

1. В Power Automate выбрать `Create` → `Automated cloud flow` → `Scheduled cloud flow`.  
2. Настроить триггер `Recurrence`:  
   - Установить интервал, например, `Interval` = 1, `Frequency` = `Day` (ежедневное обновление).  
3. Добавить действие `Get rows` из коннектора `Microsoft Dynamics 365 Business Central`:  
   - Указать таблицу `Items`.  
   - При необходимости добавить фильтр в поле `OData filter`, например, `inventory gt 0`, чтобы получать только товары с положительным остатком.  
4. Добавить действие `List records` из коннектора `Microsoft Dataverse`:  
   - Указать сущность `Products` в Sales 365.  
   - Использовать фильтр для сопоставления товаров, например, по полю `Product Number`.  
5. Добавить действие `Update a record` из коннектора `Microsoft Dataverse`:  
   - Указать сущность `Products`.  
   - Сопоставить запись из Sales 365 с данными из Business Central по полю `Product Number` (соответствует `Item No.`).  
   - Обновить поле `Available Inventory` значением из поля `Inventory` таблицы `Items`.  
6. Для новых товаров (если запись не найдена в `List records`) добавить действие `Create a new record`:  
   - Указать сущность `Products`.  
   - Заполнить обязательные поля, такие как `Name` и `Product Number`, а также `Available Inventory`.  

---

#### 5. Сопоставление полей

Настроить соответствие между полями Business Central и Sales 365 в действиях потока.

1. В действии `Update a record` или `Create a new record` указать:  
   - `Product Number` = `Item No.` из Business Central.  
   - `Name` = `Description` из Business Central (или другое поле с названием товара).  
   - `Available Inventory` = `Inventory` из Business Central.  
2. Убедиться, что формат данных совпадает (например, `Inventory` как целое число).

---

#### 6. Обработка ошибок и логирование

Добавить шаги для обработки ошибок и отслеживания выполнения потока.

1. Включить `History` в настройках потока для просмотра логов выполнения:  
   - Перейти в `Flow details` → `Run history`.  
2. Добавить действие `Send an email (V2)` из коннектора `Office 365 Outlook` в случае ошибки:  
   - Использовать `Condition` для проверки статуса предыдущего действия (`Succeeded` или `Failed`).  
   - Если `Failed`, отправить уведомление администратору с описанием ошибки.  

---

#### 7. Тестирование и развертывание

Протестировать поток и развернуть его в рабочей среде.

1. Выполнить тестовый запуск потока в Power Automate:  
   - Нажать `Test` → `Manually` и проверить обновление нескольких записей в Sales 365.  
2. Проверить в Sales 365 корректность данных в сущности `Products`:  
   - Открыть раздел `Sales` → `Products` и убедиться, что поле `Available Inventory` заполнено актуальными значениями из Business Central.  
3. После успешного тестирования активировать поток:  
   - Переключить статус в `On` в интерфейсе Power Automate.  

---

### Результат

После выполнения инструкции данные об инвентаре из Business Central будут регулярно передаваться в Sales 365 через Power Automate. Сотрудники отдела продаж смогут видеть актуальное количество товаров на складе в сущности `Products` в поле `Available Inventory`, что обеспечит доступность данных в соответствии с требованиями клиента.