Ниже приведён пример того, **как в SuiteScript 2.x** «разместить (загрузить) файл на удалённом SFTP-сервере 3PL». Предположим, вы уже:

1. Сформировали содержимое CSV/XML (строку) и  
2. Создали объект файла ( `N/file` ),  
3. Имеете учётные данные и параметры для подключения к SFTP (URL/host, порт, имя пользователя, пароль/SSH-ключ, hostKey).

---

## 1. Подготовить (или получить) файл, который нужно загрузить

Обычно у вас уже есть переменная `fileObj`, созданная через:

```js
var fileObj = file.create({
  name: 'export_orders.csv',   // или .xml, .txt — смотря что вы формируете
  fileType: file.Type.CSV,     // или XML, PLAINTEXT и т.п.
  contents: csvContent,        // строка с данными
  folder: 123                  // внутренний ID папки NetSuite (необязательно)
});
```

> Варианты:  
> • Вы можете **сохранить** этот `fileObj` в File Cabinet методом `fileObj.save()` (если хотите, чтобы файл хранился в NetSuite).  
> • Или можете передавать файл напрямую «на лету» в SFTP без сохранения в File Cabinet.

---

## 2. Создать подключение к SFTP с помощью модуля `N/sftp`

В коде SuiteScript (Scheduled/Map-Reduce/т.п.) импортируйте модуль `N/sftp`:

```js
define(['N/sftp', 'N/file', 'N/log'], function(sftp, file, log) {
  
  function execute(context) {
    try {
      // 1) Подключаемся к SFTP:
      var connection = sftp.createConnection({
        // Строковые параметры:
        username   : 'mySftpUsername',
        passwordGuid: '{GUID_из_Credentials_или_секрет_здесь}',
        url        : 'sftp.my3plserver.com', // или IP-адрес
        directory  : '/inbound',             // удалённая папка на SFTP
        hostKey    : 'ssh-rsa 2048 xx:xx:xx:...', // SSH fingerprint
        port       : 22                      // часто 22, но может быть и другой
      });

      // 2) Загружаем файл
      // (см. следующий раздел — варианты upload/put)
      
    } catch (error) {
      log.error('SFTP Error', error);
    }
  }
  
  return {
    execute: execute
  };
});
```

### Где взять `hostKey` (SSH Fingerprint)?
- Обычно 3PL (или владелец SFTP-сервера) предоставляет вам **fingerprint** SSH-сервера (например, `ssh-rsa 2048 xx:xx:xx:xx` и т.д.).  
- В противном случае вы можете самостоятельно получить ключ, подсоединившись к серверу через ssh и выполнив команды типа `ssh-keyscan` (если у вас есть доступ к командной строке).  
- Без корректного `hostKey` NetSuite **не** разрешит установить соединение по SFTP.

### Где взять `passwordGuid`?
- В большинстве случаев пароль или SSH-ключ **рекомендуется** хранить в NetSuite Credential Store и указывать в `passwordGuid` GUID этой учётной записи.  
- Если используете SSH-ключ, то в `N/sftp` указываете `keyGuid` и `passphraseGuid`, если закрытый ключ дополнительно защищён паролем.  
- Для тестовых целей иногда указывают `password` напрямую как строку, но это не best practice.

---

## 3. Варианты загрузки файла: `upload()` или `put()`

В более новых релизах (начиная с 2020.1, 2021.x и выше) метод может называться `upload()`, в более ранних — `put()`. Логика та же: нужно передать объект или контент файла, а также имя файла, под которым он будет лежать на SFTP.

### 3.1. Использовать объект `fileObj`

```js
var response = connection.upload({
  file: fileObj // наш объект N/file
});
```

При этом имя файла на удалённом сервере возьмётся из `fileObj.name`.  
Загружается в папку, указанную в `directory` при создании соединения.

> Если метод называется `put()`, синтаксис очень похож:

```js
var response = connection.put({
  file: fileObj
});
```

### 3.2. Задать явное имя файла и путь

Некоторые версии модуля `N/sftp` позволяют указать параметры отдельно, например:

```js
connection.upload({
  file: fileObj,
  filename: 'orders_20250306.csv',  
  directory: '/inbound/today'         // если хотите другую папку
});
```

Или:

```js
connection.put({
  contents: fileObj.getContents(),  // строка CSV/XML
  path: '/inbound/today/orders_20250306.csv'
});
```

Где `contents` — это уже **строка** (например, `csvContent`).  
Однако чаще удобнее передавать `file: fileObj`.

> Уточните в своей NetSuite-версии, какой именно метод поддерживается (`upload()` или `put()`, и какой синтаксис параметров).

---

## 4. Обработать ответ и возможные ошибки

Методы `upload()` или `put()` обычно возвращают объект типа:

```js
{
  response: 'OK'     // или что-то подобное
}
```

или могут выбросить ошибку, которую нужно перехватить `try/catch`.

```js
try {
  var response = connection.upload({ file: fileObj });
  log.audit('SFTP upload response', response);
} catch (e) {
  log.error('SFTP upload failed', e);
}
```

### Типичные причины неудачи:
1. **Неверный hostKey** или неправильный Fingerprint — NetSuite заблокирует соединение.  
2. **Пароль или SSH key** неверные.  
3. **Отсутствие прав** на запись в каталог (permission denied).  
4. **Неверно указан хост** (url).  
5. **Файрвол** или whitelist IP — NetSuite не может достучаться до SFTP.  

---

## 5. Проверить, что файл действительно появился на стороне 3PL

После успешного `upload()` или `put()`:

1. Обычно **3PL** даёт доступ к тому же SFTP, и вы можете подключиться со своего локального компьютера (через WinSCP / FileZilla / ssh) и проверить, появился ли загруженный файл в нужном каталоге.  
2. Некоторые 3PL системы присылают обратно какие-то «приёмные подтверждения» (acknowledgment) в ответном файле или на email.

---

## 6. Итоговый код-фрагмент (пример)

Ниже — **короткий пример** Scheduled Script, который:

1. Формирует CSV,  
2. Создаёт `fileObj`,  
3. Подключается к SFTP,  
4. Загружает файл.

```js
/**
 * @NApiVersion 2.x
 * @NScriptType ScheduledScript
 */
define(['N/file', 'N/sftp', 'N/log'], function(file, sftp, log) {

  function execute(context) {
    try {
      // 1) Сформировать CSV (простейший пример)
      var csvLines = [
        'SalesOrderId,TranId,Entity,Total',
        '123,SO-000123,Acme Corp,150.75',
        '124,SO-000124,Beta LLC,239.90'
      ];
      var csvContent = csvLines.join('\n');

      // 2) Создать объект файла
      var fileObj = file.create({
        name: 'export_orders.csv',
        fileType: file.Type.CSV,
        contents: csvContent
      });
      
      // 3) Подключиться к SFTP
      var connection = sftp.createConnection({
        url: 'sftp.my3plserver.com',
        port: 22,
        hostKey: 'ssh-rsa 2048 xx:xx:xx:xx:xx', 
        username: 'mySftpUsername',
        // Либо passwordGuid/keyGuid, либо напрямую password (не рекомендуется)
        password: 'mySftpPassword', 
        directory: '/inbound'
      });
      
      // 4) Загрузить файл
      var response = connection.upload({
        file: fileObj
      });
      
      log.audit('File uploaded successfully', response);

    } catch (e) {
      log.error('Error uploading file to SFTP', e);
    }
  }

  return {
    execute: execute
  };
});
```

---

## 7. Резюме

Чтобы «разместить файл на удалённом сервере 3PL» по **SFTP** из NetSuite:

1. **Создаёте** или загружаете объект `fileObj` ( `N/file` ), в котором находятся ваши данные (CSV/XML/т.д.).  
2. **Устанавливаете соединение** через `N/sftp.createConnection(...)`, передавая `url`, `port`, `username`, `hostKey`, а также `passwordGuid` или `keyGuid` для SSH-ключей.  
3. **Вызовите** `connection.upload(...)` или `connection.put(...)`, подавая `fileObj` (или содержимое).  
4. **Обрабатываете** результат и возможные исключения.  
5. **Проверяете**, что файл появился в нужном месте на стороне 3PL.

Такой скрипт (Scheduled/Map-Reduce) можно привязать к расписанию, и NetSuite будет автоматически выгружать заказы (или любую другую информацию) в виде файлов на SFTP-сервер 3PL.