https://gemini.google.com/share/a7d10c5e6781\

## 1. Дублирование учета себестоимости (Duplicate COGS)

### 1.1. Описание проблемы
Клиент указывает на «Duplicate COGS pushes» и ставит задачу «Prevent double-counting of COGS» (`O.md` §2.3). Это означает, что себестоимость проданных товаров учитывается в QBO более одного раза, что завышает расходы и занижает прибыль.

### 1.2. Анализ обоснованности
Проблема абсолютно обоснована и является частой ошибкой при интеграции Fishbowl и QBO. Fishbowl должен выступать в роли вспомогательной ведомости по запасам и быть единственным источником для расчета COGS, связанных с запасами. Дублирование возникает из-за нарушения этого принципа:

1.  **Ручной ввод или некорректная классификация счетов в QBO/Bill.com:** Если счета за закупку запасов вводятся напрямую в QBO или Bill.com и ошибочно относятся на счет COGS (расход), вместо счета Inventory Asset (актив). Когда Fishbowl позже продает товар и отправляет свою проводку по COGS, расход удваивается (Source 2.2).
2.  **Изменение транзакций в QBO:** Внесение изменений в транзакции, экспортированные из Fishbowl, напрямую в QBO может нарушить интеграцию. Например, изменение "Item Receipt" на "Bill" вручную в QuickBooks вместо использования процесса сверки (Reconciliation) в Fishbowl может привести к дублированию записей о кредиторской задолженности и запасах, так как Fishbowl не сможет найти и удалить исходный Item Receipt перед созданием Bill (Source 1.1, 2.1).
3.  **Некорректный мэппинг и конфигурация:** Если собственные функции учета запасов QBO не отключены, QBO может пытаться вести учет параллельно с Fishbowl (Source 1.1).

## 2. Отрицательные остатки запасов (Negative Inventory)

### 2.1. Описание проблемы
Клиент требует выявить причины возникновения отрицательных остатков («Identify causes of negative inventory») и устранить их (`O.md` §2.3). Отрицательный остаток означает, что система фиксирует продажу или использование товара до того, как зафиксировано его поступление.

### 2.2. Анализ обоснованности
Это критическая проблема, свидетельствующая о сбоях в процессах и управлении данными. В реальном мире нельзя продать то, чего нет.

Наличие отрицательных остатков приводит к серьезным искажениям финансовой отчетности:
1.  **Искажение COGS:** Когда система продает товар с отрицательным остатком, она не знает его реальной себестоимости. Это нарушает работу методов расчета себестоимости (FIFO, Average Costing) и приводит к неверному расчету COGS и валовой прибыли (Source 3.1, 3.2).
2.  **Недостоверный баланс:** Отрицательные остатки приводят к занижению стоимости активов (Inventory Asset) на балансе (Source 3.2).

Основные причины возникновения:
1.  **Временные расхождения (Timing):** Наиболее частая причина. Отгрузка регистрируется в системе раньше, чем приемка. Например, товар физически прибыл и был сразу отгружен, но данные о приемке еще не введены в Fishbowl (Source 3.2).
2.  **Ошибки в многоскладском учете:** Учитывая наличие нескольких складов у клиента, ошибки при регистрации перемещений или отгрузка с неверного склада в системе приводят к отрицательным остаткам в одном месте при наличии товара в другом.

## 3. Некорректный учет полной себестоимости (Landed Cost Architecture)

### 3.1. Описание проблемы
Клиент требует исправить логику расчета дополнительных затрат (тарифы, фрахт, драяж) и обеспечить их корректное распределение на SKU (`O.md` §2.3).

### 3.2. Анализ обоснованности
Для дистрибьютора, занимающегося международными закупками, точный учет Landed Cost критически важен для определения реальной прибыльности (Source 4.1).

Согласно GAAP (Общепринятые принципы бухгалтерского учета), эти затраты должны быть **капитализированы** в стоимость запасов (Inventory Asset), а не списываться как операционные расходы в момент возникновения. Они становятся расходом (COGS) только при продаже товара.

Сложность архитектуры Fishbowl/QBO/Bill.com порождает следующие проблемы:

1.  **Интеграция с Bill.com (AP):** Счета за Landed Costs (например, от экспедиторов) часто обрабатываются через Bill.com. Если эти счета синхронизируются с QBO и кодируются как общие расходы (например, "Расходы на фрахт"), они не попадают в стоимость запасов в Fishbowl. Архитектура должна гарантировать, что эти затраты направляются в Fishbowl для капитализации через процесс Landed Cost/Reconciliation.
2.  **Некорректная конфигурация в Fishbowl:** Для учета затрат, поступающих от третьих сторон (не от поставщика товара), рекомендуется использовать тип номенклатуры "Shipping", а не "Service". Это позволяет аккумулировать затраты на балансовом счете и применять их к запасам, даже если счет за доставку приходит отдельно от счета за товар (Source 4.3).
3.  **Ошибки распределения (Allocation):** Неверный выбор метода распределения общих затрат (по стоимости, весу, объему или количеству) искажает себестоимость отдельных SKU (Source 4.1).

## 4. Временные несоответствия и проблемы интеграции (Timing and Integration)

### 4.1. Описание проблемы
Клиент требует установить "чистое" соответствие по времени между приемкой товаров и признанием затрат, а также провести аудит мэппингов и потоков данных между системами (`O.md` §2.3).

### 4.2. Анализ обоснованности
Это фундаментальные требования для обеспечения целостности данных и соблюдения **принципа соответствия** (Matching Principle) GAAP, согласно которому расходы должны признаваться в том же периоде, что и доходы, которые они помогли получить (Source 5.1, 5.4).

1.  **Несоответствие времени (Timing Mismatches):** Счета за Landed Costs часто приходят значительно позже, чем товар поступает или продается. Если система не настроена на начисление (accrual) этих затрат в момент приемки (например, через использование оценочных затрат и клиринговых счетов), COGS в период продажи будет занижен (Source 5.1).
2.  **Нарушение процесса GRNI (Goods Received, Not Invoiced):** Если отдел AP вводит счет в QBO/Bill.com до того, как приемка зарегистрирована в Fishbowl, или если сверка в Fishbowl не проводится своевременно, возникают расхождения между главной книгой и ведомостью запасов.
3.  **Некорректный мэппинг счетов (Account Mapping):** Мэппинг является центральным элементом интеграции (Source 1.3). Если транзакции направляются на неверные счета в QBO (например, актив запасов вместо клирингового счета), Главная книга становится недостоверной. Эксперты указывают это как одну из первых причин расхождений между Fishbowl и QBO (Source 2.3).

# Заключение

Проблемы, описанные клиентом `ꆜ`, являются взаимосвязанными и свидетельствуют о глубоких системных и процессуальных недостатках. Дублирование COGS, отрицательные остатки и некорректный учет Landed Costs делают текущую финансовую отчетность компании ненадежной. Решение этих проблем требует комплексного подхода, включающего перенастройку интеграции, исправление мэппингов, оптимизацию бизнес-процессов (особенно взаимодействия между складом, закупками и AP через Bill.com) и создание строгих стандартных операционных процедур (SOPs).