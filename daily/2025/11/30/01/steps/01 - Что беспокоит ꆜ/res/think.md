https://gemini.google.com/share/3c1b7075db63

## 1. Выявленные проблемы `ꆜ` в проекте `P⁎`

Анализ описания проекта `P⁎` (`O.md`::§2.3) позволяет выделить две ключевые взаимосвязанные проблемы, с которыми столкнулся клиент `ꆜ` в процессе интеграции Shopify и NetSuite посредством NetSuite Connector (NSC).

### 1.1. Наблюдаемый симптом (P†): Избыточные корректировки запасов

Основная проблема, зафиксированная как `P†` (`O.md`::§9), заключается в том, что в системе NetSuite генерируется «множество корректировок запасов, вносимых вручную» (a bunch of manual inventory adjustments are being made).

Это указывает на аномальное поведение системы, при котором синхронизация уровней запасов происходит не только через стандартные бизнес-процессы (например, заказы на продажу и их выполнение), но и посредством транзакций типа `Inventory Adjustment`.

### 1.2. Диагностическая проблема: Отсутствие понимания причин

Клиент не понимает первопричину этого явления: «Мы пытаемся понять, почему» (We are trying to understand why) (`O.md`::§2.3). Это свидетельствует о непрозрачности логики работы NetSuite Connector для команды. Цель проекта — диагностировать, как именно NSC обрабатывает данные при их передаче в NetSuite («its logic when pushing data to NS»), и определить условия, которые приводят к созданию этих корректировок.

## 2. Анализ обоснованности и интерпретация проблем

Обеспокоенность клиента является полностью обоснованной. Точная синхронизация запасов критически важна для интеграции ERP (NetSuite) и платформы электронной коммерции (Shopify). Ошибки в этом процессе ведут к недостоверности данных, что может вызвать избыточные продажи (overselling), дефицит товаров и необходимость ручной сверки данных (Source 2.1, 2.2).

### 2.1. Роль транзакции Inventory Adjustment в NetSuite

Для понимания глубины проблемы необходимо обратиться к определению транзакции `Inventory Adjustment`. Согласно официальной документации Oracle NetSuite, эта транзакция предназначена для изменения количества и стоимости товарной позиции *без* ввода заказа на покупку или продажу (Source 1.2). Она используется для учета исключительных ситуаций, таких как:

*   Канцелярские ошибки (clerical errors).
*   Изменения стоимости (changes in cost).
*   Кражи или порча (thefts or damages).
*   Ошибки при инвентаризации (miscounts) (Source 1.1, 1.4).

Эта транзакция не предназначена для рутинной синхронизации запасов в рамках автоматизированной интеграции.

### 2.2. Интерпретация «Manual Inventory Adjustments»

В описании проблемы используется термин «manual» (ручные). Однако в контексте отладки интеграции маловероятно, что сотрудники клиента вносят эти корректировки вручную в большом количестве.

Наиболее вероятная интерпретация заключается в том, что эти транзакции создаются *автоматически* самим коннектором (NSC). Логика интеграционных платформ направлена на поддержание консистентности данных. Если коннектор обнаруживает расхождение между уровнем запасов в Shopify и NetSuite, он может быть настроен на принудительное выравнивание остатков (реконсиляцию) (Source 2.2). Для этого он создает `Inventory Adjustment`, чтобы привести уровень запасов в NetSuite в соответствие с тем, что он считает «источником истины».

Для клиента эти автоматически сгенерированные корректировки выглядят как «ручные», поскольку они инициируются учетной записью интеграции вне ожидаемого потока выполнения заказов.

Таким образом, массовое появление таких корректировок является явным симптомом фундаментальной ошибки в логике или конфигурации интеграции.

## 3. Анализ потенциальных первопричин

Обоснованность поиска клиентом причин подтверждается наличием множества известных факторов, которые усложняют синхронизацию запасов между Shopify и NetSuite.

### 3.1. Несоответствие данных и конфигурации (Data Mapping)

Ошибки в сопоставлении данных (Data Mapping) являются частой причиной сбоев синхронизации (Source 3.4, 3.2).

*   **Несоответствие SKU:** Если артикул (SKU) товара в Shopify не совпадает в точности с соответствующим полем в NetSuite, коннектор не сможет правильно идентифицировать товар для обновления запасов или корректно привязать его к заказу (Source 2.3).
*   **Маппинг локаций (Location Mapping):** При использовании нескольких складов (Multi-Location Inventory) необходимо точное сопоставление локаций Shopify и NetSuite (Source 4.4). Если заказ выполняется с одного склада, а коннектор пытается обновить запасы на другом, возникают расхождения.

### 3.2. Расчет доступного остатка (Quantity Available vs On Hand)

NetSuite строго различает физическое количество товара на складе и количество, доступное для продажи (Source 4.1, 4.3).

*   **Quantity on Hand (QOH):** Общее количество на складе.
*   **Quantity Committed:** Количество, зарезервированное под открытые заказы.
*   **Quantity Available:** Доступно для продажи (QOH минус Committed) (Source 4.5).

Если коннектор настроен на синхронизацию QOH, в то время как бизнес-процесс предполагает синхронизацию Quantity Available (что является лучшей практикой для предотвращения overselling), это приведет к постоянным расхождениям с данными Shopify.

### 3.3. Временные задержки и логика синхронизации

Фундаментальное различие в моделях обновления запасов и таймингах также является источником проблем:

*   **Shopify** обычно обновляет уровень запасов в момент *размещения* заказа.
*   **NetSuite** обновляет фактический запас (QOH) только в момент *выполнения* заказа (Item Fulfillment).

Коннекторы часто работают в пакетном режиме (batch processing) или сталкиваются с ограничениями API (API rate limitations), что увеличивает задержки синхронизации (Source 3.4).

Если синхронизация уровня запасов запускается до того, как все заказы и выполнения были полностью обработаны в обеих системах, коннектор может зафиксировать временное расхождение как ошибку. Если он настроен на принудительное выравнивание, он создаст `Inventory Adjustment`.