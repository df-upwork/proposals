Ниже представлена примерная пошаговая инструкция по настройке и проверке высокодоступной (HA) конфигурации на Juniper SRX300 и интеграции с Cisco Catalyst (включая резервный 4G-канал). Описанные шаги ориентированы на общий подход: точная реализация может отличаться в зависимости от особенностей конкретного оборудования и используемой версии JunOS или Cisco IOS.

1. Подготовить физические соединения для HA (Chassis Cluster) на Juniper SRX300.  
   1.1. Выделить два порта на каждом SRX300 для связей «control link» и «fabric link».  
   1.2. Подключить «control link» первого SRX к «control link» второго SRX (например, ge-0/0/1 к ge-0/0/1).  
   1.3. Аналогично подключить «fabric link» (например, ge-0/0/2 к ge-0/0/2).  
   1.4. Убедиться, что порты для HA не задействованы в других сервисах.

2. Включить режим Chassis Cluster на каждом SRX300 (JunOS CLI).  
   2.1. Перейти в «Operational mode» и ввести команду set chassis cluster cluster-id <числовое_значение> node <0_или_1>.  
   2.2. Перезагрузить устройство, чтобы изменения вступили в силу.  
   2.3. Проверить статус кластера командой show chassis cluster status после перезагрузки.

3. Настроить общие параметры кластера.  
   3.1. Войти в «Configuration mode» (консоль SRX) и указать нужные настройки для «redundancy groups», «reth interfaces» и приоритетов (priority) для активного (primary) и резервного (secondary) узлов.  
   3.2. Создать «reth interface», соответствующий физическим портам, которые подключаются к Cisco Catalyst. Пример (сокращённый фрагмент):  
      set interfaces reth0 redundant-ether-options redundancy-group 1  
      set interfaces reth0 unit 0 family inet address <IP_адрес/маска>  
   3.3. При необходимости добавить другие «reth interfaces» для сегментов LAN/DMZ.

4. Настроить резервирование WAN-канала и 4G failover.  
   4.1. Подключить 4G-модем (если используется USB или встроенный модуль) и убедиться, что в конфигурации JunOS устройство определяется как нужный интерфейс (например, mlxe0).  
   4.2. Включить функцию «Real-Time Performance Monitoring (RPM)» (или IP Monitoring) в JunOS, чтобы проводить несколько проверок доступности («multiple probes») основного WAN. Пример (частично):  
      set services rpm probe <probe_name> test <test_name> target address <IP_для_проверки>  
      set services rpm probe <probe_name> test <test_name> probe-count 5  
      set services rpm probe <probe_name> test <test_name> probe-interval 5  
   4.3. Настроить автоматическое переключение маршрута (или использовать track-options), чтобы при отсутствии ответа от основного канала WAN трафик шёл через 4G-интерфейс.  
   4.4. Убедиться, что для резервного 4G-интерфейса в таблице маршрутизации прописан более высокий «metric» (или более низкий «preference»), чтобы он стал активным только при недоступности основного канала.

5. Настроить и проверить DNS forwarding для двух каналов.  
   5.1. Определить, используется ли «DNS Proxy» на SRX или внутренний DNS-сервер.  
   5.2. Если используется «DNS Proxy» (Juniper), в разделе system services dns подтвердить наличие forwarders.  
   5.3. Указать разные «next-hop» или forwarders при работе основного и резервного каналов (при помощи route-based логики). При переключении (failover) DNS-запросы должны корректно отправляться по 4G-соединению.  
   5.4. Проверить корректную работу DNS при основном и резервном канале (команда ping или host/NSLookup).

6. Настроить Link Aggregation (LAG) на Juniper SRX300 для соединения с Cisco Catalyst.  
   6.1. На стороне Juniper SRX300 в «Configuration mode» активировать LACP для нужных физических интерфейсов, входящих в «reth interface». Пример (частично):  
      set interfaces ae0 aggregated-ether-options lacp active  
      set interfaces ae0 aggregated-ether-options minimum-links 1  
   6.2. Привязать ae0 к «reth interface». Пример:  
      set interfaces reth0 redundant-ether-options redundancy-group 1  
      set interfaces reth0 child-interface ae0  
   6.3. Сохранить настройки (commit).

7. Настроить EtherChannel на Cisco Catalyst.  
   7.1. Перейти в «Global Configuration» режим Cisco Catalyst (консоль или SSH).  
   7.2. Создать «Port-Channel» и включить режим channel-group <номер> mode active (LACP).  
   7.3. В «Interface Configuration» для каждого физического порта, который подключается к SRX, ввести команды:  
      interface range GigabitEthernet1/0/1 - 2  
      channel-group <номер> mode active  
   7.4. Настроить VLAN (trunk или access) в зависимости от нужной схемы внутри организации.  
   7.5. Убедиться, что «Port-Channel» поднялся (команда show etherchannel summary).

8. Проверить HA-функционал на Juniper SRX300.  
   8.1. Просмотреть состояние кластера командами show chassis cluster status, show chassis cluster interfaces.  
   8.2. Инициировать тестовое отключение активного узла (например, выключить один SRX или отключить WAN-порт) и убедиться, что резервный SRX корректно подхватывает трафик (команда show security flow session).  
   8.3. Аналогично проверить переход на 4G при недоступности основного канала WAN (отключить основной провайдера, посмотреть трасы командой traceroute).

9. Проверить работу DNS-forwarding при переключении.  
   9.1. При активном основном канале выполнить ping несколько доменных имён (nslookup, host), убедиться в ответах.  
   9.2. Принудительно отключить основной канал, проверить, что запросы DNS идут через 4G (выяснить новый маршрут и убедиться, что имена резолвятся).  
   9.3. Проверить логи (например, show log messages) на SRX для подтверждения переключения.

10. Настроить дополнительные механизмы мониторинга и уведомления.  
   10.1. При необходимости включить SNMP на Juniper SRX и Cisco Catalyst для мониторинга состояния интерфейсов, LAG/EtherChannel, WAN-каналов.  
   10.2. Включить syslog или аналогичную службу для отслеживания событий (например, потери основного канала WAN, перехода на резервный канал).  
   10.3. Регулярно проверять версию ПО (JunOS, Cisco IOS) и устанавливать обновления, важные для стабильной работы HA.

11. Документировать конфигурации и протестировать сценарии отказа.  
   11.1. Зафиксировать ключевые команды и настройки в отдельных документах, например `srx-chassis-cluster-config.txt` и `catalyst-lag-config.txt`.  
   11.2. С периодичностью (раз в квартал или полгода) выполнять тестовые переключения, чтобы убедиться, что HA-механизмы работают корректно.  
   11.3. Анализировать результаты тестов и при необходимости вносить изменения в конфигурацию (например, добавлять новые IP-адреса для probes в RPM).

Данная схема помогает обеспечить высокую доступность сети и автоматическое переключение на резервный 4G-канал при сбоях в основном канале. Такой подход обычно включает настройку Chassis Cluster на Juniper, объединение интерфейсов в LAG/EtherChannel с Cisco Catalyst, а также использование «Real-Time Performance Monitoring (RPM)» или похожих инструментов для отслеживания статуса WAN.