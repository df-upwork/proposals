1) Отправка сообщений `VISION_POSITION_ESTIMATE` в расширенный фильтр Калмана (EKF) во время нахождения в режиме `GUIDED_NOGPS` является архитектурно некорректной и не окажет никакого влияния на удержание позиции аппаратом:
1.1) Сообщение MAVLink `VISION_POSITION_ESTIMATE` по своему определению предназначено для передачи данных о положении от внешней системы (например, системы визуальной одометрии) напрямую в EKF полетного контроллера.
EKF объединяет (fuses) эти внешние данные с показаниями инерциальных датчиков (IMU) для формирования точной оценки состояния (положения и скорости) аппарата. 
Затем полетный контроллер использует эту оценку для автономного удержания позиции в таких режимах, как `Loiter` или `Guided`. 
Для работы в таком сценарии без физического GPS-модуля необходимо соответствующим образом сконфигурировать параметры EKF, чтобы он использовал внешний источник навигации.
1.2) Полетный режим `GUIDED_NOGPS` не использует данные о положении или скорости для стабилизации и принимает исключительно команды на установку углов ориентации (`SET_ATTITUDE_TARGET`).
Он был разработан специально для того, чтобы предоставить бортовым компьютерам возможность низкоуровневого управления ориентацией аппарата, аналогично тому, как пилот управляет им в режимах `Stabilize` или `AltHold`.
Исходный код режима в файле `mode_guided_nogps.cpp` подтверждает его простоту: его основная функция заключается в вызове обработчика управления по углам (`ModeGuided::angle_control_run()`), что фактически делает его «прозрачным» каналом для команд ориентации: https://github.com/ArduPilot/ardupilot/blob/master/ArduCopter/mode_guided_nogps.cpp
2) Для задачи удержания позиции применение простого одноконтурного ПИД-регулятора, выход которого напрямую связан с углами наклона, часто приводит к нестабильности, осцилляциям и перерегулированию.
Более надежным и широко распространенным в робототехнике подходом является использование каскадной (многоконтурной) архитектуры управления:
2.1) Внешний контур (контроллер положения). 
Его задача — преобразовать ошибку положения (разницу между целевой и текущей позицией) в целевую скорость. 
Если аппарат находится справа от цели, контроллер генерирует команду на движение влево с определенной скоростью. 
Величина этой скорости пропорциональна удалению от цели. Входом для этого контура является ошибка положения `[error_x, error_y]`, а выходом — вектор целевой скорости `[target_vx, target_vy]`.
2.2) Внутренний контур (контроллер скорости). 
Его задача — минимизировать ошибку скорости (разницу между целевой и текущей скоростью). 
Для изменения скорости необходимо приложить ускорение. 
Таким образом, входом для этого контура является ошибка скорости, а выходом — вектор целевого ускорения `[target_ax, target_ay]`.
3) Для конкретной задачи удержания позиции в одной точке (где целевая скорость равна нулю), архитектуру пункта 2 можно математически упростить и представить в виде единого ПИД-регулятора, работающего с ошибкой положения:
3.1) Пропорциональный член (`P`) реагирует на текущую ошибку положения: `Output_P = Kp * error`. 
Он обеспечивает основную возвращающую силу к цели.
3.2) Производный член (`D`) реагирует на скорость изменения ошибки, что эквивалентно противодействию текущей скорости аппарата: `Output_D = Kd * d(error)/dt`.
Он выполняет функцию демпфирования, предотвращая перерегулирование и затухая колебания.
3.3) Интегральный член (`I`) накапливает ошибку с течением времени: `Output_I = Ki * integral(error)`. 
Его задача — компенсировать постоянные внешние возмущения (например, ветер) или систематические ошибки (например, неидеальную калибровку), которые приводят к статической ошибке (когда аппарат зависает не точно в цели, а с небольшим смещением).
3.4) Итоговый выход ПИД-регуляторов для каждой из горизонтальных осей (`X` и `Y`) будет представлять собой желаемое ускорение `[ax, ay]`, которое необходимо сообщить аппарату для возвращения в целевую точку.
4) ПИД-регулятор пункта 3 выдает абстрактную команду на ускорение, но квадрокоптер управляется путем изменения своей ориентации в пространстве. 
Следовательно, необходим этап преобразования, основанный на законах динамики.
Квадрокоптер создает подъемную силу, направленную в основном вдоль своей вертикальной оси (оси `Z`).
Чтобы создать горизонтальное ускорение, аппарат должен наклониться (создать крен или тангаж), направляя часть вектора тяги в горизонтальную плоскость. 
Целевые углы крена и тангажа можно рассчитать напрямую из желаемых ускорений `[ax, ay]`, полученных от ПИД-регуляторов:
```
target_roll_angle = asin(ay / total_thrust_acceleration)
target_pitch_angle = -asin(ax / total_thrust_acceleration)
```
Полученные углы Эйлера (крен, тангаж) вместе с желаемым углом рыскания (который для задачи удержания позиции можно считать постоянным, например, 0, для сохранения направления) необходимо преобразовать в кватернион. 
Сообщение `SET_ATTITUDE_TARGET` требует представления ориентации именно в этом формате.
5) Так как в вашем случае данные о положении поступают не непрерывно, наивная реализация пунктов 2-4 выше, не учитывающая возможные перерывы в поступлении данных, может привести к катастрофическим последствиям:
5.1) При прекращении поступления данных значение error в ПИД-регуляторе «замерзает». 
Интегральный член может начать бесконтрольно расти (так называемое «насыщение интегратора»), если в момент потери данных существовала статическая ошибка. 
5.2) При возобновлении поступления данных после паузы ошибка может измениться скачкообразно. 
Это вызовет огромный всплеск в производной составляющей (`d(error)/dt`), что приведет к резкой, неконтролируемой команде и рывку аппарата.
6) Правильное решение проблемы пункта 5 — постоянный мониторинг времени поступления последнего сообщения о положении. 
Управляющий цикл должен проверять разницу между текущим временем и временной меткой последнего полученного сообщения. 
Если эта разница превышает заданный порог (например, 200-500 мс), контроллер должен перейти в безопасный режим. 
