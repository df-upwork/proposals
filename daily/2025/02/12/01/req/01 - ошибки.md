## 1.
Клиент хочет выполнить следующий проект:
### 1.1. Title
Expert FOSwiki Migration Consultant Needed
### 1.2. Description
We are looking for an experienced FOSwiki expert to help migrate our content to a new environment. it's sitting on FreeBSD.
If you have a proven track record in FOSwiki migrations and can deliver efficient solutions, we want to hear from you.

### 1.3. Tags
Web Development
Communications
FreeBSD
foswiki

## 2. Как перенести FOSwiki на другой сервер?
### 2.1.
В 1-й раз я тебя спросил:
~~~
Как вообще перенести FOSwiki на другой сервер?
~~~

### 2.2.
Ты ответил:
~~~
Ниже приводится обобщённый план переноса (миграции) FOSwiki на другой сервер. Основная идея заключается в том, чтобы корректно перенести все файлы системы, модули, плагины, базу данных (если используется внешняя СУБД) и конфигурацию таким образом, чтобы на новом сервере среда была максимально похожа на исходную.

---

## 1. Подготовительные действия

1. **Анализ текущей конфигурации**  
   - Определите версию FOSwiki, которая запущена на исходном сервере.  
   - Уточните набор плагинов и расширений, которые у вас установлены.  
   - Проверьте, используется ли внешняя база данных (например, MySQL, PostgreSQL) или стандартное файловое хранилище.  
   - Выясните, какие Perl-модули и версии Perl используются.  
   - Определите структуру веб-сервера (Apache, Nginx, Lighttpd и т.д.), конфигурацию виртуальных хостов, версию FreeBSD, пути к директориям FOSwiki.  

2. **Подготовка нового сервера**  
   - Установите на новом сервере необходимые компоненты:
     - Web-сервер (Apache/Nginx и т.п.)  
     - Необходимые модули Perl (в документации FOSwiki обычно указан список обязательных и рекомендуемых).  
   - Создайте пользователя и группу (если нужно), которым будут принадлежать файлы FOSwiki.  
   - Убедитесь, что версии ПО (Perl, Web-сервера, расширений) совместимы с версией FOSwiki или, если вы планируете обновление, ознакомьтесь с инструкциями FOSwiki по апгрейду.

---

## 2. Резервное копирование (бэкап) на старом сервере

1. **Остановите FOSwiki (или поставьте сайт на обслуживание)**  
   - Обычно достаточно остановить Web-сервер или ограничить доступ, чтобы никто не вносил изменения в контент во время копирования.

2. **Сделайте полную копию директорий FOSwiki**  
   - В стандартной установке FOSwiki есть несколько ключевых директорий:
     - `bin/` — содержит CGI-скрипты FOSwiki и вспомогательные файлы.
     - `pub/` — содержит статические файлы (CSS, JavaScript, изображения и т. д.).
     - `data/` — содержит «тексты» (topic) в виде файлов.
     - `lib/` — содержит основной код FOSwiki и настройки.
     - `working/` — временные файлы, логи и кэш (по желанию можно не переносить, но лучше сохраните — пригодится для восстановления).
   - Возможно, у вас есть модифицированные темы (skins), дополнительные плагины, файлы конфигурации в этих папках — важно не забыть ничего.

3. **Сохраните конфигурационный файл**  
   - Обычно центральные настройки хранятся в `lib/LocalSite.cfg`. В нём прописаны пути к каталогам, параметры подключения к базе данных (если есть), конфигурация плагинов и т.д.  

4. **Сохраните базу данных (если используется)**  
   - Если FOSwiki настроен на использование внешней базы данных (MySQL/PostgreSQL и т.д.), сделайте дамп БД (например, `mysqldump` или `pg_dump`).  

5. **Проверьте права доступа**  
   - Запишите или сохраните текущие права (chmod/chown). При переносе на новый сервер будет важно их восстановить.

---

## 3. Развёртывание на новом сервере

1. **Перенесите файлы**  
   - Копируйте все файлы из бэкапа (`bin/`, `pub/`, `data/`, `lib/`, `working/` и т.д.) на новый сервер в ту же (или скорректированную) структуру каталогов.  
   - Убедитесь, что вы скопировали также плагины, темы, локальные скрипты.

2. **Проверьте и скорректируйте пути в `LocalSite.cfg`**  
   - Обновите в файле `lib/LocalSite.cfg` пути к директориям, если на новом сервере они отличаются.  
   - Проверьте параметры подключения к базе данных (если нужна БД).  

3. **Разверните базу данных (если используется)**  
   - Создайте новую БД (или схему) на новом сервере, если нужно.  
   - Восстановите дамп старой базы (командой `mysql -u user -p dbname < backup.sql` или `psql ... < backup.sql` для PostgreSQL).  
   - Проверьте, корректно ли всё восстановилось.

4. **Установите правильные права (chown и chmod)**  
   - Пользователь и группа должны соответствовать тому, под кем запускается ваш Web-сервер (или FastCGI, mod_perl и т.д.).  
   - FOSwiki-директории обычно должны иметь права на чтение и выполнение, а `data/`, `working/` и т.д. — права на запись.

5. **Настройка Web-сервера**  
   - Создайте новый виртуальный хост или настройте существующий. Укажите путь к скриптам FOSwiki (обычно `bin/`), настройте CGI или mod_perl.  
   - Если используете Apache, убедитесь, что модули CGI или mod_perl включены.  
   - Проверьте, что `pub/` директория отдается как статический контент, а `bin/` обрабатывается как CGI (или через mod_perl).

---

## 4. Тестирование и запуск

1. **Проверка доступа**  
   - Зайдите в браузере на адрес нового сервера, откройте главный Web (по умолчанию это `Main/WebHome`) и убедитесь, что всё отображается.  
   - Убедитесь, что изображения, стили, скрипты подгружаются (проверьте `pub/`).  

2. **Проверка аутентификации**  
   - Если у вас настроена аутентификация (Apache, .htpasswd, LDAP, SSO и т.д.), проверьте, что всё работает.  
   - Перейдите по ссылке для входа (логина) и убедитесь, что можно войти под своим пользователем.  

3. **Проверка создания и редактирования новых тем**  
   - Убедитесь, что можно создавать, редактировать новые топики (Topics) и сохранять изменения.  
   - Проверьте работу форм, вложений (Attachments).  

4. **Проверка работы плагинов**  
   - Если вы используете нестандартные плагины, открывайте страницы, где они задействованы, и смотрите, не возникает ли ошибок.  
   - При необходимости установите недостающие Perl-модули.  

5. **Логи и мониторинг**  
   - Проверьте логи веб-сервера и логи FOSwiki (в `working/logs/` или где они у вас сконфигурированы) на предмет предупреждений и ошибок.  
   - Убедитесь, что нет критических ошибок в `/var/log/httpd-error.log` (или другом файле ошибок).

---

## 5. Финишные корректировки

1. **Обновление DNS или сетевых настроек**  
   - Если новый сервер имеет другое доменное имя или IP, обновите DNS-записи.  
   - При необходимости внесите коррективы в `LocalSite.cfg` (параметры `DefaultUrlHost`, `ScriptUrlPath` и т.д.).  

2. **Оптимизации (опционально)**  
   - Если FOSwiki был старой версии, можно запланировать апгрейд до новой, следуя официальной документации.  
   - Настройте кэширование статики (через `mod_expires` или аналогичные механизмы).  
   - Настройте HTTPS, если ещё не сделано.  

3. **Уведомление пользователей**  
   - Сообщите коллегам или пользователям, что система успешно перенесена и проверена.  
   - Если менялось доменное имя или путь, оповестите о новых URL.

---

## Полезные ссылки и советы

1. **Официальная документация FOSwiki**  
   - [FOSwiki.org](https://foswiki.org/) содержит гайды по установке и миграции, а также Wiki-страницы сообщества.

2. **Решение проблем с модулями Perl**  
   - Если при запуске возникают ошибки вида «Can't locate Some/Module.pm in @INC», нужно установить соответствующий модуль через пакетный менеджер FreeBSD (`pkg install p5-<Module>`) или CPAN.

3. **Перенос между разными ОС**  
   - Если вы переходите, например, с FreeBSD на Linux, следите за путями к каталогам, символическими ссылками, а также пакетными именами для Perl-модулей.  
   - В целом конфигурация должна быть похожей, но различия в путях (например, `/usr/local/www/foswiki/` вместо `/var/www/foswiki/`) важны.

4. **Проверка плагинов**  
   - Некоторые плагины могут зависеть от бинарных программ или библиотек, которые нужно установить отдельно (например, ImageMagick, GraphViz и т. д.).

5. **Безопасность**  
   - Сразу после переноса проверьте настройки прав доступа в FOSwiki (гостевой доступ, группы, ACL).  
   - Убедитесь, что лишние скрипты или плагины не открывают уязвимостей.

---

### Итоговый совет

Если у вас нет времени или опыта на все эти детали, имеет смысл обратиться к опытному консультанту, который специализируется на FOSwiki и подобных движках. Но даже для опытного администратора проект переноса FOSwiki, особенно если он сильно кастомизирован, может занять время на отладку и тестирование. Самое главное — это **доскональный бэкап**, корректная **копия всех файлов** и **точное воспроизведение условий** (Perl-модули, плагины, конфигурация) на новом сервере.
~~~

## 3. Мой ответ клиенту
Я хочу ответить клиенту так:
```
Перенос FOSwiki на новый сервер обычно делается так:
1) Установка Perl.
2) Установка требуемых модулей Perl.
3) Установка и настройка веб-сервера: https://foswiki.org/System/InstallationGuide#Step_4:_Configure_the_web_server
4) Перенос файлов.
5) Настройка permissions and ownership для файлов: https://foswiki.org/System/InstallationGuide#Step_2:_Confirm_file_and_directory_ownership_and_permissions
6) Установка и настройка СУБД: MySQL или PostgreSQL.
7) Перенос базы данных.
8) Настройка почтового сервера: https://foswiki.org/System/InstallationGuide#Step_6:_Configure_email
9) Адаптация `lib/LocalSite.cfg` к новому серверу.
```

## 4. Твоя задача
Есть ли в моём ответе фактические ошибки?
Есть ли в моём ответе логические ошибки?
Упустил ли я в ответе нечто важное?