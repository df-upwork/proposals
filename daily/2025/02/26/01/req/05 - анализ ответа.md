## 1.
Клиент хочет выполнить следующий проект:
### 1.1. Title
EPIC HL7 Discharge

### 1.2. Description
This project will consist of 3 steps:
- Setup and document Mirth Connect to be able to connect to EPIC EHR and read HL7 message
- Configure Mirth Connect to read HL7 message and log them to an SQL database for the in-patient discharge process (medical discharge through to actual discharge)
- Setup open EPIC account and connect mirth to it to test and validate setup

### 1.3. Местоположение клиента
United States
Southlake

### 1.4. Tags
Epic Systems Medical Software
Health Level 7
SQL

## 2. Мой ответ клиенту
Я хочу ответить клиенту так:
~~~
I. Замечания:
1) open.epic.com в основном предназначен для FHIR-интеграций (REST API) и не даёт публичного доступа к HL7 v2 (через MLLP/TCP).
2) Иногда крупные партнёры Epic могут договариваться с Epic Systems о расширенном тестовом доступе или о выделенной «pre-production»/«staging» среде, где возможен (хотя и ограниченный) HL7 v2-трафик. 
3) Подключение к HL7 v2 почти всегда требует заключения договора (Business Associate Agreement и пр.) с конкретным медучреждением, у которого есть Epic, или особых договорённостей с самой Epic Systems Corporation.
4) Для HL7 v2 (в том числе для discharge: ADT^A03) обычно нужна отдельная тестовая (staging) среда Epic или реальная Epic-инсталляция с модулем Bridges, где администратор Epic настраивает каналы (интерфейсы) для приёма/отправки HL7.
5) У госпиталей, являющихся клиентами Epic, почти всегда есть «TEST» (Stage) инсталляция.
Там можно настроить Bridges на отправку HL7 v2 ADT^A03 (discharge) к Mirth Connect (TCP/MLLP).  
Mirth Connect слушает на нужном порту, Epic Bridges отправляет тестовые сообщения, всё логируется в SQL.
---
II. Правильный способ решения вашей задачи (посредством Epic Bridges): 
1) Создать новый Channel в Mirth Connect:
1.1) В интерфейсе Mirth Connect Administrator перейти в «Channels» → «Edit Channel».
1.2) В появившемся окне задать понятное имя канала, например «EpicHL7_InboundChannel».
1.3) Сохранить промежуточные настройки, нажав «Save Changes».
2) Настроить в Mirth Connect Source Connector для приёма HL7-сообщений:
2.1)  В разделе «Source» → «Connector Type» выбрать «TCP Listener» или «MLLP Listener» (чаще всего MLLP Listener для HL7 v2.x).  
2.2) Указать порт, на котором Mirth Connect будет принимать входящие HL7-сообщения. 
Пример: 6661 (значение подбирается исходя из свободных портов). 
2.3) В «Receive Timeout» и «Buffer Size» установить параметры согласно требованиям проекта или рекомендациям Epic.  
2.4) В «Response» выбрать «Auto-generate ACK» (если необходимо отправлять подтверждение).
2.5) Сохранить изменения, нажав «Save Changes».
3) При необходимости добавить в Mirth Connect Transformer для предварительной обработки входящих HL7-сообщений:
3.1) В блоке «Source» → «Edit Transformer» можно использовать встроенный HL7 v2.x парсер. 
3.2) Извлечь нужные поля (например, `PID.3` для идентификатора пациента).
При использовании JavaScript можно обращаться к сегментам вида `msg['PID']['PID.3']['PID.3.1']`.
3.3) При желании преобразовать формат сообщения (например, удалить лишние сегменты или записать отдельные поля во временные переменные).  
3.4) Закрыть «Edit Transformer» и сохранить изменения.
4) В разделе «Destinations» создать «Destination Connector» с типом «Channel Writer» для первичного просмотра или логирования.
5) Настроить соединение на стороне Epic EHR через Epic Bridges: 
5.1) В Epic Bridges создать интерфейс для отправки HL7-сообщений (`ADT`, `ORM`, `ORU` и т. п.) на IP-адрес и порт, где «MLLP Listener» ожидает сообщения. 
5.2) Указать типы событий (для discharge event это `ADT^A03`) и необходимые сегменты.
5.3) Сохранить конфигурацию и перезапустить сервисы Bridges.
6) Проверить работу канала в разделе «Dashboard» Mirth Connect Administrator:  
6.1) Перейти в «Dashboard» → «Channels».  
6.2) Найти созданный канал (например, «HL7_Inbound_Channel») и нажать «Deploy Channel».  
6.3) бедиться, что статус канала «Deployed» без ошибок.
7) Проверить соединение между Epic Bridges и Mirth Connect:
7.1) В Epic Bridges отправить тестовое HL7-сообщение.
7.2)  В интерфейсе Mirth Connect Administrator открыть «Dashboard» → «Messages» для соответствующего канала и убедиться, что сообщение поступило и обработано без ошибок. 
7.3) При необходимости просмотреть «Response» (ACK) в «Message Browser».
8) Убедиться, что БД готова к приёму логируемых HL7-сообщений (нужные таблицы, права доступа, подключение).
9) Убедиться, что драйвер JDBC для выбранной базы данных доступен Mirth Connect.
Если в Mirth Connect отсутствует требуемый JDBC-драйвер  (например, для PostgreSQL или MS SQL Server), то нужно:
9.1) Поместить соответствующий .jar-файл в папку, откуда Mirth Connect подхватывает дополнительные драйверы (чаще всего каталог custom-lib или аналогичный, в зависимости от версии).  
9.2) Перезагрузить сервис Mirth Connect, чтобы драйвер был распознан.
10) В разделе «Destinations» создать «Destination Connector» типа «Database Writer».
11) Настроить свойства «Database Writer»:
11.1) В разделе «Database Writer» → «Database» указать тип соединения:  
- в поле «Driver» — класс драйвера (например, `com.mysql.jdbc.Driver или org.postgresql.Driver`);  
- в поле «URL» — строку подключения JDBC (например, `jdbc:mysql://localhost:3306/your_database`);  
- в поле «Username» и «Password» — учётные данные для доступа к базе данных.  
11.2) При использовании SSL или других параметров подключения, добавить соответствующие настройки в URL или конфигурационный файл.
12) В разделе «Database Writer» → «Statement» указать команду для записи данных.
Для сохранения всего HL7-сообщения целиком в поле message_raw можно использовать переменную `${message.encodedData}` или аналогичную. 
Mirth Connect автоматически подставит текст HL7-сообщения в `${message.encodedData}`.
13) Сохранить и развернуть Channel:   
13.1) «Save Changes».  
13.2) «Channels» → «Deploy Channel». 
Убедиться, что статус стал «Deployed» без ошибок.
14) Протестировать сохранение в базу данных:
14.1) Отправить из Epic EHR тестовое HL7-сообщение в Channel.  
14.2) В «Dashboard» → «Messages» просмотреть, успешно ли Destination выполнил операцию.  
14.3) Проверить, появилась ли новая запись в БД.
~~~

## 3. Твоя задача
Есть ли в моём ответе фактические ошибки?
Есть ли в моём ответе логические ошибки?
Упустил ли я в ответе нечто важное?

