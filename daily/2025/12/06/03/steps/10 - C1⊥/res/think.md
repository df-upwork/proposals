https://gemini.google.com/share/5bd1f6dc662c

## 1. C1↯⬆⠿
### 1.1. C1↯⬆-S⌖1
#### Суть
Стандартный механизм обнаружения топологии (SDAM), встроенный во все официальные драйверы MongoDB, делает невозможной стабильную работу через статический SSH-туннель без явного отключения этого механизма.
#### Оценка
100
#### Доводы за
Официальная спецификация драйверов MongoDB требует, чтобы сразу после успешного первичного рукопожатия клиент запрашивал у сервера карту топологии кластера.
В ответ на команду `hello` или `isMaster` сервер MongoDB Atlas возвращает список канонических доменных имен всех узлов репликационного набора (например, `atlas-shard-00.mongodb.net`).
Получив этот список, драйвер автоматически пытается разорвать текущее соединение с локальным портом туннеля и установить новые прямые соединения с полученными доменными именами.
Поскольку SSH-туннель в Datastream обеспечивает проброс порта только до одной конкретной точки входа, прямые соединения с остальными узлами кластера через сеть воркера Datastream технически невозможны.
Единственным документированным способом заставить драйвер игнорировать топологию и работать исключительно через предоставленный адрес является использование параметра URI `directConnection=true`.
#### Доводы против
Отсутствуют, так как описанное поведение является фундаментальной частью протокола MongoDB и подтверждается многочисленными техническими отчетами.

## 2. C1↯⬇⠿
### 2.1. C1↯⬇-S⌖2
#### Суть
Публичный интерфейс (API) сервиса Google Cloud Datastream и инструменты управления инфраструктурой не предоставляют пользователю возможности передать драйверу MongoDB произвольные параметры строки подключения.
#### Оценка
100
#### Доводы за
Объектная модель ресурса `MongodbProfile` в Datastream API v1 строго ограничивает конфигурацию полями `hostname`, `port`, `username` и `password`.
В отличие от профилей для других СУБД (Oracle, PostgreSQL), схема для MongoDB не содержит поля типа `Map` или `List` для ввода дополнительных атрибутов соединения.
Документация провайдера Terraform для ресурса `google_datastream_connection_profile` подтверждает отсутствие аргументов для ввода «сырой» строки подключения (URI) или дополнительных опций.
Поле `hostname` проходит валидацию формата на стороне сервиса, что блокирует попытки внедрения параметров через URL-кодирование (например, добавление `?directConnection=true`).
Практический опыт пользователей показывает, что сервис не применяет флаг `directConnection=true` автоматически при выборе метода SSH-туннелирования.
#### Доводы против
Существует лишь теоретическая и ничем не подтвержденная вероятность того, что Google может неявно изменять поведение драйвера на бэкенде сервиса.

## 3. Итоговый вердикт
### 3.1. C1↯ᵢ-Result
#### Суть
Проведенный анализ подтверждает истинность обоих противоречащих друг другу фактов, что делает рекомендацию использования нативного SSH-туннеля Datastream (`R1ᨀ`) технически некорректной для данной задачи.
#### Оценка
100
#### Доводы за
Утверждение `S⌖1` верно диагностирует техническое требование протокола: без флага `directConnection=true` драйвер MongoDB не сможет удерживать соединение внутри туннеля.
Утверждение `S⌖2` верно диагностирует ограничение платформы: сервис Datastream не позволяет пользователю задать этот необходимый флаг.
Совокупность этих факторов создает ситуацию блокировки («Deadlock»), при которой штатный механизм «Forward SSH tunnel» становится непригодным для подключения к кластеру MongoDB Atlas Replica Set.
Следовательно, единственным рабочим архитектурным решением остается использование промежуточного прокси-сервера (Nginx/HAProxy) на стороне клиента, который возьмет на себя управление параметрами подключения.
#### Доводы против
Отсутствуют.