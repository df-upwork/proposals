# 1. Pros
## 1.1. Модель безопасности «Default-Deny»
**Score**: **95**
AWS Client VPN реализует модель безопасности, в которой весь сетевой трафик после установления соединения по умолчанию запрещен.
Для разрешения доступа к любой целевой сети необходимо явное добавление правил авторизации (Authorization Rules).
Официальная документация AWS гласит: «To allow access to a destination network, an authorization rule must be explicitly added. The default behavior is to deny access» ([https://docs.aws.amazon.com/vpn/latest/clientvpn-admin/cvpn-working-rules.html](https://docs.aws.amazon.com/vpn/latest/clientvpn-admin/cvpn-working-rules.html)).
(Перевод: «Чтобы разрешить доступ к сети назначения, необходимо явно добавить правило авторизации. Поведением по умолчанию является запрет доступа».)
DNS-запросы представляют собой сетевой трафик, направленный на IP-адрес DNS-резолвера (например, Route 53 Resolver или пользовательские DNS-серверы).
Если правило авторизации, охватывающее IP-адрес используемого DNS-сервера, отсутствует, трафик будет заблокирован конечной точкой Client VPN.
Это является фундаментальным техническим обоснованием гипотезы `H`.

## 1.2. Соответствие времени возникновения сбоя
**Score**: **75**
Клиент `ꆜ` описывает симптом как «persistent DNS resolution failures upon login» (постоянные сбои разрешения DNS при входе в систему).
Это предполагает, что этап аутентификации (login) проходит успешно и VPN-туннель устанавливается.
Правила авторизации применяются сразу после установления соединения, контролируя доступ трафика в целевые сети.
Если первые пакеты, отправляемые клиентом (часто это именно DNS-запросы), блокируются на этом этапе, симптомы точно соответствуют описанию `P†`.

## 1.3. Контекст миграции с Akamai
**Score**: **70**
Проблема возникла после срочной миграции с решения Akamai на AWS Client VPN («Urgent Issue»).
Различные VPN-решения используют разные механизмы контроля доступа.
Весьма вероятно, что при настройке нового сервиса AWS были упущены его специфические требования, такие как явное добавление правил авторизации.
Срочность миграции увеличивает вероятность такой ошибки конфигурации.

# 2. Cons
## 2.1. Высокая вероятность некорректной конфигурации DNS (Причина 1)
**Score**: **90**
Наиболее частой причиной сбоев DNS является некорректная настройка параметров DNS-серверов в конфигурации конечной точки Client VPN.
Учитывая миграцию с Akamai, высока вероятность, что указаны устаревшие DNS-серверы или это поле оставлено пустым.
Особенно критичен сценарий, описанный в `Aᨀ` §1.2.2: если используется режим полного туннелирования (full-tunnel) и DNS-серверы не указаны, клиентское ПО AWS VPN блокирует доступ к локальным DNS-серверам для предотвращения утечек.
Поскольку удалённые DNS-серверы также не предоставлены, разрешение имён становится невозможным, независимо от наличия правил авторизации.
Этот сценарий идеально соответствует описанным симптомам и является очень распространенной проблемой.

## 2.2. Масштаб воздействия правил авторизации
**Score**: **85**
Отсутствие правил авторизации блокирует *весь* трафик в неавторизованный CIDR-блок, а не только DNS-запросы (порт 53).
Если бы проблема заключалась в отсутствии авторизации для VPC, клиент не смог бы получить доступ ни к каким ресурсам в этой сети, включая доступ по IP-адресам.
Описание проблемы `PD` фокусируется исключительно на «DNS resolution failures».
Это предполагает, что проблема более специфична для службы DNS (как в Причине 1), чем для общего доступа к сети, который контролируется правилами авторизации.

## 2.3. Проблемы маршрутизации (Причина 4)
**Score**: **65**
Даже при наличии корректных правил авторизации, трафик может не достичь DNS-серверов из-за ошибок маршрутизации (`Aᨀ` §4).
Например, в режиме раздельного туннелирования (split-tunnel), если маршрут к сети DNS-серверов отсутствует в таблице маршрутизации конечной точки VPN, он не будет добавлен на клиентское устройство.
В результате DNS-запросы не смогут быть маршрутизированы через туннель, независимо от статуса авторизации.

# 3. Verdict
**Score**: **60**
Гипотеза `H` о том, что причиной сбоев DNS (`P†`) является отсутствие необходимых правил авторизации, технически обоснована.
Архитектура AWS Client VPN («Default-Deny») требует явной авторизации для доступа к любым сетям, и отсутствие таких правил гарантированно приведет к блокировке DNS-трафика.
Время сбоя («upon login») и контекст срочной миграции также поддерживают эту гипотезу.
Однако существуют весомые аргументы против того, чтобы считать эту причину основной.
Наиболее сильным контраргументом является высокая вероятность некорректной конфигурации самих DNS-серверов (Причина 1), особенно сценарий использования полного туннелирования без указания DNS-серверов, что приводит к блокировке DNS на стороне клиента.
Кроме того, правила авторизации влияют на всю сетевую связность, тогда как клиент сообщает только о проблемах с DNS, что указывает на более специфическую проблему.
Хотя проверка правил авторизации необходима, Причина 1 представляется более вероятной причиной `P†`.