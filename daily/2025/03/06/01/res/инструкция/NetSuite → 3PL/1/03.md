Ниже приведены несколько примеров (на JavaScript в стиле SuiteScript 2.x) того, **как сформировать содержимое** для CSV или XML, имея на руках набор данных (например, результаты Saved Search). В качестве примера возьмём массив объектов с полями заказа.

---

## 1. Пример формирования CSV

Допустим, у нас есть массив объектов с данными заказов:

```js
var orders = [
  {
    salesOrderId: '123',
    tranId: 'SO-000123',
    entity: 'Acme Corp',
    total: 150.75
  },
  {
    salesOrderId: '124',
    tranId: 'SO-000124',
    entity: 'Beta LLC',
    total: 239.90
  }
  // ... и т.д.
];
```

### 1.1. Сформировать CSV-строки

1. **Объявляем массив строк**, где первая строка — это заголовок (header) с названиями столбцов.  
2. **Для каждой записи** из массива формируем строку, объединяя поля через запятую (или точку с запятой, если так нужно).  
3. **Склеиваем** всё в одну большую строку с разделителями переноса строки (`\n`).

Пример кода:

```js
// Создаём массив для строк CSV
var csvLines = [];

// Добавим шапку (header)
csvLines.push('SalesOrderId,TranId,Entity,Total');

// Генерируем строки с данными
orders.forEach(function(order) {
  // Если значения содержат запятые, кавычки и т.п., 
  // может потребоваться экранирование по CSV-правилам.
  // В простом случае просто конкатенируем:
  var line = order.salesOrderId + ',' +
             order.tranId        + ',' +
             order.entity        + ',' +
             order.total;
  csvLines.push(line);
});

// Склеиваем все строки в один текст
var csvContent = csvLines.join('\n');

// Теперь в csvContent содержимое типа:
// SalesOrderId,TranId,Entity,Total
// 123,SO-000123,Acme Corp,150.75
// 124,SO-000124,Beta LLC,239.90
```

Далее вы можете **сохранить** эту строку в объект `N/file` и **выгрузить** на SFTP:

```js
var fileObj = file.create({
  name: 'export_orders.csv',
  fileType: file.Type.CSV,
  contents: csvContent,
  folder: 123  // internal ID папки в File Cabinet, если нужно
});

// Либо сразу отправить через N/sftp.upload(...) без сохранения в File Cabinet.
```

### 1.2. Учитывайте спецсимволы при формировании CSV

- Если в данных возможны запятые, кавычки или переносы строк, желательно «оборачивать» поле в кавычки и заменять внутри `"` на `""`.  
- Простейший вариант (если данные гарантированно без «проблемных» символов) — формировать строку напрямую, как в примере выше.


---

## 2. Пример формирования XML

Допустим, та же структура данных. Нужно составить XML, где каждый заказ будет оформлен в тэге `<Order>`:

```js
var orders = [
  {
    salesOrderId: '123',
    tranId: 'SO-000123',
    entity: 'Acme Corp',
    total: 150.75
  },
  {
    salesOrderId: '124',
    tranId: 'SO-000124',
    entity: 'Beta LLC',
    total: 239.90
  }
];
```

### 2.1. Формируем XML-строку вручную

```js
// Начинаем XML с корневого тега, например <Orders>
var xmlContent = '<Orders>';

orders.forEach(function(order) {
  xmlContent += '<Order>';

  xmlContent += '<SalesOrderId>' + escapeXml(order.salesOrderId) + '</SalesOrderId>';
  xmlContent += '<TranId>' + escapeXml(order.tranId) + '</TranId>';
  xmlContent += '<Entity>' + escapeXml(order.entity) + '</Entity>';
  xmlContent += '<Total>' + escapeXml(order.total) + '</Total>';

  xmlContent += '</Order>';
});

xmlContent += '</Orders>';
```

> **Важно**: для корректности XML рекомендуется экранировать спецсимволы (`<`, `>`, `&`, `"` и т.д.). Можно написать простую функцию `escapeXml()` или воспользоваться готовой библиотекой, если она доступна в среде SuiteScript.

Пример «на коленке» функции экранирования:

```js
function escapeXml(unsafe) {
  if (!unsafe) return '';
  return String(unsafe)
    .replace(/&/g, '&amp;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&apos;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;');
}
```

В итоге, переменная `xmlContent` будет содержать:

```xml
<Orders>
  <Order>
    <SalesOrderId>123</SalesOrderId>
    <TranId>SO-000123</TranId>
    <Entity>Acme Corp</Entity>
    <Total>150.75</Total>
  </Order>
  <Order>
    <SalesOrderId>124</SalesOrderId>
    <TranId>SO-000124</TranId>
    <Entity>Beta LLC</Entity>
    <Total>239.90</Total>
  </Order>
</Orders>
```

### 2.2. Сохранение/загрузка XML-файла

Аналогично CSV, можно создать объект `N/file`:

```js
var xmlFile = file.create({
  name: 'export_orders.xml',
  fileType: file.Type.XML,
  contents: xmlContent,
  folder: 123  // ID папки в File Cabinet, если нужно
});

// Далее либо сохраняем, либо выгружаем на SFTP через N/sftp.
```

---

## 3. Общие замечания

1. **Спецификация формата**  
   - Уточните у 3PL (или у получателя файла), **какой именно формат** и **какая структура** нужна. Часто дают пример CSV- или XML-файла, где указывают, в каком порядке идти поля и как они называются.  
   - Иногда могут попросить формат **JSON**, тогда можно использовать `JSON.stringify()`, но это реже встречается в классической EDI-/3PL-интеграции.

2. **Экранирование и кодировка**  
   - В CSV обязательна обработка кавычек и переносов строк. В XML — обработка спецсимволов.  
   - Убедитесь, что передаваемый файл **в нужной кодировке** (обычно UTF-8).

3. **Большие объёмы данных**  
   - Если заказов много (тысячи), вы можете формировать файл **порциями** (например, использовать Map/Reduce Script). В `map()` обрабатывать часть строк, а в `summarize()` финализировать и выгружать общий файл.  
   - Следите за **gov. лимитами** (execution usage) и временем выполнения.

4. **Тип файла**  
   - При создании объекта в `N/file` используйте правильное значение `fileType`:  
     - `file.Type.CSV` для CSV,  
     - `file.Type.XML` для XML,  
     - `file.Type.PLAINTEXT` (TXT) или другое при необходимости.

5. **Передача по SFTP**  
   - После формирования содержимого (csvContent или xmlContent) и создания файла в памяти (`N/file.create(...)`), вы можете:  
     1. **Сохранить** файл в File Cabinet (если нужно «архивировать» в NetSuite).  
     2. Сразу передавать его «на лету» методом `connection.upload(...)` или `connection.put(...)`, используя объект `fileObj`.

---

### Итоговый алгоритм «Сформировать CSV/XML»

1. **Соберите данные** в массив объектов (например, после Saved Search).  
2. **Решите**, какой формат нужен (CSV или XML, а может JSON).  
3. **Создайте строку** с заголовками (CSV) или корневым тегом (XML).  
4. **Обойдите** массив данных (forEach, map, и т.п.), формируя **каждую строку** (CSV) или **теги** (XML).  
5. **Экранируйте** потенциально опасные символы.  
6. **Склейте** всё в одну итоговую строку (csvContent или xmlContent).  
7. **Создайте** объект `N/file`, указав `fileType` и содержимое (contents).  
8. **Сохраните** файл в File Cabinet и/или **отправьте** файл на SFTP (через `N/sftp`).

Таким образом, чтобы «сформировать строку или массив строк для CSV/XML», достаточно обычных операций конкатенации строк в JavaScript. Главное — знать точный **требуемый формат** и структуру, а также не забывать про экранирование спецсимволов.