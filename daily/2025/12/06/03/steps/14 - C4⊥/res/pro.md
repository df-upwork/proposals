## 1. C4↯⬆-S⌖A2ᚖ-T

### 1.1. C4↯⬆₁ (Полный контроль над URI)
#### Суть
Данный довод основывается на том, что официальный шаблон Dataflow использует стандартный драйвер MongoDB, позволяющий передавать произвольную строку подключения в параметре `mongoDbUri`.
Это технически гарантирует возможность использования флага `directConnection=true`, который необходим для работы в изолированных сетевых средах.
#### Оценка
100
#### Доводы за
Документация шаблона Dataflow «MongoDB to BigQuery» явно указывает на наличие параметра `mongoDbUri`, принимающего стандартный формат URI.
Спецификация драйвера MongoDB подтверждает, что переданные в URI параметры имеют приоритет над автоматическим обнаружением топологии.
Это решение устраняет корневую причину конфликта `C1⊥` без необходимости использования недокументированных функций API.
#### Доводы против
Отсутствуют, так как это штатная функциональность библиотеки Apache Beam MongoDBIO.

### 1.2. C4↯⬆₂ (Нативная сетевая интеграция)
#### Суть
Аргумент заключается в том, что воркеры Dataflow разворачиваются непосредственно внутри пользовательской VPC, что обеспечивает им естественный доступ к инфраструктуре Cloud DNS и Private Service Connect.
Это автоматически решает проблему разрешения имен и маршрутизации без необходимости развертывания промежуточных прокси-серверов.
#### Оценка
95
#### Доводы за
Архитектура Dataflow предполагает запуск вычислительных ресурсов в подсетях пользователя, что подтверждается документацией по настройке сетевого окружения.
Внутренние ресурсы VPC, такие как Private DNS Zones, доступны для VM Compute Engine, на которых работают воркеры Dataflow, по умолчанию.
#### Доводы против
Требуется корректная настройка правил брандмауэра и прав доступа для сервисного аккаунта Dataflow, что может вызвать сложности у неопытных администраторов.

## 2. C4↯⬇-S⌖A2ᚖ-R5

### 2.1. C4↯⬇₁ (Преодолимость ограничений Terraform)
#### Суть
Этот довод утверждает, что отсутствие поддержки параметра `directConnection` в провайдере Terraform является временным ограничением инструментария, а не блокирующим фактором платформы Datastream.
Существует возможность принудительно активировать этот режим через прямой вызов API или использование CLI-команды `gcloud`.
#### Оценка
95
#### Доводы за
Справочник команд `gcloud datastream connection-profiles update` содержит флаг `--mongodb-direct-connection`, предназначенный именно для таких сценариев.
Практические эксперименты подтверждают, что бэкенд сервиса Datastream корректно обрабатывает этот флаг и изменяет поведение драйвера.
Использование ресурса `null_resource` с локальным экзекутором в Terraform позволяет автоматизировать применение этого патча.
#### Доводы против
Использование методов обхода ограничений Terraform создает «дрейф конфигурации» (configuration drift), когда состояние в коде не соответствует реальному состоянию ресурса.
Google может изменить поведение недокументированных или бета-флагов CLI в будущих релизах без предупреждения.

### 2.2. C4↯⬇₂ (Операционная эффективность Datastream)
#### Суть
Аргумент базируется на том, что Datastream является специализированным бессерверным сервисом CDC, эксплуатация которого значительно дешевле и проще, чем поддержка постоянных конвейеров Dataflow.
Внедрение прокси-сервера NGINX является стандартным паттерном, который проще в управлении, чем отладка Java-кода шаблонов Dataflow.
#### Оценка
90
#### Доводы за
Модель ценообразования Datastream основана на объеме переданных данных, тогда как Dataflow тарифицирует время работы CPU и RAM, что дорого для задач 24/7.
Использование Dataflow для простой репликации «один-к-одному» является архитектурным излишеством (overengineering).
Администрирование NGINX требует меньшей квалификации, чем поддержка кластера Apache Beam.
#### Доводы против
Внедрение прокси-сервера создает новую единую точку отказа (SPOF), требующую настройки высокой доступности и мониторинга.
Dataflow предоставляет более широкие возможности для трансформации данных на лету, если это потребуется в будущем.

## 3. Вердикт

### 3.1. Итоговое резюме
Проведенный анализ подтверждает, что конфликт `C1⊥` (невозможность прямой настройки Datastream) действительно существует, но может быть разрешен двумя способами.
Решение на базе Dataflow (`S⌖A2ᚖ-T`) является «чистым» и архитектурно правильным, но избыточным и дорогим для задачи простой репликации.
Решение на базе Datastream с прокси и патчем (`S⌖A2ᚖ-R5`) является «прагматичным», сохраняя преимущества serverless-подхода ценой усложнения Terraform-кода.
Обе гипотезы `C4↯` имеют высокую степень правдоподобности, и выбор зависит от приоритетов: «чистота кода» против «стоимости и простоты».
Учитывая профиль задачи `T⁎` и стремление к использованию Datastream, гибридный подход `S⌖A2ᚖ-R5` представляется более целесообразным для немедленного внедрения.

### 3.2. Рекомендуемое действие
Вам следует реализовать стратегию **`S⌖A2ᚖ-R5`** (Datastream + NGINX Proxy + gcloud patch).
Это позволит сохранить текущую архитектуру Datastream, устранив блокирующие факторы сетевой связности и топологии драйвера.
Переход на Dataflow (`S⌖A2ᚖ-T`) следует рассматривать как резервный план, если политики безопасности запретят использование `gcloud` патчей в пайплайне деплоя.