## 1.
Клиент хочет выполнить следующий проект:
### 1.1. Title
AWS VPN/Networking Expert for Connection Troubleshooting
### 1.2. Description
We are seeking an experienced AWS Networking Specialist to diagnose and resolve an ongoing VPN connection issue. Our multi-account environment uses a Transit Gateway with lab and production VPCs, and the VPN has been running smoothly for over a year. Recently, however, the connection has started resetting every hour without a clear cause.
Responsibilities:
Investigate and troubleshoot recurring VPN connection resets
Review current AWS Transit Gateway, routing tables, and VPN configurations
Identify root causes and propose a permanent fix
Document recommended changes and best practices
Required Skills & Experience:
Proven track record with AWS networking (VPC, Transit Gateway, and Site-to-Site VPN)
Strong understanding of IPsec, IKE policies, and VPN protocols
Familiarity with AWS monitoring and logging (CloudWatch, VPC Flow Logs)
Excellent problem-solving and communication skills
If you have the expertise to help us restore a stable VPN connection, please apply with details of relevant experience and your proposed approach.

### 1.3. Tags
VPN
vpc
ipsec
transit gateway
Firewall

## 2. The connection has started resetting every hour without a clear cause
### 2.1.
Итак, в пункте 1.2 клиент пишет:
```
the connection has started resetting every hour without a clear cause
```
### 2.2.
При этом, как пишет клиент, в течение года у него этой проблемы не было:
```
has been running smoothly for over a year
```

## 3. Наиболее вероятные причины проблемы
### 3.1.
В 1-й раз я тебя спросил:
~~~
Каковы наиболее вероятные причины возникновения у клиента проблемы пункта 2.1?
~~~

### 3.2.
Ты ответил:
~~~
Ниже перечислены наиболее вероятные причины, по которым рабочая на протяжении года VPN-сессия внезапно начала сбрасываться каждый час:

1. **Изменения в параметрах IKE/IPsec (таймеры, политики, rekeying)**  
   - Часто сбои происходят, если на одной из сторон (AWS или on‑premise/другой облачный провайдер) изменились параметры криптографических политик, периоды жизни SA (Security Association), ключи шифрования и пр.  
   - Неправильная синхронизация таймеров IKE Phase 1 и Phase 2 (lifetime, rekey timeout и т.д.) может приводить к сбросу туннеля каждые N минут/часов.

2. **Обновление или переустановка оборудования/ПО на одной из сторон**  
   - Если с одной стороны производилось обновление ПО (например, прошивки брандмауэра, роутера, VPN-шлюза) или замена оборудования, могли измениться параметры IPsec или механизмы keep-alive, что вызывает разрывы.

3. **Конфликт маршрутизации или изменения в routing tables**  
   - В среде AWS Transit Gateway, особенно при наличии нескольких VPC и учётных записей, иногда случайные или запланированные изменения (добавление/удаление маршрутных таблиц, префиксов, ассоциаций) могут некорректно перенаправлять трафик.  
   - Неправильная маршрутизация (route propagation) приводит к тому, что VPN-трафик начинает идти “обходными” путями и туннель сбрасывается при обновлении таблиц.

4. **Проблемы со стороны провайдера или на сетевом оборудовании вне AWS**  
   - Регулярные сетевые сбои накануне каждых 60 минут могут быть связаны, например, с DHCP-арендами или NAT timeout у интернет-провайдера.  
   - Ограничения/таймауты на брандмауэре в локальной инфраструктуре, который обрывает “неактивный” или “нестандартный” (с точки зрения устройства) туннель.

5. **Изменение или неправильная настройка keep-alive / dead peer detection**  
   - Увеличение либо уменьшение частоты отправки keep-alive-сообщений или их выключение может приводить к тому, что туннель считается “мертвым” и переустанавливается.  
   - Несогласованность настроек DPD (Dead Peer Detection) на концах VPN.

6. **Проблемы с сертификатами или учетными данными**  
   - Если используется сертификатная аутентификация (а не Pre-Shared Key), может истекать срок действия сертификатов. Однако в таком случае туннель бы, скорее всего, не поднимался вовсе, но иногда истечение совпадает с нестабильной работой перед полным отключением.  
   - Смена ключей или политик шифрования (например, переход на более безопасные шифры) тоже может влиять.

7. **Влияние сторонних изменений в безопасности (Firewall, IPS/IDS)**  
   - Если в окружении внедрили новые средства информационной безопасности или обновили правила существующих, они могут определять IPsec-трафик как “подозрительный” и сбрасывать соединение через фиксированные интервалы.

8. **Системные или программные сбои на стороне AWS**  
   - Редко, но бывает: могут возникать временные проблемы в самом регионе/зоне доступности AWS, связанные со сбоями Transit Gateway или их внутренних компонентов. Обычно AWS оперативно сообщает о подобных инцидентах, если они затрагивают большой круг клиентов.

---

**Что можно сделать для уточнения причины**:
1. Изучить **CloudWatch Logs**, **VPC Flow Logs**, а также журналы локального VPN-шлюза или брандмауэра на предмет точного времени обрыва и сопоставления с событиями (rekey, expire SA, DPD).  
2. Проверить **параметры IKE Phase 1 и Phase 2** и сравнить их настройки с обоих концов туннеля (AWS и локальная сторона).  
3. Убедиться, что с момента появления проблемы **не менялись маршруты** в Transit Gateway и **не вносились другие изменения** в конфигурацию AWS.  
4. Связаться с **интернет-провайдером**, чтобы исключить сбои или периодические изменения IP-адресов и таймаутов на промежуточном оборудовании.  
5. Проверить **правила Firewall** на обеих сторонах (AWS Security Groups, Network ACL, локальные брандмауэры), чтобы исключить наложение новых ограничений.  

Вероятнее всего, причина будет связана с таймерами и механизмами перезаключения туннеля (IKE rekeying) или с новыми/изменёнными настройками оборудования (особенно если недавно проводились обновления).
~~~

## 4. Какие «стороны» задействованы в случае клиента?
В пункте 3.2 ты написал:
```
на одной из сторон (AWS или on‑premise/другой облачный провайдер) изменились параметры криптографических политик, периоды жизни SA (Security Association), ключи шифрования и пр
```
Какие вообще «стороны» задействованы в случае клиента?