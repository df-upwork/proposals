## 1.
Клиент хочет выполнить следующий проект:
### 1.1. Title
Amazon SP-API - JSON_LISTINGS_FEED Update Bug Fix

### 1.2. Description
We have migrated our Amazon SP-API PHP stock level Script from XML to JSON submission using JSON_LISTINGS_FEED, however no values are been updated from what we can see a successful upload. Need help with the JSON structure, error catching and migration

### 1.3. Местоположение клиента
United Kingdom
Hitchin

### 1.4. Tags
MySQL
SQL
PHP
API
Amazon Web Services
JSON

## 2. «no values are been updated»
### 2.1.
Я тебя спросил:
~~~
В пункте 1.2 клиент пишет:
```
no values are been updated
```
В чём причина проблемы клиента?
~~~

### 2.2.
Ты ответил:
~~~
Судя по описанию «no values are been updated» при вроде бы «успешной» загрузке, ключевая причина в том, что Amazon просто не обрабатывает или отбрасывает предоставленные данные (другими словами, «успешная загрузка» здесь не означает «успешное обновление значений»). Чаще всего это происходит из-за неправильного формата JSON (не соответствует требованиям JSON_LISTINGS_FEED) либо из-за пропущенных/неверных обязательных полей в самом фиде.  

Основные пункты, которые чаще всего приводят к подобным проблемам:

1. **Неправильная структура JSON**  
   - Amazon ожидает определённое дерево объектов и полей, соответствующее JSON_LISTINGS_FEED. Если хотя бы одно поле не совпадает с ожидаемой схемой или структура не соблюдена, Amazon не обновит данные.  
   - Нужно убедиться, что поля SKU, идентификатор товара (ASIN) или аналогичные ключевые поля присутствуют и имеют корректный формат.

2. **Неполный набор данных**  
   - Для обновления определённых атрибутов (например, цены, наличия, описания) Amazon требует обязательные поля. При отсутствии даже одного из таких полей обновление просто не произойдёт.  
   - Иногда требуется указывать MarketplaceId, ConditionType или другие важные поля (в зависимости от типа обновления).

3. **Отсутствие или некорректное чтение Feed Processing Report**  
   - После отправки JSON-фида Amazon генерирует отчёт, который показывает, были ли данные приняты или отклонены. Если этот отчёт не проверяется или неправильно интерпретируется, можно неверно заключить, что «загрузка успешна», тогда как на деле обновления могли быть отвергнуты.  
   - Из лога/отчёта обычно понятно, почему конкретные поля не были обновлены.

4. **Ошибки при формировании заголовков (headers) в запросе**  
   - В SP-API достаточно строгие требования к заголовкам авторизации, датам, подписям (Signature). Если что-то некорректно, Amazon может принять запрос «без ошибок» на этапе соединения, но не применить обновление.  

Таким образом, суть проблемы сводится к неправильному или неполно сформированному JSON-фиду и отсутствию корректной проверки отчёта о его обработке. Чтобы устранить эту проблему, нужно:

1. Свериться со **спецификацией JSON_LISTINGS_FEED**, особенно с обязательными полями.  
2. **Логировать** и **анализировать** Feed Processing Report.  
3. Проверить, что **заголовки** при запросе к SP-API корректны и соответствуют требованиям (особенно если используется собственная библиотека для подписи/формирования запроса).  
4. При необходимости пересмотреть **права** (auth/roles/permissions) в IAM/Developer Console, чтобы убедиться, что у скрипта достаточно прав на внесение нужных изменений в листинги.
~~~

## 3. «we can see a successful upload»
### 3.1.
Я тебя спросил:
~~~
В пункте 1.2 клиент пишет:
```
we can see a successful upload
```
Что клиент имеет в виду фразой «we can see a successful upload?
Feed Processing Report или что-то другое?
~~~

### 3.2.
Ты ответил:
~~~
Чаще всего под «successful upload» имеют в виду именно то, что **запрос на подачу фида был успешно принят Amazon** (то есть сервер не вернул никаких ошибок при отправке). Это означает, что **технически** фид был «загружен» и Amazon присвоил ему некий Feed ID. Однако **это не обязательно означает, что изменения действительно применены к листингу**.

Обычно механизм работы Feeds API такой:

1. **Отправка фида (submitFeed)**  
   - При этом вы получаете подтверждение: *«Фид принят сервером, ошибок на этапе загрузки нет»*.  
   - Часто это и называют «successful upload».

2. **Обработка фида (processing)**  
   - Amazon в фоновом режиме обрабатывает полученные данные, и по завершении вы можете получить «Feed Processing Report». Именно в нём отображается, *были ли фактически приняты изменения по каждому SKU* или какие-то записи отклонены с указанием причин.  

В вашей цитате «we can see a successful upload» скорее всего говорит о том, что **фид загрузился и не выдал явной ошибки на этапе отправки** (ошибок сетевого уровня, 4xx/5xx, валидации на уровне запроса и т.п.). Но это не означает, что **сам контент фида** соответствует требованиям и что **эти данные были применены** к листингам.

Таким образом, клиент, видимо, ещё *не* смотрит (или не до конца смотрит) **Feed Processing Report** и воспринимает саму успешную передачу данных через API как гарантию, что обновления должны произойти. Но на самом деле, чтобы подтвердить, что значения обновились, нужно смотреть именно в итоговый отчёт и проверять статус/детальную информацию там.
~~~
