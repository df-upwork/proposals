https://g.co/gemini/share/fb0f59e4e488
2 https://gemini.google.com/app/3d96f569bf0a4a07

#
Основной и наиболее вероятной причиной проблемы P†, связанной с некорректной обработкой часовых поясов, является использование в базе данных PostgreSQL типа данных timestamp without time zone (далее `timestamp`) вместо рекомендованного типа timestamp with time zone (далее `timestamptz`).
https://www.postgresql.org/docs/current/datatype-datetime.html

Вероятнее всего, сервер приложений Node.js, сервер базы данных и, возможно, основные пользователи системы находились в одном и том же часовом поясе.
В таких условиях запись и чтение локального времени из колонки timestamp будет казаться корректной, маскируя фундаментальный дефект архитектуры. 
Миграция на новую среду с другими настройками часовых поясов разрушила этот случайный консенсус и немедленно проявила скрытую проблему. 

По умолчанию, вызов moment() создаёт объект, представляющий текущее время в локальном часовом поясе сервера, на котором исполняется код. 

#
Новый код на Python некорректно обрабатывает временные метки, полученные из базы данных. 
В частности, он неверно управляет различием между наивными (naive) и осведомлёнными о часовом поясе (aware) объектами datetime перед их сериализацией в JSON для ответа API.

#
Появление null значений для полей с датой является прямым следствием сбоев валидации в библиотеке Pydantic.
Pydantic, будучи строгим парсером, не может обработать некоторые нестандартные форматы дат, которые были сохранены унаследованной системой. Возникающая при этом ошибка ValidationError обрабатывается в коде FastAPI некорректно, что и приводит к замене проблемного поля на null.

Moment.js известен своей способностью успешно разбирать самые разнообразные и даже неполные строковые представления дат. Pydantic, напротив, придерживается строгой философии «fail fast» и по умолчанию ожидает, что строки с датой и временем будут соответствовать стандарту ISO 8601. 

Когда FastAPI получает данные из базы данных для формирования ответа API, он использует Pydantic-модели для валидации и типизации этих данных. Если в поле, аннотированное как datetime, попадает строка из базы данных в нестандартном формате (например, "10/27/2023", "27 Oct 2023" или даже пустая строка ""), Pydantic не сможет её разобрать и сгенерирует исключение ValidationError.