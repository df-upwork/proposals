Ниже приведена пошаговая инструкция по настройке "high availability (HA)" на паре "Juniper SRX300" с резервированием на "4G failover" и интеграцией со стеком "Cisco Catalyst". В инструкцию включены ключевые аспекты: базовая подготовка, создание "HA cluster", настройка "multiple probes" для мониторинга канала, конфигурирование "DNS forwarding" с учётом резервного "4G failover" и создание "Link Aggregation Group (LAG)" между "Juniper SRX300" и "Cisco Catalyst". Инструкция предполагает использование официальных терминов из документации Juniper и Cisco, а также общих практик по построению отказоустойчивых сетевых решений.

1. Подготовка оборудования и сетевых подключений

1.1. Проверить физические соединения между устройствами "Juniper SRX300" и стеком "Cisco Catalyst":
• Убедиться, что каждая "Juniper SRX300" имеет планируемое количество интерфейсов, ведущих к "Cisco Catalyst", которые в дальнейшем будут объединены в "Link Aggregation Group (LAG)".
• Убедиться, что каналы, предназначенные для "HA cluster" (например, интерфейсы fab0/fab1 в Juniper терминологии), подключены корректно между двумя "Juniper SRX300".
• Подключить 4G-модем (или интерфейс) к одному из SRX300 таким образом, чтобы при переключении (failover) он был доступен для активного узла.

1.2. Убедиться, что "Cisco Catalyst" настроен в режиме "stack" (если используется несколько физических коммутаторов). Проверить общую доступность устройств:
• С помощью "CLI" (например, SSH) выполнить базовые команды "show interface status" и "show ip interface brief" (в случае "Cisco IOS") для оценки текущего состояния портов и VLAN.

2. Настройка "HA cluster" на Juniper SRX300

2.1. Определить режим "chassis cluster" на каждом SRX300 (обычно node0 и node1):
• Активировать "set chassis cluster cluster-id X node X" в конфигурации "JunOS" (конкретные значения X зависят от проекта).
• Указать интерфейсы контроля и синхронизации (например, "fab0", "fab1").

2.2. Проверить состояние кластера:
• Использовать команду "show chassis cluster status" в "CLI" JunOS.
• Убедиться, что один из узлов находится в состоянии "primary", второй — в состоянии "secondary", а статус синхронизации "In Sync".

2.3. Указать приоритеты узлов и порядок, в котором они должны становиться активными (при необходимости):
• Использовать "set chassis cluster redundancy-group X node X priority Y" для настройки приоритета на каждом узле.

3. Организация "4G failover" с мониторингом канала и "multiple probes"

3.1. Настроить "Real-time Performance Monitoring (RPM)" или аналогичные механизмы в "JunOS":
• Создать несколько "probes" (указать IP-адреса или доменные имена для проверки). Пример (в упрощённом виде):
```
set services rpm probe PROBE_NAME test TEST_NAME target address 8.8.8.8
set services rpm probe PROBE_NAME test TEST_NAME probe-count 5
...
```
• Настроить порог, при котором канал считается недоступным.

3.2. Связать результаты "probes" с механизмом "failover":
• Указать в конфигурации "routing-options" или соответствующих политик "JunOS", что при потере доступности основного WAN (по итогам "probes") должен происходить маршрутный переключатель на интерфейс 4G.
• Пример (обобщённо):
```
set routing-options static route 0.0.0.0/0 next-hop <primary_WAN> qualified-next-hop <4G_interface> preference 10
set routing-options static route 0.0.0.0/0 next-hop <4G_interface> preference 20
```
• Учитывать специфику HA (активный узел и резервный узел должны иметь аналогичную конфигурацию).

4. Настройка "DNS forwarding" с учётом резервного канала

4.1. Создать или скорректировать секцию "DNS forwarding" на SRX300:
• В "JunOS" это обычно выполняется через конфигурацию "system services dns" или "forwarding-options dns".
• Задать список серверов DNS в разделе "system name-server" или "forwarding-options" (зависит от архитектуры сети).

4.2. Обеспечить динамическую корректировку списка DNS-серверов или маршрутов для DNS при "failover":
• В некоторых случаях достаточно настроить маршрутизацию DNS-запросов через основной интерфейс, а при его недоступности "DNS forwarding" автоматически пойдёт через 4G, если маршрут по умолчанию переключается.
• При необходимости использовать "event-options" (в "JunOS") для реакции на событие "failover" и изменения настроек DNS (сложный вариант).

5. Создание "Link Aggregation Group (LAG)" между Juniper SRX300 (HA) и "Cisco Catalyst"

5.1. Настройка LAG на стороне "Juniper SRX300":
• В "JunOS" задать "aggregated Ethernet interface" (например, "ae0").
• Пример (обобщённо):
```
set interfaces ge-0/0/1 ether-options 802.3ad ae0
set interfaces ge-0/0/2 ether-options 802.3ad ae0
set interfaces ae0 aggregated-ether-options lacp active
set interfaces ae0 unit 0 family inet address <IP_address/Mask>
```
• Указать аналогичную конфигурацию на втором SRX300, учитывая специфику HA (в большинстве случаев SRX клонирует эти настройки на резервный узел, если включён "chassis cluster").

5.2. Настройка LAG (EtherChannel) на "Cisco Catalyst":
• В "CLI" "Cisco IOS" выполнить последовательные команды (примерно):
```
interface range GigabitEthernet1/0/1 - 2
channel-group 1 mode active
interface Port-channel 1
switchport mode trunk
...
```
• Убедиться, что на Cisco Catalyst настроен тот же протокол агрегации (LACP) и в том же режиме (active).

5.3. Проверить состояние LAG:
• На SRX300: команда "show interfaces ae0 extensive" — статус "LAG" и "LACP".
• На Cisco Catalyst: "show etherchannel summary" — статус "Port-channel" и "bundled" интерфейсов.

6. Тестирование и проверка отказоустойчивости

6.1. Проверить "HA cluster" в нормальном режиме:
• Отключить один из SRX300 и убедиться, что трафик сохраняется через второй.
• Проверить доступ к Интернету, а также корректность функционирования "DNS forwarding".

6.2. Проверить "4G failover":
• Принудительно отключить основной WAN и убедиться, что трафик переключается на 4G-модем.
• Проверить "multiple probes": команда "show services rpm probe PROBE_NAME" (в JunOS), оценить состояние.

6.3. Проверить работу LAG:
• Отключить один из физических интерфейсов, входящих в "Link Aggregation Group", и убедиться, что доступность сохраняется.

6.4. Зафиксировать логи и статистику:
• На "Juniper SRX300": команды "show log messages", "show log chassisd" для проверки событий HA.
• На "Cisco Catalyst": "show logging" или "show etherchannel" для выявления ошибок.

7. Документирование конфигурации и рекомендации по сопровождению

7.1. Сохранить итоговые конфигурационные файлы "JunOS":
• Например: команда "show configuration | display set" в "CLI" SRX300, сохранить вывод в файл `srx300_cluster_config.txt`.

7.2. Сохранить конфигурацию "Cisco IOS":
• Команда "show running-config", сохранить вывод в файл `cisco_catalyst_config.txt`.

7.3. Рекомендуется регулярно выполнять обновление ПО:
• Использовать последние версии "JunOS" (с учётом модели SRX300) и "Cisco IOS", проверять совместимость.

7.4. Рекомендуется настроить централизованный мониторинг:
• Собирать SNMP, "syslog" и, по необходимости, NetFlow статистику.
• Использовать внешние системы (например, "PRTG Network Monitor" или "Zabbix" — в зависимости от предпочтений) для получения своевременных оповещений о сбоях или падениях канала.

Таким образом, "chassis cluster" на "Juniper SRX300" обеспечивает "HA" маршрутизации и безопасности, "4G failover" гарантирует резервирование канала при сбоях, а "Link Aggregation Group (LAG)" с "Cisco Catalyst" обеспечивает дополнительную производительность и отказоустойчивость на уровне канала связи.